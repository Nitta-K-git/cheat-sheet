<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python &mdash; cheat sheet 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Cheat sheet documents" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            cheat sheet
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">caption name</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tips">Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-module">import module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sys-path-append">sys.path.appendで重複確認</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reload">reload</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">ワンライナー</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linux">linuxコマンド実行</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">ファイル読み書き</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#utf-8-bom">UTF-8 BOM付で保存</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#io">IOモジュール</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">メモリ上のデータをファイルオブジェクト化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#url">URL上のデータを保存</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zip">zipファイルの解凍</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">グローバル変数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main"><code class="docutils literal notranslate"><span class="pre">__main__</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#print">printの無効化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">パイプ処理に対応</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">受け取り</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">受け渡し</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">テンプレ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id9">パス操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">モジュールの動的リロード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">演算子のオーバーロード</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">比較演算子</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">算術演算子(左辺)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">算術演算子(右辺)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">算術代入演算子</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">単項演算子</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id17">三項演算子</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lambda">lambda関数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#map">map関数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">ランダム</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">ランダムな小数、整数</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id20">組み合わせ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id21">順列・組み合わせ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">複数リストの直積</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#functools">functools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#functools-reduce">高階関数 functools.reduce()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lru-cache">lru_cache</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">最小公倍数・最大公約数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#type">Typeヒント</a></li>
<li class="toctree-l3"><a class="reference internal" href="#try-except">例外処理 try/except</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id24">デバッグとかで一時的に無効にしたいとき</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">例外の再送</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id26">正規表現</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id27">一致箇所を取り出す</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">置換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">検索</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">否定表現</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id31">文字列処理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id32">検索</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id33">結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id34">置換</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id35">文字単位で置換</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id36">リストの値をダブルクォーテーションで出力</a></li>
<li class="toctree-l4"><a class="reference internal" href="#join">join</a></li>
<li class="toctree-l4"><a class="reference internal" href="#split">split</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pickle">pickleテンプレート</a></li>
<li class="toctree-l3"><a class="reference internal" href="#breakpoint">デバッグ breakpoint()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id37">よく使うコマンド</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id38">処理時間計測</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">日時取得</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unix">UNIX時間</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sort">sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">list</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id40">初期化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id41">結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#insert">insert</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">要素が入っているか判定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id43">要素の除外</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">ループ内で除外</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id45">スライス</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dict">dict</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id46">キーがあるか判定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id47">キーから値を取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#json">jsonデータから読み込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id48">結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id49">jsonデータで保存</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keyvalue">keyとvalueを反転</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copy">copy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tuple">tuple</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id50">同じ要素を複製</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id51">結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id52">アンパック</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#namedtuple">namedtuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decorator">decorator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#unique">unique</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id53">抽象クラスと継承</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id54">静的メソッドの指定</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bytesio">BytesIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gcs">GCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id55">データクラス</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id56">大文字小文字変換</a></li>
<li class="toctree-l3"><a class="reference internal" href="#is">is と == の違い</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id57">環境変数を取得・設定・削除</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dotenv">dotenv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enum">Enum</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id58">複合型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#asyncio">asyncio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id59">並列・並行処理まとめ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id60">並行処理(マルチスレッド(シングルプロセス))</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id61">並列処理(マルチプロセス)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#thread">thread (並列処理)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#threading">threading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#threadpoolexecutor">ThreadPoolExecutor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#future">Future</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id62">スレッド無限ループ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id63">マルチプロセス (並行処理)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fork">fork</a></li>
<li class="toctree-l4"><a class="reference internal" href="#processpoolexecutor">ProcessPoolExecutor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#profiling">Profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id64">メモリ使用量の確認</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tqdm">tqdm プログレスバー</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id65">四捨五入</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ellipsis">… (Ellipsis)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id66">変数が定義済みか確認</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id-uuid">ユニークID (UUID)の生成</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id67">一定間隔で処理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sleep">sleep</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signel">signel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logging">ログ設定 logging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id68">サンプル</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id69">ログを一時的に無効化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file">File操作</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#current-path">current path</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id70">カレントパスを変更する</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id71">パスの存在確認</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id72">ファイル情報の参照(サイズなど)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id73">ファイルかディレクトリか判定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mkdir-make-directory">mkdir, make directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id74">一覧取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#move">move</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id75">copy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remove-delete">remove, delete</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rename">rename</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id76">絶対・相対パス変換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id77">フォルダ名、ベース名、拡張子のみ取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id78">親ディレクトリ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#os">osのパス区切り文字</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id79">パスの結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id80">ZIP圧縮</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id81">一時ファイル/ディレクトリの作成</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id82">自動で削除</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id83">自動で削除されない</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slice">slice</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id84">print</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#f">f文字列</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modules">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pydantic">pydantic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id85">型に条件を追加</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id86">copy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#field">Field</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id87">環境変数、シークレットファイルの値を読み込む</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id88">その他Tips</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pandas">Pandas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id89">データの新規作成</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csv">CSV読み込み・書き込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id90">エクセルからデータ読み込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id91">特定の列・行をインデックス指定で取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id92">行番号・列番号の取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eda">EDAで最初にやること</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id93">列同士で演算</a></li>
<li class="toctree-l4"><a class="reference internal" href="#df">列名とインデックスを他のdfからコピー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id94">コピー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#for">for文で巡回</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id95">データ列/行を追加・挿入</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id96">データ列を結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id97">行を結合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id98">インデックスを指定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id99">インデックスの重複を除外</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id100">辞書型に変換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id101">リストと相互変換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#numpy">numpyと相互変換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id102">列名でsort</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query">query</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id103">データ同士の結合/集合演算</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id104">任意の列を結合して新しいデータを作成</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id105">複数の列の要素を引数に取った関数を適用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id106">列の項目名をリストで取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id">列のID名をリストで取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#settingwithcopywarning">特定の項目の値を変更 (SettingWithCopyWarningの対処法)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#bool">bool配列でフィルタして変更</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id107">行名、列名一覧</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id108">行名、列名の存在確認</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id109">行名、列名の変更</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id110">データをランダムに表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id111">含まれるデータ型の表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id112">データの洗浄</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id113">欠損値除外</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id114">欠損値置換</a></li>
<li class="toctree-l5"><a class="reference internal" href="#nan">NaNを含む行・列を抽出</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id115">特定の列名を削除</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id116">特定の行を削除</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id117">条件を満たす行を削除・抽出</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id118">列名の置換/変更</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id119">インデックス名の変更</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id120">値を0.5単位に揃える</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id121">外れ値の除外</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id122">行をシャッフル、データを分割</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id123">各行、各列でまとめて計算</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id124">boolのカウント</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nan-bool">NaN/boolの判定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id125">重複する要素の総和を計算</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id126">平均・最大最小・標準偏差を一括で計算</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id127">パーセンタイル</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id128">最頻値</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id129">相関係数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id130">尖度・歪度</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id131">文字列で行を抽出</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datetime">日付の文字列をdatetime型に</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id132">時刻で行を抽出</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id133">項目(セルの中身)の置換</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id134">データの概要を表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pandas-profiling">pandas-profiling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id135">その他のprofiling</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id136">pandas-profiling</a></li>
<li class="toctree-l5"><a class="reference internal" href="#sweetviz">sweetviz</a></li>
<li class="toctree-l5"><a class="reference internal" href="#autoviz">autoviz</a></li>
<li class="toctree-l5"><a class="reference internal" href="#dtale">dtale</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pandas-plot">Pandas: plot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id137">ラベル表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id138">折れ線</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id139">ヒストグラム(ビン図)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id140">散布図</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id141">プロット図の各点にラベル付け</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id142">プロット図の点ごとに色分け</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id143">棒グラフ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id144">箱ひげ図</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id145">画像を保存</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#seaborn">seaborn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id146">棒グラフ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id147">ヒストグラム</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id148">散布図</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id149">複数散布図をまとめて表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id150">ボックスプロット(箱ひげ図)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id151">ボックスプロットの一覧表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id152">ヒートマップ</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id153">ヒートマップで相関度高い順に表示</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id154">ペアプロット</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#matplotlib">matplotlib</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id155">ヒストグラム(ビン図)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id156">散布図</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id157">折れ線グラフ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id158">棒グラフ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id159">複数の画像をまとめて表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id160">複数グラフをまとめて表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id161">複数の図にグラフ表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id162">複数の図に複数のビン図</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id163">プロット図の各点にラベル付け</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id164">プロットの点の大きさを調整</a></li>
<li class="toctree-l4"><a class="reference internal" href="#x-y">プロットのx,y軸にラベルを設定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id165">画像を保存</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#plt-figure">plt.figureで保存</a></li>
<li class="toctree-l5"><a class="reference internal" href="#numpy-array">numpy arrayを保存</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id166">グリッド表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id167">画像サイズ変更</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id168">統計学基礎</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id169">箱ひげ図の見方</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id170">Numpy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id171">最大・最小・平均・標準偏差・中央値</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id172">バイナリデータで保存・読込</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id173">printの表示方法設定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#np-nan-bool">np.nan / boolの比較</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id174">スライス</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id175">型の確認・変更</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id176">各行毎にソートする</a></li>
<li class="toctree-l4"><a class="reference internal" href="#or-any">行方向 or 列方向にany</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id177">条件を満たすセルだけ処理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where">条件を満たす要素のインデックスを取得 where</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id178">列方向・行方向に総和</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diff">隣接する項目との差分(diff)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id179">移動平均</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id180">任意の値で初期化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id181">ベクトルの角度</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id182">ベクトルの回転</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id183">内積・外積</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id184">ベクトルの交点</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id185">複数の点と一つの点で距離を計算する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id186">テキスト形式で保存・読み込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#and-or">AND/OR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id187">等差数列: 任意の始点と終点を分割</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id188">insert</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id189">配列を分割</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id190">パーセンタイル(四分位数)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id191">正規分布</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id192">JSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notebooks">Notebooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id193">モジュールの自動リロード</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id194">画像の読み込み・表示・編集</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id195">点をプロット</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id196">矩形</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scikit-learn">scikit-learn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id197">パラメータを表示</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#jupyterlab">Jupyterlab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id198">目次表示する拡張機能</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id199">変数を常にprintする拡張機能</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id200">ショートカット</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id201">タブ移動</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id202">タブを閉じる</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id203">タブを閉じて、カーネルも終了</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id204">セルのモードを変える</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id205">別のブラウザページから戻ってきたときにセルをアクティベート</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id206">セルを分割</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id207">セルを結合</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id208">オススメ設定</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#notebook">Notebook</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id209">コマンドパレットを左側に常に表示させる</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id210">ショートカット設定の変更</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gcp">GCP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id211">GCS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id212">アカウント認証</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id213">データ読み込み/書き込み</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id214">ファイルの存在確認</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id215">バケットの任意のディレクトリのファイル一覧取得</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pathlib">pathlibとの互換ライブラリ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gcsfs">GCSFS</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#usage">usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#http">httpリクエスト</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web">webフレームワーク</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uvicorn">uvicorn</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install">install</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id216">usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#fastapi">fastAPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id217">install</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id218">basic usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id219">Tips</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id220">引数</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id221">ファイルを指定</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id222">pydanticの指定オプション</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id223">起動・終了時のイベント定義</a></li>
<li class="toctree-l5"><a class="reference internal" href="#cors">CORSエラー対応</a></li>
<li class="toctree-l5"><a class="reference internal" href="#async">async</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id224">グローバル変数の共有(ワーカー数設定)</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id225">応答を返した後も処理をする</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#typer">Typer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id226">basic usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id227">Tips</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#command">command</a></li>
<li class="toctree-l5"><a class="reference internal" href="#option">Option</a></li>
<li class="toctree-l5"><a class="reference internal" href="#flag">Flag入力</a></li>
<li class="toctree-l5"><a class="reference internal" href="#template">template</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api">APIを叩く</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requests">Requestsモジュール</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id228">概要</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id229">クエリ(URL)パラメータ</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id230">リクエストヘッダ</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id231">JSONデータへ変換</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id232">画像・zipなどをダウンロード</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id233">fileのアップロード</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id234">API入力例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dask">Dask: ビックデータを扱う</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mqtt-paho">MQTT (paho)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id235">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id236">Tips</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#publish">クライアントなしでpublish</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#omegaconf">OmegaConf</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cheat sheet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/python.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this heading"></a></h1>
<section id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Permalink to this heading"></a></h2>
<section id="import-module">
<h3>import module<a class="headerlink" href="#import-module" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://chaika.hatenablog.com/entry/2018/08/24/090000">Python3 自作モジュールのインポートにハマる - かもメモ</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-os-environ-getenv/">Pythonで環境変数を取得・追加・上書き・削除（os.environ） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/PYTHONISTA/items/2dcabc93365a62397afe">Python <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>の書き方 - Qiita</a></p></li>
</ul>
<p>とりあえず<code class="docutils literal notranslate"><span class="pre">sys.path.append</span></code>にpythonファイルのあるディレクトリを指定しておけばimportできる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">util_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;utils&quot;</span> <span class="c1"># 一応絶対パスにしておく</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">util_path</span><span class="p">))</span> <span class="c1"># 文字列型に変換すること</span>
<span class="kn">import</span> <span class="nn">util</span> <span class="c1"># utils/util.py</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">HOGE_MOD_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOGE_MOD_DIR&#39;</span><span class="p">)</span> <span class="c1"># 環境変数から取得する</span>
<span class="k">if</span> <span class="n">HOGE_MOD_DIR</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HOGE_MOD_DIR</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">hoge</span>
</pre></div>
</div>
<section id="sys-path-append">
<h4>sys.path.appendで重複確認<a class="headerlink" href="#sys-path-append" title="Permalink to this heading"></a></h4>
<p>JupyterやFusion360などカーネルが起動し続けるタイプのものでは、自作モジュールを追加するためにsys.pathに追加するが、毎回実行していると同じパスが何回も追加されるので、それを防ぐ処理があった方がいい</p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-list-str-select-replace/">Pythonで文字列のリスト（配列）の条件を満たす要素を抽出、置換 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">util_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;utils&quot;</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">util_path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">util_path</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">util</span>
</pre></div>
</div>
</section>
<section id="reload">
<h4>reload<a class="headerlink" href="#reload" title="Permalink to this heading"></a></h4>
<p>importlibを使う</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">importlib</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h3>ワンライナー<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/wyamamo/items/667c79db7edbaa9a46a7">python ワンライナーに挑戦 〜 初心者のお勉強 m(_ _)m - Qiita</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>file1.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; [print(l,end=&quot;&quot;) for l in sys.stdin]&#39;</span><span class="w"> </span><span class="c1"># catと同じ動作</span>

<span class="c1"># モジュールパスの表示</span>
$<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; import pprint; pprint.pprint(sys.path)&#39;</span>

<span class="c1"># 環境変数のdump</span>
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">HOGE</span><span class="o">=</span><span class="s2">&quot;FOO&quot;</span>
$<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os; e = os.environ.get(&quot;HOGE&quot;); print(e, end=&quot;&quot;)&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>FOO.txt
$<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os; e = os.environ.get(&quot;HOGE&quot;); f = open(&quot;./FOO2.txt&quot;, mode=&quot;w&quot;); f.write(e); f.close()&#39;</span>

<span class="c1"># テキスト読み込み</span>
$<span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;f = open(&quot;./FOO.txt&quot;); print(f.read()); f.close()&#39;</span>

<span class="c1"># パイプラインから読み込み</span>
$<span class="w"> </span>cat<span class="w"> </span>file1.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; [print(l,end=&quot;&quot;) for l in sys.stdin]&#39;</span>
<span class="c1"># catした文字を空白をあけて出力</span>
$<span class="w"> </span>cat<span class="w"> </span>file1.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import sys; [print(&quot; &quot;.join(l),end=&quot;&quot;) for l in sys.stdin]&#39;</span>
</pre></div>
</div>
</section>
<section id="linux">
<h3>linuxコマンド実行<a class="headerlink" href="#linux" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://monologu.com/python/module/subprocess/">Pythonからコマンドを実行する方法（subprocessモジュール） - アナグマのモノローグ</a></p></li>
</ul>
<p>コンソールで打った結果と同じものが出力される</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls -l&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>結果をpythonで取得したい場合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cgitb</span> <span class="kn">import</span> <span class="n">text</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">completed_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls -l&quot;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;returncode: </span><span class="si">{</span><span class="n">completed_process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stdout: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">completed_process</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stderr: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">completed_process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>標準エラー出力を標準出力へ向ける</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>
</pre></div>
</div>
<p>コマンドの出力結果を捨てる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
</pre></div>
</div>
<p>コマンドの標準入力にデータを渡す</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;foo</span><span class="se">\n</span><span class="s2">bar</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>ファイル読み書き<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-file-io-open-with/">Pythonでファイルの読み込み、書き込み（作成・追記） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;New file&#39;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># 複数行のテキストの場合は改行も込みで一括で読み込む</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># 文字列を一括で書き込む</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;New line 1</span><span class="se">\n</span><span class="s1">New line 2</span><span class="se">\n</span><span class="s1">New line 3&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># 行ごとにリスト形式で読み込み</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">l_strip1</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span> <span class="c1"># 改行コード削除</span>
    <span class="n">l_strip2</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="c1"># 改行だけの行も削除</span>
    
<span class="c1"># リストを行ごとに保存</span>
<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;One&#39;</span><span class="p">,</span> <span class="s1">&#39;Two&#39;</span><span class="p">,</span> <span class="s1">&#39;Three&#39;</span><span class="p">]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>

<span class="c1"># withを使わない場合は自分でcloseする</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># 開くときはxオプションだと既存ファイルがある場合はエラーになる</span>
<span class="c1"># aオプションだと末尾に追加</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_w</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Four&#39;</span><span class="p">)</span>

<span class="c1"># 空のファイルを作成する</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp/empty.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<section id="utf-8-bom">
<h4>UTF-8 BOM付で保存<a class="headerlink" href="#utf-8-bom" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/kino15/items/c9c06bdfc8e4a6ad34e3">PythonでUTF-8 with BOMのCSVファイルを出力する - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">csv</span>

<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span>
<span class="n">output_data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;文字コードがBOM付きのUTF-8&quot;</span><span class="p">,</span><span class="s2">&quot;のCSVファイルが出力したい&quot;</span><span class="p">]</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./sample.csv&quot;</span>

<span class="k">def</span> <span class="nf">writecsv</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf_8_sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 改行コード（\n）を指定しておく</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
<span class="n">writecsv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="io">
<h3>IOモジュール<a class="headerlink" href="#io" title="Permalink to this heading"></a></h3>
<section id="id3">
<h4>メモリ上のデータをファイルオブジェクト化<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.haya-programming.com/entry/2018/07/03/042203">【python】io.StringIOは便利なので使いこなそう - 静かなる名辞</a></p></li>
<li><p>https://docs.python.org/ja/3/library/io.html#io.StringIO</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">number,name,score</span>
<span class="s2">1,hoge,100</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># StringIOをかませると恰もファイルのように読み込める</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span>

<span class="c1"># 書き込みもできる(ファイルの実体はないので、実際は何も起きない)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;hoge</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># バイナリデータの場合</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="url">
<h3>URL上のデータを保存<a class="headerlink" href="#url" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-download-web-images/">PythonでWeb上の画像などのファイルをダウンロード（個別・一括） | note.nkmk.me</a></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">urllib.request.urlopen()</span></code>が推奨</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">urllib.request.urlretrieve()</span></code>は廃止される可能性あり</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.error</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">web_file</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
            <span class="n">local_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">web_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="zip">
<h3>zipファイルの解凍<a class="headerlink" href="#zip" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-zipfile/">PythonでZIPファイルを圧縮・解凍するzipfile | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>

<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s1">&#39;archive_zipfile.zip&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;dir_out_extractall&#39;</span><span class="p">)</span> <span class="c1"># 省略するとカレントに解凍</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>archive_shutil_base
└──dir_zip
<span class="w">   </span>├──<span class="w"> </span>dir_sub
<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>file_sub.txt
<span class="w">   </span>└──<span class="w"> </span>file.txt
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># dir_zip自体は保存されない</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;archive_shutil&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;dir_zip&#39;</span><span class="p">)</span>

<span class="c1"># dir_zip自体は保存される</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;archive_shutil_base&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;dir_zip&#39;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="s1">&#39;archive_shutil.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_out&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>グローバル変数<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hoge</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">hoge</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hoge</span><span class="p">)</span> <span class="c1"># 100 ローカル変数扱い</span>
<span class="k">def</span> <span class="nf">boo</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">hoge</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hoge</span><span class="p">)</span> <span class="c1"># 10 グローバル変数扱い    </span>
</pre></div>
</div>
</section>
<section id="main">
<h3><code class="docutils literal notranslate"><span class="pre">__main__</span></code><a class="headerlink" href="#main" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-if-name-main/">Pythonのif <strong>name</strong> == ‘<strong>main</strong>’の意味と使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="print">
<h3>printの無効化<a class="headerlink" href="#print" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/8391411/how-to-block-calls-to-print">python - How to block calls to print? - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/6735917/redirecting-stdout-to-nothing-in-python">Redirecting stdout to “nothing” in python - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://www.lifewithpython.com/2019/03/python-disable-stdout-temporarily.html">Python Tips：出力を一時的に無効化したい - Life with Python</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">blockPrint</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">enablePrint</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;This will print&#39;</span><span class="p">)</span>
<span class="n">blockPrint</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This won&#39;t&quot;</span><span class="p">)</span>
<span class="n">enablePrint</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This will too&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>パイプ処理に対応<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<section id="id6">
<h4>受け取り<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.lifewithpython.com/2017/06/python-check-stdin-type.html">Python Tips：標準入力がどのように渡されているのかをチェックしたい - Life with Python</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/46901452/how-send-parameters-through-a-pipe-in-a-python-script-using-argparse">bash - How send parameters through a pipe in a python script using argparse? - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;標準入力から csv を読む</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;標準入力で与えられた csv を読み込む</span>
<span class="sd">    - 最初の 5 行だけ、ヘッダーなしで読み込む</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">csv_read_stdin</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rows: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">csv_read_stdin</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">is_headerless</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;標準入力から csv を読み込む</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;標準入力はパイプまたはリダイレクトで渡してください。</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">is_headerless</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">islice</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">header</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>read_csv.py
標準入力はパイプまたはリダイレクトで渡してください。
$<span class="w"> </span>python<span class="w"> </span>read_csv.py<span class="w"> </span><span class="s">&lt;&lt;EOS</span>
<span class="s">&gt; Takeda,Shingen</span>
<span class="s">&gt; Takeda,Katsuyori</span>
<span class="s">&gt; EOS</span>
Rows:<span class="w"> </span><span class="o">[[</span><span class="s1">&#39;Takeda&#39;</span>,<span class="w"> </span><span class="s1">&#39;Shingen&#39;</span><span class="o">]</span>,<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Takeda&#39;</span>,<span class="w"> </span><span class="s1">&#39;Katsuyori&#39;</span><span class="o">]]</span>
</pre></div>
</div>
<p>パイプ入力とオプション入力を両方扱うテンプレ</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--hoge&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--foo&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">FileType</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span> <span class="c1"># ?オプションで1個の引数を取る</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span> <span class="c1"># パイプから渡されるとis a tty == Falseとなる</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;args: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">hoge</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stdin: &quot;</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dump.py</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;aaa&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>dump.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>pype.py<span class="w"> </span>--hoge<span class="w"> </span>hogeee<span class="w"> </span>--foo<span class="w"> </span><span class="m">1000</span>
args:<span class="w">  </span>hogeee<span class="w"> </span><span class="m">1000</span>
stdin:<span class="w">  </span><span class="o">[</span><span class="s1">&#39;100&#39;</span>,<span class="w"> </span><span class="s1">&#39;aaa&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>余ってる引数も処理する(使う場面はあまりない)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--hoge&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--foo&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">)</span> <span class="c1"># 残りの引数をすべて取るオプション</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">FileType</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span> <span class="c1"># ?オプションで1個の引数を取る</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span> <span class="c1"># パイプから渡されるとis a tty == Falseとなる</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;args: &quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;args option: &quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">hoge</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stdin: &quot;</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>dump.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>pipe.py<span class="w"> </span>--hoge<span class="w"> </span>hogeee<span class="w"> </span>--foo<span class="w"> </span><span class="m">1000</span><span class="w"> </span>moo<span class="w"> </span>noo
args:<span class="w">  </span><span class="o">[</span><span class="s1">&#39;moo&#39;</span>,<span class="w"> </span><span class="s1">&#39;noo&#39;</span><span class="o">]</span>
args<span class="w"> </span>option:<span class="w">  </span>hogeee<span class="w"> </span><span class="m">1000</span>
stdin:<span class="w">  </span><span class="o">[</span><span class="s1">&#39;100&#39;</span>,<span class="w"> </span><span class="s1">&#39;aaa&#39;</span><span class="o">]</span>
</pre></div>
</div>
</section>
<section id="id7">
<h4>受け渡し<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://inokara.hateblo.jp/entry/2017/12/07/231057">Python スクリプトの標準出力をパイプでつなぐ時に気をつけたいこと - ようへいの日々精進XP</a></p></li>
</ul>
<p>処理中のprint文を常に受け取りたい場合は -u オプションを付ける</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">blockPrint</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">enablePrint</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;This will print&#39;</span><span class="p">)</span>
    <span class="n">blockPrint</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This won&#39;t&quot;</span><span class="p">)</span>
    <span class="n">enablePrint</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This will too&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-u<span class="w"> </span>hoge.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log.txt
</pre></div>
</div>
</section>
<section id="id8">
<h4>テンプレ<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h4>
<p>仕様</p>
<ul class="simple">
<li><p>send側でコマンドオプション込みで直接渡したい</p></li>
<li><p>receive側でもオプションの入力があった場合はそちらを優先する</p></li>
<li><p>オプショナルな引数がreceive側にある</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># send_no_opt.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hoge_input_from_send&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># send_opt.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hoge_input_from_send&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--foo&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;800&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># receive.py</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_args_sdtin</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">args_normal</span> <span class="o">=</span> <span class="n">parse_args_normal</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">args_stdin</span> <span class="o">=</span> <span class="n">parse_args_normal</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">add_optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_stdin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># コマンド入力で指定されたオプションがある場合はパイプラインの入力を上書き</span>
    <span class="k">if</span> <span class="n">args_normal</span><span class="o">.</span><span class="n">foo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args_stdin</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">args_normal</span><span class="o">.</span><span class="n">foo</span>
    <span class="k">return</span> <span class="n">args_stdin</span>

<span class="k">def</span> <span class="nf">parse_args_normal</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">add_optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">add_def</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">add_stdin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">add_optional</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;hoge&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--foo&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span> <span class="k">if</span> <span class="n">add_def</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_stdin</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">FileType</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">add_stdin</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">args_normal</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="c1"># 引数の結果を取得</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># パイプラインの入力取り込み</span>
        <span class="n">args_stdin_list</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="c1"># パイプライン入力値のリストを再度パース</span>
        <span class="n">args_normal</span> <span class="o">=</span> <span class="n">parse_args_normal</span><span class="p">(</span><span class="n">args_stdin_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args_normal</span>

<span class="k">def</span> <span class="nf">parse_args_with_pipe</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>  <span class="c1"># パイプ入力があるとき</span>
        <span class="n">args_whole</span> <span class="o">=</span> <span class="n">parse_args_sdtin</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># パイプないとき</span>
        <span class="n">args_whole</span> <span class="o">=</span> <span class="n">parse_args_normal</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args_whole</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">parse_args_with_pipe</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># テストケース</span>
python<span class="w"> </span>send_no_opt.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>receive.py<span class="w"> </span>--foo<span class="w"> </span><span class="m">300</span>
<span class="c1"># Namespace(foo=300, hoge=&#39;hoge_input_from_send&#39;)</span>

python<span class="w"> </span>send_no_opt.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>receive.py
<span class="c1"># Namespace(foo=100, hoge=&#39;hoge_input_from_send&#39;)</span>

python<span class="w"> </span>send_opt.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>receive.py<span class="w"> </span>--foo<span class="w"> </span><span class="m">300</span>
<span class="c1"># Namespace(foo=300, hoge=&#39;hoge_input_from_send&#39;)</span>

python<span class="w"> </span>send_opt.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>receive.py
<span class="c1"># Namespace(foo=800, hoge=&#39;hoge_input_from_send&#39;)</span>

python<span class="w"> </span>receive.py<span class="w"> </span>hoge_input
<span class="c1"># Namespace(foo=100, hoge=&#39;hoge_input&#39;)</span>

python<span class="w"> </span>receive.py<span class="w"> </span>hoge_input<span class="w"> </span>--foo<span class="w"> </span><span class="m">300</span>
<span class="c1"># Namespace(foo=300, hoge=&#39;hoge_input&#39;)</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h3>パス操作<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-os-basename-dirname-split-splitext/">Pythonでパス文字列からファイル名・フォルダ名・拡張子を取得、結合 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;subdir&#39;</span><span class="p">,</span> <span class="s1">&#39;filename.ext&#39;</span><span class="p">)</span> <span class="c1"># パスを結合</span>

</pre></div>
</div>
</section>
<section id="id10">
<h3>モジュールの動的リロード<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://techacademy.jp/magazine/19196">Pythonでモジュールをリロードする方法【初心者向け】 | TechAcademyマガジン</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3/library/importlib.html#importlib.reload">importlib — import の実装 — Python 3.9.2 ドキュメント</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">importlib</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">モジュール名</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>演算子のオーバーロード<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://pknight.hatenablog.com/entry/20170321/1490061276">Pythonでの演算子のオーバーロード - (void*)Pないと</a></p></li>
</ul>
<p>特殊メソッドを実装すると実現できる</p>
<section id="id12">
<h4>比較演算子<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__lt__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&lt;</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__le__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&lt;=</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__eq__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">==</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ne__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">!=</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__gt__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&gt;</span> <span class="n">other</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ge__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&gt;=</span> <span class="n">other</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">==</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">!=</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
<section id="id13">
<h4>算術演算子(左辺)<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h4>
<p>自身と同じクラスの新規オブジェクトとして返す</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__add__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__sub__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">-</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__mul__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__truediv__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">/</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__floordiv__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">//</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__mod__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__pow__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">**</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__lshift__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&lt;&lt;</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__rshift__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&gt;&gt;</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__and__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__xor__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">^</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__or__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">|</span> <span class="n">other</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">//</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">%</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">**</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">&amp;</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">^</span> <span class="mi">10</span>
<span class="n">x</span> <span class="o">|</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
<section id="id14">
<h4>算術演算子(右辺)<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__add__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__radd__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+</span> <span class="mi">10</span>
<span class="mi">10</span> <span class="o">+</span> <span class="n">x</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>算術代入演算子<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__iadd__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">+=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__isub__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">-=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__imul__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">*=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__itruediv__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">/=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ifloordiv__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">//=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__imod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__imod__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">%=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ipow__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">**=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__ilshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ilshift__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&lt;&lt;=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__irshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__irshift__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&gt;&gt;=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__iand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__iand__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">&amp;=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__ixor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ixor__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">^=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__ior__&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">|=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">*=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">/=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">//=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">%=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">**=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">&amp;=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">^=</span> <span class="mi">1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">|=</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="id16">
<h4>単項演算子<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__neg__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__pos__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;__invert__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">__x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="o">-</span><span class="n">x</span>
<span class="o">+</span><span class="n">x</span>
<span class="o">~</span><span class="n">x</span>
</pre></div>
</div>
</section>
</section>
<section id="id17">
<h3>三項演算子<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-if-conditional-expressions/">Pythonの三項演算子（条件演算子）でif文を一行で書く | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">条件式が真のときに評価される式</span> <span class="k">if</span> <span class="n">条件式</span> <span class="k">else</span> <span class="n">条件式が偽のときに評価される式</span>

<span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;even&#39;</span> <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;odd&#39;</span> <span class="c1"># 値を返す</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">3</span> <span class="c1"># 式を返す</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;even&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;odd&#39;</span><span class="p">)</span> <span class="c1"># 何も返さない</span>

<span class="c1"># for文で適当に進捗出したいとき</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">230</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">_</span>
</pre></div>
</div>
</section>
<section id="lambda">
<h3>lambda関数<a class="headerlink" href="#lambda" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-lambda-usage/">Pythonのlambda（ラムダ式、無名関数）の使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">名前</span><span class="p">(</span><span class="n">引数</span><span class="p">,</span> <span class="n">引数</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">式</span>

<span class="n">名前</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">引数</span><span class="p">,</span> <span class="n">引数</span><span class="p">,</span> <span class="o">...</span><span class="p">:</span> <span class="n">式</span>

<span class="c1"># e.g.</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="c1"># if文は三項演算子で使用可能</span>
<span class="n">get_odd_even</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;even&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;odd&#39;</span>

<span class="c1"># elseは必ず必要らしい</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_</span>
</pre></div>
</div>
</section>
<section id="map">
<h3>map関数<a class="headerlink" href="#map" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/conf8o/items/0cb02bc504b51af09099">【Python】mapの正しい使い方 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="p">(</span><span class="n">callable</span><span class="p">,</span> <span class="o">*</span><span class="n">iterable</span><span class="p">)</span>
<span class="nb">map</span><span class="p">(</span><span class="n">N個引数のあるfunction</span><span class="p">,</span> <span class="n">iterable1</span><span class="p">,</span> <span class="n">iterable2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">iterableN</span><span class="p">)</span>

<span class="c1"># 例</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span>  <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">)))</span>
<span class="c1"># [1, 2, 3, 4, 5]</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span> <span class="c1"># 辞書型はデフォルトはkeyのみ</span>
<span class="c1"># [&#39;aa&#39;, &#39;bb&#39;, &#39;cc&#39;, &#39;dd&#39;]</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="c1"># x[0]がkey, x[1]がitem</span>
<span class="c1"># [&#39;aa&#39;, &#39;bbb&#39;, &#39;ccccc&#39;, &#39;ddddddd&#39;]</span>
</pre></div>
</div>
<p>callable</p>
<ul class="simple">
<li><p>関数</p></li>
<li><p>()を付けて呼び出せるもの(クラスとか)</p></li>
</ul>
<p>iterable</p>
<ul class="simple">
<li><p>list</p></li>
<li><p>tuple</p></li>
<li><p>dict</p></li>
<li><p>str</p></li>
<li><p>ジェネレータ式(イテレータ)</p></li>
<li><p>mapオブジェクト(イテレータ)</p></li>
<li><p>fileオブジェクト(イテレータ)</p></li>
</ul>
</section>
<section id="id18">
<h3>ランダム<a class="headerlink" href="#id18" title="Permalink to this heading"></a></h3>
<section id="id19">
<h4>ランダムな小数、整数<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-random-randrange-randint/">Pythonでランダムな小数・整数を生成するrandom, randrange, randintなど | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># 0.0以上1.0未満の浮動小数点数float型の乱数</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<span class="c1"># 0.4496839011176701</span>

<span class="c1"># a &lt;= n &lt;= bまたはb &lt;= n &lt;= a）の浮動小数点数float型の乱数</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="c1"># 175.26585048238275</span>

<span class="c1"># 任意の範囲・ステップの整数</span>
<span class="c1"># randrange(start, stop, step)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="c1"># [10, 12, 14, 16, 18]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># 18</span>
</pre></div>
</div>
<p>特定の分布に従うものも作れる</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ベータ分布: random.betavariate()
指数分布: random.expovariate()
ガンマ分布: random.gammavariate()
ガウス分布: random.gauss()
対数正規分布: random.lognormvariate()
正規分布: random.normalvariate()
フォン・ミーゼス分布: random.vonmisesvariate()
パレート分布: random.paretovariate()
ワイブル分布: random.weibullvariate()
</pre></div>
</div>
<p>重複なしのリスト</p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-random-choice-sample-choices/">Pythonでリストからランダムに要素を選択するchoice, sample, choices | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># シードを固定すると再現可能になる</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># リスト, 取り出す個数</span>
<span class="c1"># [2, 4, 0]</span>
<span class="c1"># indexが重複しないだけなので、リスト内に重複値が元々入っていると値が重複する可能性あり</span>

<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># [6, 4, 3, 7, 5]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># [130, 190, 140, 150, 170]</span>
</pre></div>
</div>
<p>リストの生成</p>
<p>numpyを使った方がよい</p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-random/">NumPy, randomで様々な種類の乱数の配列を生成 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># 4以上10未満の3 x 3の配列の整数乱数</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># array([4, 7, 4])</span>
</pre></div>
</div>
</section>
</section>
<section id="id20">
<h3>組み合わせ<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h3>
<section id="id21">
<h4>順列・組み合わせ<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-math-factorial-permutations-combinations/">Pythonで階乗、順列・組み合わせを計算、生成 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
<section id="id22">
<h4>複数リストの直積<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-itertools-product/">Pythonで複数のリストの直積（デカルト積）を生成するitertools.product | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="c1"># (&#39;a&#39;, &#39;X&#39;) # タプル型になる</span>
    <span class="c1"># (&#39;a&#39;, &#39;Y&#39;)</span>
    <span class="c1"># ...</span>

<span class="c1"># この処理と同じ</span>
<span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">l1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">l2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>

<span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">))</span> <span class="c1"># list型で取得できる</span>
</pre></div>
</div>
</section>
</section>
<section id="functools">
<h3>functools<a class="headerlink" href="#functools" title="Permalink to this heading"></a></h3>
<section id="functools-reduce">
<h4>高階関数 functools.reduce()<a class="headerlink" href="#functools-reduce" title="Permalink to this heading"></a></h4>
<p>シーケンスデータ → 一つの値にまとめる処理に使える。sumとかの汎用系</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.lifewithpython.com/2018/09/python-reduce-applications.html">Python Tips： functools.reduce() を活用したい - Life with Python</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="k">def</span> <span class="nf">my_sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">reduce</span><span class="p">(</span><span class="n">my_sum</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="c1"># 10</span>
<span class="c1"># 1 2</span>
<span class="c1"># 3 3</span>
<span class="c1"># 6 4</span>

<span class="c1"># lambda使う場合</span>
<span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="lru-cache">
<h4>lru_cache<a class="headerlink" href="#lru-cache" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://smooth-pudding.hatenablog.com/entry/2021/03/27/145218">functools.py が革命的に便利そうなのでまとめてみた - ぷりんの雑記帳</a></p></li>
</ul>
<p>このデコレータをつけておくと、複数回同じ引数を入れたときに、最初の計算結果を即座に返すようになります。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="nd">@lru_cache</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</section>
</section>
<section id="id23">
<h3>最小公倍数・最大公約数<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-gcd-lcm/">Pythonで最大公約数と最小公倍数を算出・取得 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python3.8以前</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="c1"># 最小公倍数計算</span>
<span class="k">def</span> <span class="nf">lcm_pair</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">//</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_lcm</span><span class="p">(</span><span class="n">iter_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">lcm_pair</span><span class="p">,</span> <span class="n">iter_data</span><span class="p">)</span>

<span class="n">my_lcm</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># 12</span>
</pre></div>
</div>
</section>
<section id="type">
<h3>Typeヒント<a class="headerlink" href="#type" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://future-architect.github.io/articles/20201223/">2021年版Pythonの型ヒントの書き方 (for Python 3.9) | フューチャー技術ブログ</a></p></li>
<li><p><a class="reference external" href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html">Type hints cheat sheet (Python 3) — Mypy 0.812 documentation</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3/library/typing.html">typing — 型ヒントのサポート — Python 3.9.4 ドキュメント</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">])</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]]:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="k">pass</span>

<span class="c1"># 複数の戻り値返す場合はTupleで囲む</span>
<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]]:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="try-except">
<h3>例外処理 try/except<a class="headerlink" href="#try-except" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-try-except-else-finally/">Pythonの例外処理（try, except, else, finally） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3/tutorial/errors.html">8. エラーと例外 — Python 3.9.1 ドキュメント</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3/library/exceptions.html#bltin-exceptions">組み込み例外一覧</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/36077266/how-do-i-raise-a-filenotfounderror-properly">python - How do I raise a FileNotFoundError properly? - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># エラーを投げる</span>
<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;error!&quot;</span><span class="p">)</span>

<span class="c1"># システム終了以外のすべてのエラーをキャッチ</span>
<span class="k">def</span> <span class="nf">divide_exception</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span> <span class="c1"># エラーが発生しなかった場合の処理</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;always execute&quot;</span><span class="p">)</span> <span class="c1"># エラーが出ても出なくても必ず実行される</span>

<span class="c1"># ファイル存在確認を自前でやる(cv2とかはエラー出ないので)</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="n">file_hoge</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_hoge</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># 例外は複数指定可能</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;catch TypeError:&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c1"># 2つ以上の例外を一緒に補足したい場合</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>システム(ユーザーからの終了コマンドとか)による終了以外のすべて例外をキャッチ</p>
<p>開ける画像をすべて開くときの例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./data/temp/images/*&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">img_resize</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">img_resize</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_dir</span><span class="p">,</span> <span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;_half&#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<section id="id24">
<h4>デバッグとかで一時的に無効にしたいとき<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/13734567/how-can-i-quickly-disable-a-try-statement-in-python-for-testing">debugging - How can I quickly disable a try statement in python for testing? - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;foo&#39;</span>
    <span class="c1"># A lot more code...</span>
    <span class="nb">print</span> <span class="s1">&#39;bar&#39;</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>  <span class="c1"># デバッグ用フラグ</span>
        <span class="k">raise</span>  <span class="c1"># try-exceptがないときと同じエラーメッセージが確認できる</span>
</pre></div>
</div>
</section>
<section id="id25">
<h4>例外の再送<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://ja.foobarninja.com/python/raise/">Python「raise 例外を発生させる」| FooBarNinja</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">err01</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;try01&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error01!!&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">raise</span> <span class="c1"># 同じエラーが外側のtryにも伝播する</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success01&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finally01&quot;</span><span class="p">)</span>

        
<span class="k">def</span> <span class="nf">err02</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;try02&quot;</span><span class="p">)</span>
        <span class="n">err01</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error02!!&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success02&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finally02&quot;</span><span class="p">)</span>

<span class="n">err02</span><span class="p">()</span>
<span class="c1"># 出力:</span>
<span class="c1"># try02</span>
<span class="c1"># try01</span>
<span class="c1"># error01!! hoge</span>
<span class="c1"># finally01</span>
<span class="c1"># error02!! hoge</span>
<span class="c1"># finally02</span>
</pre></div>
</div>
</section>
</section>
<section id="id26">
<h3>正規表現<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-re-match-search-findall-etc/">Pythonの正規表現モジュールreの使い方（match、search、subなど） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-re-match-object-span-group/">Pythonの正規表現マッチオブジェクトでマッチした文字列や位置を取得 | note.nkmk.me</a></p></li>
</ul>
<section id="id27">
<h4>一致箇所を取り出す<a class="headerlink" href="#id27" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;001_hoge_foo.jpg&#39;</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]*)_(.*)_&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
<span class="c1"># (&#39;001&#39;, &#39;hoge&#39;)</span>

<span class="c1"># グループに名前を付けられる (?P&lt;グループ名&gt;検索条件)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;local&gt;[a-z]+)@(?P&lt;SLD&gt;[a-z]+)\.(?P&lt;TLD&gt;[a-z]+)&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">))</span>
<span class="c1"># aaa</span>

<span class="c1"># 辞書型で取得もできる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">())</span>
<span class="c1"># {&#39;local&#39;: &#39;aaa&#39;, &#39;SLD&#39;: &#39;xxx&#39;, &#39;TLD&#39;: &#39;com&#39;}</span>
</pre></div>
</div>
</section>
<section id="id28">
<h4>置換<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-str-replace-translate-re-sub/">Pythonで文字列を置換（replace, translate, re.sub, re.subn） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;aaa@xxx.com, bbb@yyy.com, ccc@zzz.net&#39;</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([a-z]+)@([a-z]+)\.com&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1@\2.net&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="c1"># \1で最初のグループ</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># aaa@xxx.net, bbb@yyy.net, ccc@zzz.net</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;local&gt;[a-z]+)@(?P&lt;SLD&gt;[a-z]+)\.com&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\g&lt;local&gt;@\g&lt;SLD&gt;.net&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="c1"># \g&lt;グループ名&gt;で指定できる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># aaa@xxx.net, bbb@yyy.net, ccc@zzz.net</span>
</pre></div>
</div>
</section>
<section id="id29">
<h4>検索<a class="headerlink" href="#id29" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;I am Sam&#39;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Sam&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*Sam&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="c1"># 正規表現</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id30">
<h4>否定表現<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://uxmilk.jp/50674">正規表現で文字列を含まない、否定の記述 | UX MILK</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>^<span class="o">(</span>?!.*abc<span class="o">)</span>.*$<span class="w"> </span><span class="c1"># abcを含まない行にマッチ</span>
^<span class="o">(</span>?!.*<span class="o">(</span>abc<span class="p">|</span>efg<span class="o">))</span>.*$<span class="w"> </span><span class="c1"># abcまたはefgを含まない行にマッチ</span>
^<span class="o">(</span>?!abc<span class="o">)</span>.*$<span class="w"> </span><span class="c1"># abcで始まらない行にマッチ</span>
^<span class="o">(</span>?!.*abc$<span class="o">)</span>.*$<span class="w"> </span><span class="c1"># abcで終わらない行にマッチ</span>
^<span class="o">(</span>?<span class="o">=</span>.*abc<span class="o">)(</span>?!.*def<span class="o">)</span>.*$<span class="w"> </span><span class="c1"># 「abc」を含み、「def」を含まない行にマッチ</span>
</pre></div>
</div>
</section>
</section>
<section id="id31">
<h3>文字列処理<a class="headerlink" href="#id31" title="Permalink to this heading"></a></h3>
<section id="id32">
<h4>検索<a class="headerlink" href="#id32" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-str-search/">Pythonで文字列を検索（〜を含むか判定、位置取得、カウント） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 文字列中に任意の文字列が含まれているか判定</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;I am Sam&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sam&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="c1"># True</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sam&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="c1"># False</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sam&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="c1"># True</span>

<span class="c1"># 任意の文字列の位置を取得 (複数マッチしても1個目だけ返す)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Sam&#39;</span><span class="p">))</span> <span class="c1"># 5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;XXX&#39;</span><span class="p">))</span> <span class="c1"># -1</span>


</pre></div>
</div>
</section>
<section id="id33">
<h4>結合<a class="headerlink" href="#id33" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-string-concat/">Pythonで文字列を連結・結合（+演算子、joinなど） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;間に挿入する文字列&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">連結したい文字列のリスト</span><span class="p">])</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id34">
<h4>置換<a class="headerlink" href="#id34" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-str-replace-translate-re-sub/">Pythonで文字列を置換（replace, translate, re.sub, re.subn） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;one two one two one&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span> <span class="c1"># one-two-one-two-one</span>
<span class="c1"># 空文字指定で削除</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="c1"># onetwoonetwoone</span>

<span class="c1"># 複数の文字列を一辺に置換</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;XXX&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;YYY&#39;</span><span class="p">))</span> <span class="c1"># XXX YYY XXX YYY XXX</span>

<span class="c1"># 改行文字を置換</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s_lines_multi</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span> <span class="c1"># [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s_lines_multi</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span> <span class="c1"># one-two-three</span>
</pre></div>
</div>
<section id="id35">
<h5>文字単位で置換<a class="headerlink" href="#id35" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;one two one two one&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">})))</span> <span class="c1"># One TwO One TwO One</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s1">&#39;o&#39;</span><span class="p">:</span> <span class="s1">&#39;XXX&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})))</span> <span class="c1"># XXXne wXXX XXXne wXXX XXXne</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span> <span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)))</span> <span class="c1"># Xe tYX Xe tYX Xe</span>

<span class="c1"># swap</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;ot&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">)))</span> <span class="c1"># tne owt tne owt tne</span>
</pre></div>
</div>
</section>
</section>
<section id="id36">
<h4>リストの値をダブルクォーテーションで出力<a class="headerlink" href="#id36" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://stackoverflow.com/questions/32606599/return-a-variable-in-a-python-list-with-double-quotes-instead-of-single</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<span class="c1"># [&quot;A&quot;, &quot;B&quot;]</span>
</pre></div>
</div>
</section>
<section id="join">
<h4>join<a class="headerlink" href="#join" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">'間に挿入する文字列'.join([連結したい文字列のリスト])</span></code></p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-string-concat/">Pythonで文字列を連結・結合（+演算子、joinなど） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="s1">&#39;ccc&#39;</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="c1"># aaa-bbb-ccc</span>
</pre></div>
</div>
</section>
<section id="split">
<h4>split<a class="headerlink" href="#split" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-split-rsplit-splitlines-re/">Pythonで文字列を分割（区切り文字、改行、正規表現、文字数） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s_blank</span> <span class="o">=</span> <span class="s1">&#39;one two     three</span><span class="se">\n</span><span class="s1">four</span><span class="se">\t</span><span class="s1">five&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s_blank</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="c1"># デフォルトではスペース、タブ、改行はまとめて区切る</span>
<span class="c1"># [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;, &#39;five&#39;]</span>


<span class="c1"># 任意の文字列で分割</span>
<span class="n">s_comma</span> <span class="o">=</span> <span class="s1">&#39;one,two,three,four,five&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s_comma</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
<span class="c1"># [&#39;one&#39;, &#39;two&#39;, &#39;three&#39;, &#39;four&#39;, &#39;five&#39;]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s_comma</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;three&#39;</span><span class="p">))</span>
<span class="c1"># [&#39;one,two,&#39;, &#39;,four,five&#39;]</span>
</pre></div>
</div>
</section>
</section>
<section id="pickle">
<h3>pickleテンプレート<a class="headerlink" href="#pickle" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;singer.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">hoge</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;singer.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">hoge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="breakpoint">
<h3>デバッグ breakpoint()<a class="headerlink" href="#breakpoint" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/nakkun/items/62cc704af729893783f1">PEP 553 – Built-in breakpoint()を試してみた - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">breakpoint</span><span class="p">()</span> <span class="c1"># デバッガで使えるコマンドはhelpコマンドで確認できる</span>
</pre></div>
</div>
<p>breakpointで専用の関数を実行できる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">breakpointhook</span> <span class="o">=</span> <span class="n">break_func</span>

<span class="k">def</span> <span class="nf">break_func</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;break!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">breakpoint</span><span class="p">()</span>
</pre></div>
</div>
<section id="id37">
<h4>よく使うコマンド<a class="headerlink" href="#id37" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://docs.python.org/ja/3/library/pdb.html</p>
<ul>
<li><p>s: 1行実行</p></li>
<li><p>n: 次の行が関数呼び出しの場合はreturnまで、それ以外はsと同じ(階層を潜ることはしない)</p></li>
<li><p>unt 行数: 引数なしでsと同じ。実行する行数を指定できる</p></li>
<li><p>r: 現在の関数のreturnまで実行</p></li>
<li><p>c: 次のブレークポイントまで実行</p></li>
<li><p>l: 前後の行を表示、詳細はリンク参照</p></li>
<li><p>a: 現在の関数の引数を表示</p></li>
<li><p>p 評価式: 結果を表示。変数指定すればprintと同じ</p></li>
<li><p>pp 評価式: pprint版</p></li>
<li><p>whatis 評価式: 型を表示</p></li>
<li><p>run [args…]: プログラムを再実行する</p></li>
<li><p>q: デバッガを終了する、プログラムは中断される</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id38">
<h3>処理時間計測<a class="headerlink" href="#id38" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://pg-chain.com/python-time-perf_counter">【Python】timeで経過時間を測定する(perf_counter) | 鎖プログラム</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 時間計測開始</span>
<span class="n">time_sta</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="c1"># 処理を書く（ここでは5秒停止する）</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># 時間計測終了</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="c1"># 経過時間（秒）</span>
<span class="n">tim</span> <span class="o">=</span> <span class="n">time_end</span><span class="o">-</span> <span class="n">time_sta</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tim</span><span class="p">)</span>
<span class="c1">#[結果] 4.99997752884417</span>
</pre></div>
</div>
</section>
<section id="id39">
<h3>日時取得<a class="headerlink" href="#id39" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/papi_tokei/items/43b1d15a6694f576486c">Pythonで日付操作を完全マスター！！ - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span> <span class="c1">#2019-09-08</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;year: </span><span class="si">{}</span><span class="s1">, month: </span><span class="si">{}</span><span class="s1">, day: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;現在時刻は</span><span class="si">{}</span><span class="s1">時</span><span class="si">{}</span><span class="s1">分</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">秒です&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">microsecond</span><span class="p">))</span> 
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span>

<span class="c1"># 現在時刻を取得する</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="c1"># isoフォーマットで出力(マイクロ秒あり)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span> <span class="c1"># 13:17:17.342040</span>
<span class="c1"># isoフォーマットで出力(マイクロ秒なし)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s1">&#39;seconds&#39;</span><span class="p">))</span> <span class="c1"># 13:17:17</span>

<span class="c1"># 任意の形式で出力</span>
<span class="c1"># 13時17分17.342040秒</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%-H時%-M分%-S.</span><span class="si">%f</span><span class="s1">秒&#39;</span><span class="p">))</span>

<span class="c1"># タイムスタンプ用</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%-H:%-M:%-S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># 指定の時刻で設定したいとき</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>これが一番便利</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># 現在時間を取得する</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

<span class="c1"># isoフォーマットで出力(マイクロ秒あり) マイクロ秒は6桁で固定？</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span> <span class="c1"># 2019-09-08T14:57:36.896772</span>
<span class="c1"># isoフォーマットで出力(マイクロ秒なし)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">timespec</span><span class="o">=</span><span class="s1">&#39;seconds&#39;</span><span class="p">))</span> <span class="c1"># 2019-09-08T14:57:36</span>

<span class="c1"># 任意の形式で出力</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y年%-m月</span><span class="si">%-d</span><span class="s1">日 %-H時%-M分%-S.</span><span class="si">%f</span><span class="s1">秒&#39;</span><span class="p">))</span> <span class="c1"># 2019年9月8日 14時57分36.896772秒</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">))</span> <span class="c1"># 20220106_171411</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S_</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span> <span class="c1"># 20220106_171411_469764</span>

<span class="c1"># 文字列から復元する フォーマットを指定すれば任意の形式でも扱える</span>
<span class="n">custome_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2019年9月8日 14時38分1秒&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y年%m月</span><span class="si">%d</span><span class="s1">日 %H時%M分%S秒&#39;</span><span class="p">)</span>
<span class="n">custome_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;20220106_171411_469764&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S_</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># isoformatから復元</span>
<span class="n">iso_str</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_str</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="unix">
<h3>UNIX時間<a class="headerlink" href="#unix" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-unix-time-datetime/">PythonでUNIX時間（エポック秒）と日時datetimeを相互変換 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="c1"># unix時間からdatetimeを作成</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="c1"># 1970-01-01 09:00:00</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span> <span class="c1"># 任意のdatetimeをunix時間に変換</span>
</pre></div>
</div>
</section>
<section id="sort">
<h3>sort<a class="headerlink" href="#sort" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-list-sort-sorted/">Pythonでリストをソートするsortとsortedの違い | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-key-sort-sorted-max-min/">Pythonのsorted()やmax()などで引数keyを指定 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/4331892/python-sort-this-dictionary-dict-in-dict">sorting - Python: sort this dictionary (dict in dict) - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">operator</span>

<span class="n">org_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">org_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># 元のリストがsortされる # [1, 2, 3, 4, 5]</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">org_list</span><span class="p">)</span> <span class="c1"># 元のリストは不変</span>

<span class="c1"># 辞書データの配列を特定のキーの値でsort</span>
<span class="n">l_dict</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">l_dict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;k1&#39;</span><span class="p">)))</span> <span class="c1"># [{&#39;k1&#39;: 1}, {&#39;k1&#39;: 2, &#39;k2&#39;: 10}, {&#39;k1&#39;: 3}]</span>

<span class="c1"># 入れ子の辞書をソート</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:{</span><span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;whatever&#39;</span><span class="p">},</span>  <span class="s1">&#39;b&#39;</span><span class="p">:{</span><span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;sort by k&#39;</span><span class="p">}</span> <span class="p">}</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;k&#39;</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># x[1]でitemsのvalueが取得できる</span>
<span class="c1">#  [(&#39;b&#39;, {&#39;b&#39;: &#39;sort by k&#39;, &#39;k&#39;: 2}), (&#39;a&#39;, {&#39;b&#39;: &#39;whatever&#39;, &#39;k&#39;: 1})]</span>
</pre></div>
</div>
</section>
<section id="list">
<h3>list<a class="headerlink" href="#list" title="Permalink to this heading"></a></h3>
<section id="id40">
<h4>初期化<a class="headerlink" href="#id40" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2次元配列の0初期化</span>
<span class="n">row</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">col</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span>
<span class="n">x</span><span class="p">[</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">col</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id41">
<h4>結合<a class="headerlink" href="#id41" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># [0, 1, 2]</span>
<span class="n">l</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">])</span> <span class="c1"># [0, 1, 2, 100, 101, 102]</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">l</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="insert">
<h4>insert<a class="headerlink" href="#insert" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-list-append-extend-insert/">Pythonでリスト（配列）に要素を追加するappend, extend, insert | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="c1"># [0, 1, 2]</span>

<span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="c1"># [100, 0, 1, 2]</span>

<span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="c1"># [100, 0, 1, 200, 2]</span>
</pre></div>
</div>
</section>
<section id="id42">
<h4>要素が入っているか判定<a class="headerlink" href="#id42" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-in-basic/">Pythonのin演算子でリストなどに特定の要素が含まれるか判定 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;c#&#39;</span><span class="p">]</span> 
<span class="k">if</span> <span class="s1">&#39;python&#39;</span> <span class="ow">in</span> <span class="n">prg</span><span class="p">:</span> <span class="c1"># タプルでもrangeでも可</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NO&#39;</span><span class="p">)</span>
    
<span class="k">if</span> <span class="s1">&#39;python&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prg</span><span class="p">:</span> <span class="c1"># 否定</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="id43">
<h4>要素の除外<a class="headerlink" href="#id43" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-list-clear-pop-remove-del/">Pythonでリスト（配列）の要素を削除するclear, pop, remove, del | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="n">l</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1"># 全クリア</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># インデックス指定して除外</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 末尾から指定可能 -1で末尾</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span> <span class="c1"># デフォルトは-1と同じ</span>

<span class="k">del</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># popせずに削除だけ行う</span>
<span class="k">del</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">del</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="k">del</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># スライス形式でも指定可能</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Dave&#39;</span><span class="p">]</span>
<span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span> <span class="c1"># 最初に一致した値を削除</span>

</pre></div>
</div>
</section>
<section id="id44">
<h4>ループ内で除外<a class="headerlink" href="#id44" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://thispointer.com/python-remove-elements-from-a-list-while-iterating/">Python: Remove elements from a list while iterating – thispointer.com</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_num</span> <span class="o">=</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">]</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">list_of_num</span><span class="p">):</span> <span class="c1"># コピーに対して除外判定を行うことでイテレータがずれるのを防ぐ</span>
    <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="mi">54</span> <span class="ow">or</span> <span class="n">elem</span> <span class="o">==</span> <span class="mi">55</span><span class="p">:</span>
        <span class="n">list_of_num</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list_of_num</span><span class="p">)</span> <span class="c1"># [51, 52, 53, 56, 57, 58, 59]</span>

<span class="c1"># 別手法</span>
<span class="n">list_of_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">list_of_num</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">54</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">!=</span><span class="mi">55</span><span class="p">]</span> <span class="c1"># if文で条件を満たすものだけの新しいリストを作成する</span>

<span class="c1"># 別手法</span>
<span class="n">list_of_num</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">num</span><span class="p">:</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">54</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">!=</span><span class="mi">55</span><span class="p">,</span> <span class="n">list_of_num</span><span class="p">))</span> <span class="c1"># filter関数を使用、Trueのものだけのリストができる</span>
</pre></div>
</div>
</section>
<section id="id45">
<h4>スライス<a class="headerlink" href="#id45" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-slice-usage/">Pythonのスライスによるリストや文字列の部分選択・代入 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># [20, 30, 40]</span>
</pre></div>
</div>
</section>
</section>
<section id="dict">
<h3>dict<a class="headerlink" href="#dict" title="Permalink to this heading"></a></h3>
<section id="id46">
<h4>キーがあるか判定<a class="headerlink" href="#id46" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-dict-in-values-items/">Pythonで辞書のキー・値の存在を確認、取得（検索） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;val2&#39;</span><span class="p">,</span> <span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="s1">&#39;val3&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1"># True</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;key5&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1"># True</span>
</pre></div>
</div>
</section>
<section id="id47">
<h4>キーから値を取得<a class="headerlink" href="#id47" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-dict-get/">Pythonの辞書のgetメソッドでキーから値を取得（存在しないキーでもOK） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;val2&#39;</span><span class="p">,</span> <span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="s1">&#39;val3&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key5&#39;</span><span class="p">,</span> <span class="s1">&#39;NO KEY&#39;</span><span class="p">))</span> <span class="c1"># NO KEY</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key5&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="c1"># 100</span>
</pre></div>
</div>
</section>
<section id="json">
<h4>jsonデータから読み込み<a class="headerlink" href="#json" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-json-load-dump/">PythonでJSONファイル・文字列の読み込み・書き込み | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># ファイルから読み込み</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/src/test.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># 文字列から読み込み (&#39;&#39;で囲まないといけない)</span>
<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s1">&#39;{&quot;hoge&quot;: &quot;foo&quot;, &quot;key&quot;: 100}&#39;</span><span class="p">)</span>
<span class="c1"># {&#39;hoge&#39;: &#39;foo&#39;, &#39;key&#39;: 100}</span>

<span class="c1"># リストも可能</span>
<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s1">&#39;[&quot;hoge&quot;, &quot;foo&quot;, 100]&#39;</span><span class="p">)</span>
<span class="c1"># [&#39;hoge&#39;, &#39;foo&#39;, 100]</span>
</pre></div>
</div>
</section>
<section id="id48">
<h4>結合<a class="headerlink" href="#id48" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-dict-add-update/">Pythonで辞書に要素を追加、辞書同士を連結（結合） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">d2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;k3&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;k4&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">d1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="c1"># {&#39;k1&#39;: 100, &#39;k2&#39;: 2, &#39;k3&#39;: 3, &#39;k4&#39;: 4}</span>

<span class="c1"># 複数一遍に結合</span>
<span class="n">d3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;k5&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;k6&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
<span class="n">d1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">d2</span><span class="p">,</span> <span class="o">**</span><span class="n">d3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="c1"># {&#39;k1&#39;: 1, &#39;k2&#39;: 2, &#39;k3&#39;: 3, &#39;k4&#39;: 4, &#39;k5&#39;: 5, &#39;k6&#39;: 6}</span>

<span class="c1"># 新しいデータを作成</span>
<span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">d1</span><span class="p">,</span> <span class="o">**</span><span class="n">d2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id49">
<h4>jsonデータで保存<a class="headerlink" href="#id49" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/dst/test2.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># ensure_ascii=Falseとすると日本語などがそのまま出力される</span>
</pre></div>
</div>
<p>文字列に変換する場合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dict_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># ensure_ascii=Falseとすると日本語などがそのまま出力される</span>
<span class="c1"># separators=(&#39;,&#39;, &#39;:&#39;) # 空白をなくしたい場合はこれをオプションに追加</span>
</pre></div>
</div>
</section>
<section id="keyvalue">
<h4>keyとvalueを反転<a class="headerlink" href="#keyvalue" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://stackoverflow.com/questions/1031851/how-do-i-exchange-keys-with-values-in-a-dictionary</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="copy">
<h4>copy<a class="headerlink" href="#copy" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.kiriukun.com/entry/20200417-cloning-a-dictionary-in-python-3">Python3.7 辞書をclone (ディープコピー) - キリウ君が読まないノート</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="c1"># 中身も丸っとコピーされる</span>
</pre></div>
</div>
</section>
</section>
<section id="tuple">
<h3>tuple<a class="headerlink" href="#tuple" title="Permalink to this heading"></a></h3>
<section id="id50">
<h4>同じ要素を複製<a class="headerlink" href="#id50" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="c1"># (1, 1, 1)</span>
</pre></div>
</div>
</section>
<section id="id51">
<h4>結合<a class="headerlink" href="#id51" title="Permalink to this heading"></a></h4>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># (1, 1, 2)</span>
</pre></div>
</div>
</section>
<section id="id52">
<h4>アンパック<a class="headerlink" href="#id52" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-tuple-list-unpack/">Pythonでタプルやリストをアンパック（複数の変数に展開して代入） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">t</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># 0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="c1"># 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1"># [2, 3, 4]</span>
</pre></div>
</div>
</section>
</section>
<section id="namedtuple">
<h3>namedtuple<a class="headerlink" href="#namedtuple" title="Permalink to this heading"></a></h3>
<p>データ構造を辞書型よりも簡単に記述できる。</p>
<p>imuutableなので、キーが追加されたり書き換えられたりすることがなく、安心。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/Seny/items/add4d03876f505442136">namedtupleで美しいpythonを書く！（翻訳） - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="n">Car</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Car&#39;</span> <span class="p">,</span> <span class="s1">&#39;color mileage&#39;</span><span class="p">)</span>
<span class="n">my_car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="mf">3812.4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_car</span><span class="o">.</span><span class="n">color</span><span class="p">)</span> <span class="c1"># &#39;red&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_car</span><span class="o">.</span><span class="n">mileage</span><span class="p">)</span> <span class="c1"># 3812.4</span>

<span class="n">my_car</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span> <span class="c1"># OrderedDict型へ変換</span>
</pre></div>
</div>
</section>
<section id="set">
<h3>set<a class="headerlink" href="#set" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-set/">Python, set型で集合演算（和集合、積集合や部分集合の判定など） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">s_union</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">|</span> <span class="n">s2</span> <span class="c1"># 和 |= も可</span>
<span class="n">s_intersection</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">&amp;</span> <span class="n">s2</span> <span class="c1"># 積</span>
<span class="n">s_difference</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span> <span class="c1"># 差</span>
</pre></div>
</div>
</section>
<section id="decorator">
<h3>decorator<a class="headerlink" href="#decorator" title="Permalink to this heading"></a></h3>
<section id="unique">
<h4>unique<a class="headerlink" href="#unique" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/56139511/what-does-the-unique-decorator-do-in-python">What does the &#64;unique decorator do in python? - Stack Overflow</a></p></li>
</ul>
<p>Enum用のデコレータ。値に重複があるとエラーを起こす (常に確認する)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">unique</span><span class="p">,</span> <span class="n">Enum</span>

<span class="nd">@unique</span>
<span class="k">class</span> <span class="nc">Mistake</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ONE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TWO</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">THREE</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">FOUR</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 重複があるとエラー</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Mistake</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="c1"># Mistake.ONE ONE 1</span>
</pre></div>
</div>
</section>
</section>
<section id="id53">
<h3>抽象クラスと継承<a class="headerlink" href="#id53" title="Permalink to this heading"></a></h3>
<p>仕様</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__</span></code>は継承先でも必要？(ないとエラーになるケースもあるっぽいが詳細不明)</p></li>
<li><p>引数の形は変えられる(けど変えない方がいい)</p></li>
<li><p>継承先で<code class="docutils literal notranslate"><span class="pre">super().__init__</span></code>内で他の関数を呼び出す場合、オーバーライドの結果は反映されている</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">MyABC</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">100</span>
    
    <span class="nd">@abstractmethod</span> <span class="c1"># これ付けると継承先は必ず実装しないといけない</span>
    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">+</span><span class="n">a</span>
    <span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">+</span><span class="mi">100</span>
    
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">MyABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span> <span class="c1"># 親メソッド使える, 完全に同じなら実装は不要???</span>
        
    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> <span class="c1"># 継承関数の引数は変えられる</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">foo</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">foo</span><span class="o">.</span><span class="n">hoge</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># オーバーライドしない場合はスーパークラスがそのまま使える</span>
</pre></div>
</div>
</section>
<section id="id54">
<h3>静的メソッドの指定<a class="headerlink" href="#id54" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/msrks/items/fdc9afd12effc2cba1bc">Pythonで classmethod、staticmethod を使う - Qiita</a></p>
<ul>
<li><p>可読性が上がるだけ</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Student</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">school</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">school</span> <span class="o">=</span> <span class="n">school</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;平均成績を返す</span>

<span class="sd">        インスタンス変数にアクセスしたいのでinstancemethodを使う。</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">marks</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">friend</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">friend_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;同じ学校の友達を追加する。</span>

<span class="sd">        継承クラスで動作が変わるべき(継承クラスでは salaryプロパティがある)</span>
<span class="sd">        なのでclassmethodを使う。</span>
<span class="sd">        子クラスの初期化引数は *argsで受けるのがいい</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">friend_name</span><span class="p">,</span> <span class="n">origin</span><span class="o">.</span><span class="n">school</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;先生に挨拶する</span>

<span class="sd">        継承しても同じ動きでいいのでstaticmethodを使う</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello Teacher!&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">WorkingStudent</span><span class="p">(</span><span class="n">Student</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">school</span><span class="p">,</span> <span class="n">salary</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">school</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salary</span> <span class="o">=</span> <span class="n">salary</span>

<span class="n">hiro</span> <span class="o">=</span> <span class="n">WorkingStudent</span><span class="p">(</span><span class="s2">&quot;Hiro&quot;</span><span class="p">,</span> <span class="s2">&quot;Stanford&quot;</span><span class="p">,</span> <span class="mf">20.00</span><span class="p">)</span>
<span class="n">mitsu</span> <span class="o">=</span> <span class="n">WorkingStudent</span><span class="o">.</span><span class="n">friend</span><span class="p">(</span><span class="n">hiro</span><span class="p">,</span> <span class="s2">&quot;Mitsu&quot;</span><span class="p">,</span> <span class="mf">15.00</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mitsu</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bytesio">
<h3>BytesIO<a class="headerlink" href="#bytesio" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://recruit.gmo.jp/engineer/jisedai/blog/python_standard_io_with_bytesio/">pythonのBytesIOによる標準入出力の再構築とパフォーマンス検証 | GMOインターネットグループ 次世代システム研究室</a></p></li>
</ul>
</section>
<section id="gcs">
<h3>GCS<a class="headerlink" href="#gcs" title="Permalink to this heading"></a></h3>
<p>アップロード</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;This utility code is for uploading result image data to google storage bucket</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">storage</span>

<span class="k">def</span> <span class="nf">upload_to_google_storage</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_dir_path</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">gcs_upload_folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credential_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ref:</span>
<span class="sd">        https://cloud.google.com/storage/docs/uploading-objects#storage-upload-object-code-sample</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">credential_path</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
    <span class="n">bucket_name</span> <span class="o">=</span> <span class="s2">&quot;hoge&quot;</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">gcs_upload_folder_path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">file_dir_path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> 
</pre></div>
</div>
</section>
<section id="id55">
<h3>データクラス<a class="headerlink" href="#id55" title="Permalink to this heading"></a></h3>
<p>構造体クラスをpythonで作るときに便利</p>
</section>
<section id="id56">
<h3>大文字小文字変換<a class="headerlink" href="#id56" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 文字列型に対してlowerメソッドを実行する</span>
<span class="n">normal_str1</span> <span class="o">=</span> <span class="s2">&quot;Hello World!&quot;</span>
<span class="n">lower_str1</span> <span class="o">=</span> <span class="n">normal_str1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lower_str1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is">
<h3>is と == の違い<a class="headerlink" href="#is" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://python.ms/is-and-equal/">Python の is と == の違い | 民主主義に乾杯</a></p></li>
<li><p><a class="reference external" href="https://cyanatlas.hatenablog.com/entry/2020/07/03/033039">[Python][Numpy] 組み込みのboolとNumpy.bool_は別物 - 青色の地図帳</a></p></li>
<li><p>isはオブジェクトのIDを比較</p></li>
<li><p>==はオブジェクトの値を比較</p></li>
<li><p>True, False, Noneの3種類は常に同一のオブジェクトを返すので、isで比較するべきらしい</p></li>
<li><p><strong>ただし、numpyのbool型のTrue, Falseは<code class="docutils literal notranslate"><span class="pre">numpy.bool_</span></code>型なのでisを使っても期待する結果にならない</strong></p>
<ul>
<li><p>bool()でキャスト</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">==</span></code>を使う (エディタで注意されるときはコメントで<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">NOQA</span></code>をつける)</p></li>
</ul>
</li>
</ul>
</section>
<section id="id57">
<h3>環境変数を取得・設定・削除<a class="headerlink" href="#id57" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-os-environ-getenv/">Pythonで環境変数を取得・追加・上書き・削除（os.environ） | note.nkmk.me</a></p></li>
</ul>
<p>環境変数はpythonのプログラムが起動した時点のもので固定される。</p>
<p><code class="docutils literal notranslate"><span class="pre">os.environ</span></code>の環境変数を変更（設定・削除）してもシステムの環境変数が変更されるわけではないが、プログラム中で起動されるサブプロセスには影響を与える。</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">HOGE</span><span class="o">=</span><span class="m">2000</span><span class="w"> </span><span class="c1"># シェル上で設定</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEW_KEY&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span> <span class="c1"># NEW_KEYがなければdefaultの値を返す</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NEW_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span> <span class="c1"># 値がセットされる</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;NEW_KEY&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># 削除、第二引数を指定すると存在しない変数を指定してもエラーにならない</span>
</pre></div>
</div>
<section id="dotenv">
<h4>dotenv<a class="headerlink" href="#dotenv" title="Permalink to this heading"></a></h4>
<p>環境変数を読み込むためのライブラリ</p>
<ul class="simple">
<li><p>https://pypi.org/project/python-dotenv/</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>python-dotenv
</pre></div>
</div>
<p>環境変数を定義する<code class="docutils literal notranslate"><span class="pre">dev.env</span></code>ファイルを作成</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BASE_URL</span><span class="o">=</span><span class="s2">&quot;https://api-gateway-hoge&quot;</span>
<span class="n">X_API_KEY</span><span class="o">=</span><span class="s2">&quot;hogehoge&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">dotenv_values</span><span class="p">,</span> <span class="n">load_dotenv</span>

<span class="c1"># 任意のenvファイルを環境変数として読み込む</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="s2">&quot;dev.env&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;BASE_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="c1"># hogehoge になっている</span>

<span class="c1"># 環境変数としてではなく、辞書型の変数として読み込むだけ</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">dotenv_values</span><span class="p">(</span><span class="s2">&quot;dev.env&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>シェル上で読みたい場合は<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">hoge.env</span></code>では読み込めない(環境変数扱いにならない)。
以下のようにする</p>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/19331497/set-environment-variables-from-file-of-key-value-pairs">bash - Set environment variables from file of key/value pairs - Stack Overflow</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>.env<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="k">$(</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^#&#39;</span><span class="w"> </span>.env<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span><span class="w"> </span><span class="c1"># #始まりは無視したいとき</span>
<span class="nb">unset</span><span class="w"> </span><span class="k">$(</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^#&#39;</span><span class="w"> </span>.env<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;s/(.*)=.*/\1/&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="k">)</span><span class="w"> </span><span class="c1"># unsetしたいとき</span>
</pre></div>
</div>
</section>
</section>
<section id="enum">
<h3>Enum<a class="headerlink" href="#enum" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/macinjoke/items/13aa9ba64cf9b688e74a">enum 超まとめ python3.10 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3.9/library/enum.html">enum — 列挙型のサポート — Python 3.9.12 ドキュメント</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">print_color</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Color is red&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Color is green&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLUE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Color is blue&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;not Color enum&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">print_color</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>  <span class="c1"># Color is blue</span>
    <span class="n">print_color</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># not Color enum # Enum型とint型の比較はできない</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># Color.RED</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>  <span class="c1"># True</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">)</span>  <span class="c1"># False</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">Color</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>  <span class="c1"># Color.RED\nColor.GREEN\nColor.BLUE</span>
</pre></div>
</div>
<section id="id58">
<h4>複合型<a class="headerlink" href="#id58" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IntEnum</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span> <span class="c1"># プリセットのIntEnumと同じ</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">StrEnum</span><span class="p">(</span><span class="nb">str</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">IntEnum</span>

<span class="k">class</span> <span class="nc">Shape</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">CIRCLE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SQUARE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span> <span class="c1"># 他のIntEnumとは比較できるが、Enumとは比較できない</span>
    <span class="n">POST</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GET</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">Shape</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># False</span>
<span class="n">Shape</span><span class="o">.</span><span class="n">CIRCLE</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># True</span>
<span class="n">Shape</span><span class="o">.</span><span class="n">CIRCLE</span> <span class="o">==</span> <span class="n">Request</span><span class="o">.</span><span class="n">POST</span> <span class="c1"># True</span>
</pre></div>
</div>
</section>
</section>
<section id="asyncio">
<h3>asyncio<a class="headerlink" href="#asyncio" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/pn11/items/c6c49a1a50009e373fc6">寿司で理解する Python asyncio - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/everylittle/items/57da997d9e0507050085">[Python] asyncioに入門してみたメモ - Qiita</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/56161595/how-to-use-async-for-in-python">asynchronous - How to use <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">for</span></code> in Python? - Stack Overflow</a></p></li>
</ul>
</section>
<section id="id59">
<h3>並列・並行処理まとめ<a class="headerlink" href="#id59" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/simonritchie/items/1ce3914eb5444d2157ac">Pythonの並列処理・並行処理をしっかり調べてみた - Qiita</a></p></li>
</ul>
<section id="id60">
<h4>並行処理(マルチスレッド(シングルプロセス))<a class="headerlink" href="#id60" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>複数の関数を1つのプロセス(コア)内で動かせる</p></li>
<li><p>GIL(Global Interpreter Lock)という排他ロックの仕組みがあるので、メモリを安全に扱えるが、速度は速くならない</p></li>
<li><p>基本的にトータルの処理速度は速くならない</p>
<ul>
<li><p>使う場面は時間のかかる処理をしているときにUIの簡単な応答だけ返したいときとか、スリープが入る処理と他の処理を同時に進めるときとか</p></li>
</ul>
</li>
<li><p>モジュールはthreading, concurrent.futuresを利用</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">sample_func</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: </span><span class="si">%s</span><span class="s1"> started.&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">sleep_seconds</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_seconds</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: </span><span class="si">%s</span><span class="s1"> ended.&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>

<span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sample_func</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="c1"># 第2引数以降に関数の引数を指定</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">future_list</span><span class="p">)</span> <span class="c1"># 全ての関数が完了するまで待機する場合はsubmitの戻り値のリストを渡す</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;completed.&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">future_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">done</span><span class="p">())</span> <span class="c1"># True # 各スレッドの状態が分かる</span>
</pre></div>
</div>
</section>
<section id="id61">
<h4>並列処理(マルチプロセス)<a class="headerlink" href="#id61" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>複数のコアで計算を行う</p></li>
<li><p>メモリの共有がダイレクトにできない。共有するためにはshared memoryの設定が必要</p></li>
<li><p>例えると道路の車線を横に増やす</p></li>
<li><p>モジュールは基本的にmultiprocessingもしくはconcurrent.futuresを利用</p>
<ul>
<li><p>multiprocessingにはさらにProcessやPoolといったように複数の選択肢がある</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">sample_func</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: </span><span class="si">%s</span><span class="s1"> started.&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">sleep_seconds</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_seconds</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: </span><span class="si">%s</span><span class="s1"> ended.&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>

<span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># 並行処理のconcurrent.futuresのサンプルのThreadPoolExecutorの箇所をProcessPoolExecutorに変えるだけ</span>
<span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sample_func</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="c1"># 第2引数以降に関数の引数を指定</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">future_list</span><span class="p">)</span> <span class="c1"># 全ての関数が完了するまで待機する場合はsubmitの戻り値のリストを渡す</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;completed.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="thread">
<h3>thread (並列処理)<a class="headerlink" href="#thread" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/tchnkmr/items/b05f321fa315bbce4f77">[Python] スレッドで実装する - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/simonritchie/items/1ce3914eb5444d2157ac">Pythonの並列処理・並行処理をしっかり調べてみた - Qiita</a></p></li>
</ul>
<section id="threading">
<h4>threading<a class="headerlink" href="#threading" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">boil_udon</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんを茹でます。&#39;</span><span class="p">)</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんが茹であがりました。&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_tuyu</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ツユをつくります。&#39;</span><span class="p">)</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  ツユができました。&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんを作ります。&#39;</span><span class="p">)</span>
<span class="n">thread1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">boil_udon</span><span class="p">)</span>
<span class="n">thread2</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">make_tuyu</span><span class="p">)</span>
<span class="n">thread1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="c1"># thread1が完了するまで待機</span>
<span class="n">thread2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="c1"># thread2が完了するまで待機</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;盛り付けます。&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんができました。&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="threadpoolexecutor">
<h4>ThreadPoolExecutor<a class="headerlink" href="#threadpoolexecutor" title="Permalink to this heading"></a></h4>
<p>スレッドの並列数の上限を制限できる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span> <span class="c1"># マルチスレッド</span>
<span class="c1"># from concurrent.futures import ProcessPoolExecutor # マルチプロセス</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">boil_udon</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんを茹でます。&#39;</span><span class="p">)</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんが茹であがりました。&#39;</span><span class="p">)</span>

<span class="n">tpe</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんを10個茹でます。&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">tpe</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">boil_udon</span><span class="p">)</span> <span class="c1"># 今回は10個同じ関数を並列処理させる</span>
    <span class="c1"># 10個同時に登録してもmax_workersまでしか同時に実行されない</span>

<span class="n">tpe</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span> <span class="c1"># すべて完了するまで待機</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんが100個茹で上がりました。&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># with文使う場合</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">boil_udon</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんを茹でます。&#39;</span><span class="p">)</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  うどんが茹であがりました。&#39;</span><span class="p">)</span>

<span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんを10個茹でます。&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">boil_udon</span><span class="p">)</span> <span class="c1"># 今回は10個同じ関数を並列処理させる</span>
        <span class="c1"># 10個同時に登録してもmax_workersまでしか同時に実行されない</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="n">future_list</span><span class="p">)</span> <span class="c1"># 完了待ちする</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;うどんが10個茹で上がりました。&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="future">
<h4>Future<a class="headerlink" href="#future" title="Permalink to this heading"></a></h4>
<p>ThreadPoolExecutorとかで各スレッド関数の結果を受け取りたいとき</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">make_udon</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんを作ります(</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">秒かかります)&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんできました&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kind</span> <span class="o">+</span> <span class="s1">&#39;うどん&#39;</span>

<span class="n">kinds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;たぬき&#39;</span><span class="p">,</span> <span class="s1">&#39;かけ&#39;</span><span class="p">,</span> <span class="s1">&#39;ざる&#39;</span><span class="p">,</span> <span class="s1">&#39;きつね&#39;</span><span class="p">,</span> <span class="s1">&#39;天ぷら&#39;</span><span class="p">,</span> <span class="s1">&#39;肉&#39;</span><span class="p">]</span>
<span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kinds</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">うどん オーダー入りました。&#39;</span> <span class="o">%</span> <span class="n">kind</span><span class="p">)</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">make_udon</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">time_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">お待たせしました。&#39;</span> <span class="o">%</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span> <span class="c1"># resultはthredingのjoinと同じで結果が来るまで待機する</span>

<span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 上記の改良版</span>
<span class="c1"># スレッドが完了したものから順次結果を表示していく</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">make_udon</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんを作ります(</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">秒かかります)&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんできました&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kind</span> <span class="o">+</span> <span class="s1">&#39;うどん&#39;</span>

<span class="n">kinds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;たぬき&#39;</span><span class="p">,</span> <span class="s1">&#39;かけ&#39;</span><span class="p">,</span> <span class="s1">&#39;ざる&#39;</span><span class="p">,</span> <span class="s1">&#39;きつね&#39;</span><span class="p">,</span> <span class="s1">&#39;天ぷら&#39;</span><span class="p">,</span> <span class="s1">&#39;肉&#39;</span><span class="p">]</span>
<span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kinds</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">うどん オーダー入りました。&#39;</span> <span class="o">%</span> <span class="n">kind</span><span class="p">)</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">make_udon</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">time_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span> <span class="c1"># listのコピー作ってイテレータのずれを防ぐ</span>
        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">お待たせしました。&#39;</span> <span class="o">%</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;完了&quot;</span><span class="p">)</span>
<span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 上記のwith文使った場合</span>
<span class="c1"># スレッドが完了したものから順次結果を表示していく</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">make_udon</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんを作ります(</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">秒かかります)&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんできました&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kind</span> <span class="o">+</span> <span class="s1">&#39;うどん&#39;</span>

<span class="n">kinds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;たぬき&#39;</span><span class="p">,</span> <span class="s1">&#39;かけ&#39;</span><span class="p">,</span> <span class="s1">&#39;ざる&#39;</span><span class="p">,</span> <span class="s1">&#39;きつね&#39;</span><span class="p">,</span> <span class="s1">&#39;天ぷら&#39;</span><span class="p">,</span> <span class="s1">&#39;肉&#39;</span><span class="p">]</span>
<span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kinds</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">うどん オーダー入りました。&#39;</span> <span class="o">%</span> <span class="n">kind</span><span class="p">)</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">make_udon</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">time_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span> <span class="c1"># listのコピー作ってイテレータのずれを防ぐ</span>
            <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">お待たせしました。&#39;</span> <span class="o">%</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
                <span class="n">futures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;完了&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/tag1216/items/db5adcf1ddcb67cfefc8">Pythonでconcurrent.futuresを使った並列タスク実行 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">make_udon</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんを作ります(</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">秒かかります)&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">うどんできました&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kind</span> <span class="o">+</span> <span class="s1">&#39;うどん&#39;</span>

<span class="n">kinds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;たぬき&#39;</span><span class="p">,</span> <span class="s1">&#39;かけ&#39;</span><span class="p">,</span> <span class="s1">&#39;ざる&#39;</span><span class="p">,</span> <span class="s1">&#39;きつね&#39;</span><span class="p">,</span> <span class="s1">&#39;天ぷら&#39;</span><span class="p">,</span> <span class="s1">&#39;肉&#39;</span><span class="p">]</span>
<span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">make_udon</span><span class="p">,</span> <span class="n">kinds</span><span class="p">,</span> <span class="n">time_list</span><span class="p">)</span> <span class="c1"># mapだと一括でスレッド生成できる</span>

<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span> <span class="c1"># 全て終わるまでここで待機される</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">お待たせしました。&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>

<span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id62">
<h3>スレッド無限ループ<a class="headerlink" href="#id62" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/11436502/closing-all-threads-with-a-keyboard-interrupt">python - Closing all threads with a keyboard interrupt - Stack Overflow</a></p></li>
</ul>
<p>無限ループのスレッドでキー割込みを管理したいときはEventオブジェクトをスレッドに渡して、状態を制御する</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">timed_output</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">run_event</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">run_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;: New Message!&quot;</span><span class="p">)</span>

<span class="n">run_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<span class="n">run_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">timed_output</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">run_event</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">timed_output</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;paul&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">run_event</span><span class="p">))</span>

<span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">run_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;threads successfully closed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id63">
<h3>マルチプロセス (並行処理)<a class="headerlink" href="#id63" title="Permalink to this heading"></a></h3>
<section id="fork">
<h4>fork<a class="headerlink" href="#fork" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/y518gaku/items/db3b0ced6d62b616f961">【Python】マルチプロセスについて - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="n">pid_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="n">child_pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span> <span class="c1"># 子プロセスはメモリを共有しない</span>

    <span class="k">if</span> <span class="n">child_pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;子: こんにちは，私は子プロセスです&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;子: 私が知っているPID番号は　</span><span class="si">%s</span><span class="s2"> です&quot;</span> <span class="o">%</span> <span class="n">pid_list</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;child working...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;親:こんにちは，私は親プロセスです&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;親:子プロセスのPID番号は </span><span class="si">%d</span><span class="s2"> です&quot;</span><span class="o">%</span><span class="n">child_pid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;親:私が知っているPID番号は </span><span class="si">%s</span><span class="s2"> です&quot;</span><span class="o">%</span><span class="n">pid_list</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;子プロセスを殺します&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">child_pid</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span> <span class="c1"># killする</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parent working...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># プロセスにKeyboardInterruptを送って中断させる</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="n">pid_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="n">child_pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">child_pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;子: 私が知っているPID番号は　</span><span class="si">%s</span><span class="s2"> です&quot;</span> <span class="o">%</span> <span class="n">pid_list</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;child working...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exit process&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">pid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;親:子プロセスのPID番号は </span><span class="si">%d</span><span class="s2"> です&quot;</span><span class="o">%</span><span class="n">child_pid</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;親:私が知っているPID番号は </span><span class="si">%s</span><span class="s2"> です&quot;</span><span class="o">%</span><span class="n">pid_list</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;子プロセスを殺します&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">child_pid</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parent working...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="processpoolexecutor">
<h4>ProcessPoolExecutor<a class="headerlink" href="#processpoolexecutor" title="Permalink to this heading"></a></h4>
<p>ThreadPoolExecutorのサンプルをProcessPoolExecutorに替えるだけ</p>
</section>
</section>
<section id="profiling">
<h3>Profiling<a class="headerlink" href="#profiling" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://kazuhira-r.hatenablog.com/entry/2019/04/13/173643">Python標準のcProfile、profileを使ってプロファイリングを試す - CLOVER🍀</a></p></li>
<li><p><a class="reference external" href="https://blog.amedama.jp/entry/2016/08/30/214718">Python: profile/cProfile モジュールでボトルネックを調べる - CUBE SUGAR CONTAINER</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">heavy_loop</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">500000000</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">calc</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;executed </span><span class="si">%d</span><span class="s2"> loop&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calc</span><span class="p">():</span>
    <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World!!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">fib_num</span><span class="p">,</span> <span class="n">heavy_loop_num</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fib(</span><span class="si">%d</span><span class="s2">) = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fib_num</span><span class="p">,</span><span class="n">fib</span><span class="p">(</span><span class="n">fib_num</span><span class="p">)))</span>
    <span class="n">heavy_loop</span><span class="p">(</span><span class="n">heavy_loop_num</span><span class="p">)</span>
    <span class="n">hello_world</span><span class="p">()</span>

<span class="n">task</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># 関数内の処理にかかってる順で出力される(関数内で他の関数を呼んでいる時間は除いている)</span>
python<span class="w"> </span>-m<span class="w"> </span>cProfile<span class="w"> </span>-s<span class="w"> </span>tottime<span class="w"> </span>profiling-example.py<span class="w"> </span>&gt;<span class="w"> </span>prof.txt<span class="w"> </span><span class="c1"># 分量がすごく多いのでリダイレクトして確認する方がいい</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nitta:~/prof_test $ python -m cProfile -s tottime profiling-example.py
fib(30) = 832040
executed 10000000 loop
Hello World!!
         12692546 function calls (10000010 primitive calls) in 2.672 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    1.429    1.429    1.973    1.973 profiling-example.py:9(heavy_loop)
2692537/1    0.698    0.000    0.698    0.698 profiling-example.py:1(fib)
 10000000    0.544    0.000    0.544    0.000 profiling-example.py:15(calc)
        3    0.000    0.000    0.000    0.000 {built-in method builtins.print}
        1    0.000    0.000    2.672    2.672 profiling-example.py:21(task)
        1    0.000    0.000    2.672    2.672 profiling-example.py:1(&lt;module&gt;)
        1    0.000    0.000    2.672    2.672 {built-in method builtins.exec}
        1    0.000    0.000    0.000    0.000 profiling-example.py:18(hello_world)
        1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
</pre></div>
</div>
</section>
<section id="id64">
<h3>メモリ使用量の確認<a class="headerlink" href="#id64" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://blog.amedama.jp/entry/2018/02/04/001950">Python: memory_profiler でプログラムのメモリ使用量を調べる - CUBE SUGAR CONTAINER</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>memory_profiler
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">memory_profiler</span> <span class="kn">import</span> <span class="n">profile</span>

<span class="nd">@profile</span> <span class="c1"># 付けると解析対象</span>
<span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span> <span class="c1"># 整数の入った大きなリストを用意する</span>
    <span class="k">del</span> <span class="n">a</span> <span class="c1"># 変数を削除する</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span> <span class="c1"># 先ほどより少し小さなリストを用意する</span>
    <span class="k">del</span> <span class="n">b</span> <span class="c1"># 変数を削除する</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">my_func</span><span class="p">()</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="tqdm">
<h3>tqdm プログレスバー<a class="headerlink" href="#tqdm" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://tqdm.github.io/</p></li>
<li><p><a class="reference external" href="https://qiita.com/pontyo4/items/76145cb10e030ad8186a">tqdmでプログレスバーを表示させる - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/SeeLog/items/73c054a37722890b17a2">グレートなtqdmの使い方 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://www.kimoton.com/entry/20190830/1567128952">【Python】 tqdmでプログレスバーを表示してみた - ばいばいバイオ</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)):</span> <span class="c1"># rangeを囲む</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span> <span class="c1"># リストでも可</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># プログレスバーに表示する文字を変えるとき(ファイル名とか)</span>
<span class="n">prog_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">prog_bar</span><span class="p">:</span>
    <span class="n">prog_bar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># print文を表示してもバーの残骸が残らないようにするとき</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Progress&#39;</span><span class="p">):</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
	<span class="n">tqdm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;loop: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id65">
<h3>四捨五入<a class="headerlink" href="#id65" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-round-decimal-quantize/">Pythonで小数・整数を四捨五入するroundとDecimal.quantize | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">ROUND_HALF_UP</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">0.456</span>
<span class="n">dec_val</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="c1"># float型を厳密に処理したいときは一旦文字列にする</span>
<span class="n">dec_round</span> <span class="o">=</span> <span class="n">dec_val</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.1&#39;</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">)</span> <span class="c1"># Decimalオブジェクトで四捨五入結果が返される</span>
<span class="nb">float</span><span class="p">(</span><span class="n">dec_round</span><span class="p">)</span> <span class="c1"># 0.5</span>

<span class="c1"># まとめたバージョン</span>
<span class="nb">float</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.1&#39;</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_UP</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="ellipsis">
<h3>… (Ellipsis)<a class="headerlink" href="#ellipsis" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://blog.amedama.jp/entry/2016/06/26/230229">Python: Ellipsis について - CUBE SUGAR CONTAINER</a></p></li>
<li><p><a class="reference external" href="https://blog.amedama.jp/entry/2017/06/13/213316">Python: … (Ellipsis) は任意の処理を示すのにも便利かも - CUBE SUGAR CONTAINER</a></p></li>
</ul>
<p>主に拡張スライス文で使われる特殊な定数</p>
<p>何かあるけど、具体的な値は示したくないときにも使う</p>
<p>長さを定めないTuple型を指定したいときとかも使う: <code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">...]</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="c1"># Do something</span>
    <span class="o">...</span>

<span class="n">variable</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># Ellipsisオブジェクトを代入している</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># Ellispsisが指定されたときに特定の動作をさせることができる</span>
        <span class="c1"># numpyならすべての要素を返すなど</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;...(snip)...&#39;</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>numpyで使う場合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">array</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="c1"># その次元の全ての要素を返す</span>
<span class="c1"># array([1, 2, 3])</span>
</pre></div>
</div>
<p>ユーザー定義で使う場合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="c1"># Ellissisを使うとこのメソッドが呼ばれる</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;...(snip)...&#39;</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>スタブファイルで型定義をするときに余分な情報を省略したい場合</p>
<ul class="simple">
<li><p><a class="reference external" href="https://yumarublog.com/python/pyi/">【Python】 拡張子が .pyi のファイルってなんだろ？｜ゆうまるブログ</a></p></li>
<li><p><a class="reference external" href="https://kazchimo.com/2021/03/29/python%E3%81%AEellipsis-%E3%81%A8type-hints/">PythonのEllipsis(…)とtype hints - These Walls</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># module.py</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="c1"># module.pyi</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="id66">
<h3>変数が定義済みか確認<a class="headerlink" href="#id66" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.lifewithpython.com/2015/05/python-check-variable-existence.html">Python Tips: 変数が定義されたかどうかを調べたい - Life with Python</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 例外でチェックする方法</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">abc</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># なかった場合の処理</span>

<span class="c1"># ローカル・グローバルスコープで定義されているか確認する方法</span>
<span class="k">if</span> <span class="s1">&#39;abc&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span> <span class="c1"># ローカルスコープでチェック</span>
    <span class="c1"># あった場合の処理</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># なかった場合の処理</span>

<span class="k">if</span> <span class="s1">&#39;abc&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span> <span class="c1"># グローバルスコープでチェック</span>
    <span class="c1"># あった場合の処理</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># なかった場合の処理</span>

<span class="c1"># メンバ変数の場合</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">):</span> <span class="c1"># c に abc というメンバがあるかどうかをチェック</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span>

<span class="k">if</span> <span class="s1">&#39;abc&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="c1"># 同上</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id-uuid">
<h3>ユニークID (UUID)の生成<a class="headerlink" href="#id-uuid" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://rurukblog.com/post/python-uuid/">【Python】UUID（ユニークなID）を生成する方法</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uuid</span>

<span class="c1"># ランダムなUUIDを生成する。とりあえずこれを使っていればOK</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="c1"># UUIDオブジェクトが生成される</span>
<span class="c1"># 6c4f3e32-ec27-11eb-9ead-784f4351907d</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">)</span> <span class="c1"># ハイフンなしの文字列になる</span>
<span class="c1"># 6c4f3e32ec2711eb9ead784f4351907d</span>

<span class="c1"># uuid1はコンピュータのネットワークアドレスを含む UUID を生成するため、使わない方が無難</span>
<span class="c1"># UUID をホストID、シーケンス番号、現在時刻から生成する。</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
<span class="c1"># UUIDと任意の文字列からUUIDを生成する。MD5ハッシュを使用。</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid3</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">(),</span> <span class="s2">&quot;hoge&quot;</span><span class="p">))</span>
<span class="c1"># UUIDと任意の文字列からUUIDを生成する。SHA-1 ハッシュを使用。</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid5</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">(),</span> <span class="s2">&quot;hoge&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id67">
<h3>一定間隔で処理<a class="headerlink" href="#id67" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://vogelbarsch.com/2021-04-27-102025/">Pythonで一定間隔で処理をさせる | Vogelbarsch</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/nadu_festival/items/e43ffb4a38d9a1104aa2">Pythonでシグナルをもっと簡単に - Qiita</a></p>
<ul>
<li><p>singalモジュールは処理に時間がかかった場合にエラーで抜けるような場合に使うのが一般的らしい</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://qiita.com/kurogelee/items/0e5fd8b6a1d1f169179a">Pythonで一定時間ごとに処理を実行する - Qiita</a></p>
<ul>
<li><p>sleep時間を差分をとって調整する方法</p></li>
</ul>
</li>
</ul>
<section id="sleep">
<h4>sleep<a class="headerlink" href="#sleep" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">base_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">next_time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">f</span><span class="p">)</span> <span class="c1"># 実行する関数を指定</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="c1"># 前のスレッドが終わるまで待機</span>
        <span class="n">next_time</span> <span class="o">=</span> <span class="p">((</span><span class="n">base_time</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">%</span> <span class="n">interval</span><span class="p">)</span> <span class="ow">or</span> <span class="n">interval</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">next_time</span><span class="p">)</span>

<span class="n">schedule</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">worker</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="signel">
<h4>signel<a class="headerlink" href="#signel" title="Permalink to this heading"></a></h4>
<p>シグナル発生時に処理する関数を指定しておく
一定周期でシグナルを発生させる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">task</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">setitimer</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">ITIMER_REAL</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>スレッドで処理するとき</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">int_timer</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">stack</span><span class="p">):</span>
    <span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">thread_task</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="c1"># 何らかの処理</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">event</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">int_timer</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">setitimer</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">ITIMER_REAL</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_task</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">event</span><span class="p">,))</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
<section id="logging">
<h3>ログ設定 logging<a class="headerlink" href="#logging" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/FukuharaYohei/items/92795107032c8c0bfd19">Pythonでprintを卒業してログ出力をいい感じにする - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/amedama/items/b856b2f30c2f38665701">ログ出力のための print と import logging はやめてほしい - Qiita</a></p></li>
</ul>
<p>ポイント</p>
<ul class="simple">
<li><p>printはログなのか本来の出力か区別できないので不可</p></li>
<li><p>loggingはどの箇所のログかが分からなくなるので不可</p></li>
<li><p>loggerを使用すべし</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ﾀﾞﾒﾀﾞﾖｰ</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># loggingは使えないようにこうする</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>ライブラリとして公開するときにloggerをオプショナル引数として渡せるようにしておくと、便利</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_some_great_stuff</span><span class="p">(</span><span class="n">arg_a</span><span class="p">,</span> <span class="n">arg_b</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># *以降はキーワード専用引数になる</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">_your_default_logger</span>
    <span class="c1"># すっごいこと</span>
</pre></div>
</div>
<section id="id68">
<h4>サンプル<a class="headerlink" href="#id68" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">StreamHandler</span><span class="p">,</span> <span class="n">DEBUG</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>まだ読んでないリンク</p>
<ul class="simple">
<li><p><a class="reference external" href="https://python-guideja.readthedocs.io/ja/latest/writing/logging.html">ロギング — The Hitchhiker’s Guide to Python</a></p></li>
<li><p><a class="reference external" href="https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/">Good logging practice in Python – Fang-Pen’s coding note</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/ja/3/howto/logging.html">Logging HOWTO — Python 3.9.4 ドキュメント</a></p></li>
<li><p><a class="reference external" href="https://pieces.openpolitics.com/2012/04/python-logging-best-practices/">Python Logging Best Practices ~ Pieces of Mind</a></p></li>
</ul>
</section>
<section id="id69">
<h4>ログを一時的に無効化<a class="headerlink" href="#id69" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://psappho.hatenadiary.org/entry/20120801/1343839507">logging.disableで一時的にログ出力を抑制する - 十番目のムーサ</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span> <span class="c1"># WARNING以下のレベルは出てこなくなる</span>
<span class="c1"># 何か処理</span>
<span class="n">logging</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span> <span class="c1"># すべてのレベルでログが出る</span>
</pre></div>
</div>
</section>
</section>
<section id="file">
<h3>File操作<a class="headerlink" href="#file" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/supersaiakujin/items/12451cd2b8315fe7d054">[Python]ファイル/ディレクトリ操作 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-listdir-isfile-isdir/">Pythonでファイル名・ディレクトリ名の一覧をリストで取得 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pathlib-iterdir-glob/">Python, pathlibでファイル一覧を取得（glob, iterdir） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-glob-usage/">Pythonで条件を満たすパスの一覧を再帰的に取得するglobの使い方 | note.nkmk.me</a></p></li>
</ul>
<section id="current-path">
<h4>current path<a class="headerlink" href="#current-path" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="vm">__file__</span> <span class="c1"># 実行中のファイルパス取得</span>
<span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>

<span class="c1"># カレントパスから他のパスを作成</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data/a.jpg&quot;</span> <span class="c1"># ./data/a.jpg と同じ</span>
</pre></div>
</div>
<section id="id70">
<h5>カレントパスを変更する<a class="headerlink" href="#id70" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://linuxize.com/post/python-get-change-current-working-directory/#:~:text=To%20find%20the%20current%20working,chdir(path)%20.">How to Get and Change the Current Working Directory in Python | Linuxize</a></p></li>
</ul>
<p>notebookで実行してるときにmainの関数を叩くときに便利</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</pre></div>
</div>
<p>再実行しても大丈夫にする場合の例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">curpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="k">if</span> <span class="n">curpath</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;notebooks&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
<section id="id71">
<h4>パスの存在確認<a class="headerlink" href="#id71" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;hoge&quot;</span> <span class="c1"># ディレクトリでもファイルでもOK</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1"># True or False</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id72">
<h4>ファイル情報の参照(サイズなど)<a class="headerlink" href="#id72" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://stackoverflow.com/questions/2104080/how-do-i-check-file-size-in-python</p></li>
<li><p>https://docs.python.org/3/library/os.html#os.stat_result</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># サイズ</span>
<span class="n">Path</span><span class="p">(</span><span class="s1">&#39;somefile.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
</pre></div>
</div>
</section>
<section id="id73">
<h4>ファイルかディレクトリか判定<a class="headerlink" href="#id73" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;./test1/test1.txt&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;./test1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="mkdir-make-directory">
<h4>mkdir, make directory<a class="headerlink" href="#mkdir-make-directory" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;./test2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp/dir/sub_dir/sub_dir2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 中間ディレクトリもまとめて作成</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp/dir&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 既存のディレクトリがあってもエラーにしない</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp/dir/sub_dir/sub_dir2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id74">
<h4>一覧取得<a class="headerlink" href="#id74" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.dev-dev.net/entry/2020/02/21/113431">【Python】path.glob で複数の拡張子を検索する方法（大文字小文字の区別付き） | Dev-Dev</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pathlib-iterdir-glob/">Python, pathlibでファイル一覧を取得（glob, iterdir） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span> <span class="c1"># pはディレクトリ、pにあるファイルとフォルダをすべて取得する</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># ** で指定すると再帰的に検索される</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Scripts/**&#39;</span><span class="p">):</span> <span class="c1"># ./Scripts/内にあるディレクトリを再帰的に取得</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Scripts/**/*.json&#39;</span><span class="p">):</span> <span class="c1"># ./Scripts/内にあるjsonファイルをすべて取得</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Scripts/*/*/*.json&#39;</span><span class="p">):</span> <span class="c1"># ./Scripts/から2つ下のディレクトリ内のjsonファイルを取得</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
<span class="c1"># 複数の拡張子を探したいとき globで全部探してから正規表現でフィルタする</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;/*\.(jpg|jpeg|png|gif|bmp)&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># 大文字小文字を区別しない場合</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;/*\.(jpg|jpeg|png)&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
   	
<span class="c1"># カレントにあるディレクトリ名だけ取得したい</span>
<span class="n">tex_dir</span> <span class="o">=</span> <span class="n">data_path</span><span class="o">.</span><span class="n">get_batch_data_dir</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;texture&quot;</span>
<span class="n">label_lst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tex_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
</pre></div>
</div>
</section>
<section id="move">
<h4>move<a class="headerlink" href="#move" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s2">&quot;./test2/test1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="c1"># test1.txtがカレントに移動する</span>
</pre></div>
</div>
</section>
<section id="id75">
<h4>copy<a class="headerlink" href="#id75" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="c1"># ファイル単位でコピー</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;./test1/test1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;./test2.txt&quot;</span><span class="p">)</span> <span class="c1"># データのみコピー？</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s2">&quot;./test1/test1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;./test3.txt&quot;</span><span class="p">)</span> <span class="c1"># データとパーミッションをコピー</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s2">&quot;./test1/test1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;./test4.txt&quot;</span><span class="p">)</span> <span class="c1"># メタ情報もコピー(作成日時など)</span>

<span class="c1"># ディレクトリ単位でコピー</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s2">&quot;./test1&quot;</span><span class="p">,</span> <span class="s2">&quot;./test2&quot;</span><span class="p">)</span> <span class="c1"># test1のフォルダ全体をtest2としてコピー (test2は未作成であること)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s2">&quot;./test1&quot;</span><span class="p">,</span> <span class="s2">&quot;./test2&quot;</span><span class="p">,</span> <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># python3.8から</span>

<span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span> <span class="c1"># test2がすでに存在しているところにtest1の中身をコピーしたい場合</span>
<span class="n">copy_tree</span><span class="p">(</span><span class="s2">&quot;./test1&quot;</span><span class="p">,</span> <span class="s2">&quot;./test2&quot;</span><span class="p">)</span> <span class="c1"># test2が存在しない場合はエラーになる</span>
</pre></div>
</div>
</section>
<section id="remove-delete">
<h4>remove, delete<a class="headerlink" href="#remove-delete" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;./test1.txt&quot;</span><span class="p">)</span> <span class="c1"># ファイル削除</span>
<span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="s2">&quot;./test2&quot;</span><span class="p">)</span> <span class="c1"># 空のディレクトリ削除</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;./test2&quot;</span><span class="p">)</span> <span class="c1"># 中身があっても削除できる</span>
<span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./test2/*.log&quot;</span><span class="p">)]</span> <span class="c1"># 条件指定して削除</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p_sub_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp/dir/sub_dir/sub_dir2&#39;</span><span class="p">)</span>
<span class="n">p_sub_dir</span><span class="o">.</span><span class="n">rmdir</span><span class="p">()</span> <span class="c1"># 空の場合のみ削除できる</span>
<span class="c1"># 中身の入ってる場合はshutilモジュールを使用する</span>
</pre></div>
</div>
</section>
<section id="rename">
<h4>rename<a class="headerlink" href="#rename" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;./test1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;./test2.txt&quot;</span><span class="p">)</span> <span class="c1"># ファイル</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;./test2&quot;</span><span class="p">,</span> <span class="s2">&quot;./test3&quot;</span><span class="p">)</span> <span class="c1"># ディレクトリ</span>
</pre></div>
</div>
</section>
<section id="id76">
<h4>絶対・相対パス変換<a class="headerlink" href="#id76" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pathlib-absolute-relative/">Python, pathlibで絶対パスと相対パスを相互変換・判定 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.path.abspath()</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp/file.txt&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

<span class="n">p</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span> <span class="c1"># 任意のディレクトリからの相対パスに変換</span>
</pre></div>
</div>
</section>
<section id="id77">
<h4>フォルダ名、ベース名、拡張子のみ取得<a class="headerlink" href="#id77" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="c1"># フォルダ名 or ファイル名のみになる</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="c1"># 拡張子のみ(.込み)</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="c1"># 拡張子のみで先頭の.がいらない場合</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="c1"># nameから拡張子を除いたもの</span>

<span class="c1"># ファイル名の末尾に_outを付けたいとき</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/download/hoge.csv&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_out&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>

<span class="c1"># ファイル名のみ変えたいとき</span>
<span class="n">p</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;hoge.csv&quot;</span><span class="p">)</span>

<span class="c1"># 拡張子のみ変えたいとき</span>
<span class="n">p</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.hoge&quot;</span><span class="p">)</span> <span class="c1"># .から始まる必要あり</span>
</pre></div>
</div>
</section>
<section id="id78">
<h4>親ディレクトリ<a class="headerlink" href="#id78" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="c1"># 一つ上</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="c1"># 二つ上</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># parent.parent と同じ</span>
</pre></div>
</div>
</section>
<section id="os">
<h4>osのパス区切り文字<a class="headerlink" href="#os" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">sep</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="c1"># 上と同じ</span>
</pre></div>
</div>
</section>
<section id="id79">
<h4>パスの結合<a class="headerlink" href="#id79" title="Permalink to this heading"></a></h4>
<p>Pathオブジェクトの後に/が続くとパスの区切り文字で結合される。拡張子の有無は関係ない</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./data/&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="s2">&quot;ok.png&quot;</span>
<span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="c1"># &#39;data/ok.png&#39;</span>
<span class="nb">str</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span><span class="s2">&quot;ok.png&quot;</span><span class="o">/</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span> <span class="c1"># &#39;data/aa.lo/ok.png/hoge&#39;</span>
</pre></div>
</div>
</section>
<section id="id80">
<h4>ZIP圧縮<a class="headerlink" href="#id80" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-zip-dir-shutil-make-archive/">Pythonでディレクトリ（フォルダ）をzipやtarに圧縮 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-zipfile/">PythonでZIPファイルを圧縮・解凍するzipfile | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">zip_file_name</span> <span class="o">=</span> <span class="s2">&quot;./hoge&quot;</span>
<span class="n">src_dir</span> <span class="o">=</span> <span class="s2">&quot;./zip_src&quot;</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="n">zip_file_name</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="n">src_dir</span><span class="p">)</span> <span class="c1"># zip_srcの中身が圧縮されるので、解凍時にここに展開を使うと中身が出てくる</span>
<span class="c1"># zip_srcがhogeに置き換わる。windowsのzipで送ると比べて階層がひとつ浅くなる</span>
</pre></div>
</div>
</section>
<section id="id81">
<h4>一時ファイル/ディレクトリの作成<a class="headerlink" href="#id81" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/everylittle/items/aa7c6f612ff0a9db7f01">Pythonで一時ディレクトリを作って安全に後始末する - Qiita</a></p></li>
<li><p><a class="reference external" href="https://hibiki-press.tech/python/tempfile-md/2829">[Python] 一時ファイルを作成する(tempfileモジュール） | Hbk project</a></p></li>
</ul>
<section id="id82">
<h5>自動で削除<a class="headerlink" href="#id82" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># 一時ファイル作成</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># ファイル名を可視化する場合はNamedの方を使う</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">())</span> <span class="c1"># tmpファイルの作成ディレクトリが確認できる</span>

<span class="c1"># 一時ディレクトリ作成</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">dname</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>                 <span class="c1"># /tmp/tmpl2cvqpq5</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="s2">&quot;test.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id83">
<h5>自動で削除されない<a class="headerlink" href="#id83" title="Permalink to this heading"></a></h5>
<p>あえて残しておきたいときとか</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">fd</span><span class="p">,</span> <span class="n">tmpfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># オプションをいろいろ設定できる</span>
<span class="c1"># fd, tmpfile = tempfile.mkstemp(text=True, suffix=&quot;.json&quot;, prefix=&quot;pre_&quot;, dir=&quot;./my_tmp_dir&quot;)</span>

<span class="c1"># ファイル記述子と一時ファイルの絶対パスのタプルを返します</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">tmpfile</span><span class="p">)</span>  <span class="c1"># (6, &#39;/tmp/tmppjaaloqf&#39;)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;test script&#39;</span><span class="p">)</span>
<span class="c1"># 手動で削除</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmpfile</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

<span class="c1"># 返り値は生成された一時フォルダの絶対パス</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="c1"># &#39;/tmp/tmpr30q43kb&#39;</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="slice">
<h3>slice<a class="headerlink" href="#slice" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">[start:stop:step]</span></code></p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-split-rsplit-splitlines-re/">Pythonで文字列を分割（区切り文字、改行、正規表現、文字数） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="c1"># [20, 30, 40]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
<span class="c1"># [0, 10, 20]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
<span class="c1"># [30, 40, 50, 60]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[:])</span>
<span class="c1"># [0, 10, 20, 30, 40, 50, 60]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
<span class="c1"># [0, 20, 40, 60]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
<span class="c1"># [10, 30, 50]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># [30, 40, 50]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="c1"># 末尾から2個目から</span>
<span class="c1"># [50, 60]</span>
</pre></div>
</div>
</section>
<section id="id84">
<h3>print<a class="headerlink" href="#id84" title="Permalink to this heading"></a></h3>
<section id="f">
<h4>f文字列<a class="headerlink" href="#f" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-f-strings/">Pythonのf文字列（フォーマット済み文字列リテラル）の使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># format使う場合</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{first}</span><span class="s1"> and </span><span class="si">{second}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="n">b</span><span class="p">))</span>

<span class="c1"># fを頭に付ける場合</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">F</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>書式</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;zero padding: </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">08</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 0埋め8桁</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;digit(decimal): </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 小数点以下の桁数指定</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;digit(all)    : </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 全体の桁数指定</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exponen: </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 指数表記</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this heading"></a></h2>
<section id="pydantic">
<h3>pydantic<a class="headerlink" href="#pydantic" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/koralle/items/93b094ddb6d3af917702">pydanticを使って実行時にも型情報が適用されるPythonコードを書く - Qiita</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pydantic
</pre></div>
</div>
<p>実行時に型のチェックをしてくれる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
        
<span class="n">Ramuda</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ramuda&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">Jakurai</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Jakurai&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="s2">&quot;35&quot;</span><span class="p">)</span> <span class="c1"># ageを文字列で与えてもint型にキャストされる</span>
<span class="n">Sasara</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sasara&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="s2">&quot;ホンマか？&quot;</span><span class="p">)</span> <span class="c1"># キャストできない値だとエラーを出してくれる</span>
</pre></div>
</div>
<section id="basic-usage">
<h4>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="c1"># Type Hintsのみの場合は入力が必須となる</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;John Doe&#39;</span> <span class="c1"># デフォルト値からstr型が設定される。入力必須ではない</span>
    <span class="n">signup_ts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">friends</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">external_data</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># 入力するデータは辞書型でも入力可能</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span>
    <span class="s1">&#39;signup_ts&#39;</span><span class="p">:</span> <span class="s1">&#39;2019-06-01 12:22&#39;</span><span class="p">,</span>
    <span class="s1">&#39;friends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span>
    <span class="s1">&#39;hoge&#39;</span><span class="p">:</span> <span class="s1">&#39;hoo&#39;</span><span class="p">,</span> <span class="c1"># メンバにない値は無視される</span>
<span class="p">}</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="o">**</span><span class="n">external_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="c1"># 123</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">signup_ts</span><span class="p">))</span> <span class="c1"># datetime.datetime(2019, 6, 1, 12, 22)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">friends</span><span class="p">)</span> <span class="c1"># [1, 2, 3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span> <span class="c1"># 辞書型に変換</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;id&#39;: 123,</span>
<span class="sd">    &#39;signup_ts&#39;: datetime.datetime(2019, 6, 1, 12, 22),</span>
<span class="sd">    &#39;friends&#39;: [1, 2, 3],</span>
<span class="sd">    &#39;name&#39;: &#39;John Doe&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="id85">
<h4>型に条件を追加<a class="headerlink" href="#id85" title="Permalink to this heading"></a></h4>
<p>オブジェクトを生成するときしかチェックされないっぽい？</p>
<p>後からメンバの値を変更するときは制限越えてもエラーにならない</p>
<p>https://pydantic-docs.helpmanual.io/usage/types/#constrained-types</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">NegativeFloat</span><span class="p">,</span>
    <span class="n">NegativeInt</span><span class="p">,</span>
    <span class="n">PositiveFloat</span><span class="p">,</span>
    <span class="n">PositiveInt</span><span class="p">,</span>
    <span class="n">NonNegativeFloat</span><span class="p">,</span>
    <span class="n">NonNegativeInt</span><span class="p">,</span>
    <span class="n">NonPositiveFloat</span><span class="p">,</span>
    <span class="n">NonPositiveInt</span><span class="p">,</span>
    <span class="n">conbytes</span><span class="p">,</span>
    <span class="n">condecimal</span><span class="p">,</span>
    <span class="n">confloat</span><span class="p">,</span>
    <span class="n">conint</span><span class="p">,</span>
    <span class="n">conlist</span><span class="p">,</span>
    <span class="n">conset</span><span class="p">,</span>
    <span class="n">constr</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">lower_str</span><span class="p">:</span> <span class="n">constr</span><span class="p">(</span><span class="n">to_lower</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">short_str</span><span class="p">:</span> <span class="n">constr</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">regex_str</span><span class="p">:</span> <span class="n">constr</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^apple (pie|tart|sandwich)$&#39;</span><span class="p">)</span>

    <span class="n">big_int</span><span class="p">:</span> <span class="n">conint</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">mod_int</span><span class="p">:</span> <span class="n">conint</span><span class="p">(</span><span class="n">multiple_of</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">pos_int</span><span class="p">:</span> <span class="n">PositiveInt</span>
    <span class="n">neg_int</span><span class="p">:</span> <span class="n">NegativeInt</span>
    <span class="n">non_neg_int</span><span class="p">:</span> <span class="n">NonNegativeInt</span>
    <span class="n">non_pos_int</span><span class="p">:</span> <span class="n">NonPositiveInt</span>

    <span class="n">big_float</span><span class="p">:</span> <span class="n">confloat</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lt</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">unit_interval</span><span class="p">:</span> <span class="n">confloat</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mod_float</span><span class="p">:</span> <span class="n">confloat</span><span class="p">(</span><span class="n">multiple_of</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">pos_float</span><span class="p">:</span> <span class="n">PositiveFloat</span>
    <span class="n">neg_float</span><span class="p">:</span> <span class="n">NegativeFloat</span>
    <span class="n">non_neg_float</span><span class="p">:</span> <span class="n">NonNegativeFloat</span>
    <span class="n">non_pos_float</span><span class="p">:</span> <span class="n">NonPositiveFloat</span>

    <span class="n">short_list</span><span class="p">:</span> <span class="n">conlist</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">short_set</span><span class="p">:</span> <span class="n">conset</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">bigger_int</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id86">
<h4>copy<a class="headerlink" href="#id86" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://pydantic-docs.helpmanual.io/usage/exporting_models/#modelcopy</p></li>
</ul>
<p>データを複製するときに対象を指定できる。データ内が辞書型などの場合はデフォルトはshallow copy</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">FooBarModel</span><span class="p">(</span><span class="n">banana</span><span class="o">=</span><span class="mf">3.14</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;whatever&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">}))</span> <span class="c1">#&gt; foo=&#39;hello&#39; bar=BarModel(whatever=123)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">}))</span> <span class="c1">#&gt; banana=3.14</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}))</span> <span class="c1">#&gt; banana=0 foo=&#39;hello&#39; bar=BarModel(whatever=123)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bar</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">bar</span><span class="p">))</span> <span class="c1"># normal copy gives the same object reference for `bar`</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bar</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">bar</span><span class="p">))</span> <span class="c1"># deep copy gives a new object reference for `bar`</span>
</pre></div>
</div>
</section>
<section id="field">
<h4>Field<a class="headerlink" href="#field" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/uenosy/items/2f6b1aa258018d3db76c">FastAPIにおけるPydanticを使ったバリデーションのまとめ - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">Hoge</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># エラー条件: hogeが存在しない or 値がNone or 整数でない</span>
    <span class="n">hoge</span><span class="p">:</span> <span class="nb">int</span>

    <span class="c1"># エラー条件: hogeが存在しない or 整数でない</span>
    <span class="n">hoge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="c1"># エラー条件: 整数でない</span>
    <span class="n">hoge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

    <span class="c1"># デフォルト値を指定する場合 (なしの場合はEllipsis(...)で指定)</span>
    <span class="n">fuga</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fuga</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># これでも可</span>

    <span class="c1"># エラー条件: 文字数が2文字から10文字以外, 存在しない</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># 要素数が2個から10個以外の場合エラー</span>
    <span class="n">foo</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># 指定した正規表現にマッチしない場合エラー</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;[0-9]{2,3}&quot;</span><span class="p">)</span>

    <span class="c1"># 値が2から10の範囲外の場合エラー</span>
    <span class="n">hoge</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># プロパティは存在しなくてもいいが、存在するならnull不可</span>
    <span class="n">hoge</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">)</span>                <span class="c1"># hogeのバリデーションの登録 </span>
    <span class="k">def</span> <span class="nf">validate_hoge</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>    <span class="c1"># 関数名はなんでもいい。第1引数はcls固定で使用しない。第2引数はvalueでhogeに設定した値</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>             <span class="c1"># Noneであれば例外を投げる</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;none is not an allowed value&quot;</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">value</span>                  <span class="c1"># Noneでない場合はそのままvalueを返す</span>
    
    <span class="c1"># 更に複雑なバリデーション</span>
    <span class="nd">@validator</span><span class="p">(</span><span class="n">プロパティ名</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># each_itemを追加するとListなどのイテレータを持つものは個別にチェックできる</span>
    <span class="k">def</span> <span class="nf">validate_hoge</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span> <span class="c1"># 3つ目にvaluesを指定するとこれ以前にバリデートされたプロパティと値の辞書が取得できる</span>
        <span class="k">if</span> <span class="n">ここでチェック</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;何かのメッセージ&quot;</span><span class="p">)</span> <span class="c1"># assertでもよい</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
</section>
<section id="id87">
<h4>環境変数、シークレットファイルの値を読み込む<a class="headerlink" href="#id87" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/ninomiyt/items/ee676d7f9b780b1d44e8">Pythonで環境変数を読み込むときはpydanticを使うと便利 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://lynn-kwong.medium.com/how-to-use-pydantic-to-read-environment-variables-and-secret-files-in-python-8a6b8c56381c">How to use pydantic to read environment variables and secret files in Python | by Lynn Kwong | Medium</a></p></li>
<li><p><a class="reference external" href="https://attsun1031.github.io/blog/pydantic-intro">FastAPIを使っていなくても、Pydanticは便利です – Attsun Blog</a></p></li>
<li><p>https://pydantic-docs.helpmanual.io/usage/settings/</p></li>
</ul>
<p>準備としてシークレット情報をファイルとして保存 (ファイル毎に一つのシークレット情報を持つ)</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mkdir<span class="w"> </span>secrets
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>some_password<span class="w"> </span>&gt;<span class="w"> </span>secrets/db_password
$<span class="w"> </span>cat<span class="w"> </span>secrets/db_password
some_password
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="k">class</span> <span class="nc">DBCreds</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span> <span class="c1"># 環境変数から読み込むためにはBaseSettingsを継承</span>
    <span class="n">db_username</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># 環境変数DB_USERNAMEの値が自動で読み込まれる</span>
    <span class="n">db_password</span><span class="p">:</span> <span class="n">SecretStr</span>
    
    <span class="c1"># このように設定すると自動的に対応するファイル名の中身を変数に読み込んでくれる</span>
    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">secrets_dir</span> <span class="o">=</span> <span class="s2">&quot;./secrets&quot;</span>
</pre></div>
</div>
<p>上のコードを冗長的に書くと以下のコードになる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">SecretStr</span>

<span class="k">class</span> <span class="nc">DBCreds</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">db_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="s2">&quot;DB_USERNAME&quot;</span><span class="p">)</span>
    <span class="n">db_password</span><span class="p">:</span> <span class="n">SecretStr</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">env_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">case_sensitive</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">secrets_dir</span> <span class="o">=</span> <span class="s2">&quot;./secrets&quot;</span>
</pre></div>
</div>
<p>別の例</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># あらかじめ環境変数を設定</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">REDIS_HOST_NAME</span><span class="o">=</span>localhost
<span class="nb">export</span><span class="w"> </span><span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">redis_host_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redis_port</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">redis_host_name</span><span class="p">)</span> <span class="c1"># localhost</span>
<span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">redis_port</span><span class="p">)</span> <span class="c1"># 6379</span>
</pre></div>
</div>
<p>envファイルを使うこともできる</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>hoge.env
<span class="nv">REDIS_HOST_NAME</span><span class="o">=</span>localhost
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">redis_host_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redis_port</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">env_file</span> <span class="o">=</span> <span class="s1">&#39;hoge.env&#39;</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id88">
<h4>その他Tips<a class="headerlink" href="#id88" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>URLやメールアドレスなどの型もある</p></li>
<li><p>パスワードなどの情報は表示されないようにできる</p></li>
<li><p>int型にstr型を許容しない設定も可能</p></li>
<li><p>validationを独自に定義できる</p></li>
<li><p>辞書形式やJSON形式に変換できる。変換対象も指定可能</p></li>
</ul>
</section>
</section>
<section id="pandas">
<h3>Pandas<a class="headerlink" href="#pandas" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-list/">pandas.DataFrame, SeriesとPython標準のリストを相互に変換 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-to-csv/">pandasでcsvファイルの書き出し・追記（to_csv） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-json-normalize/">pandasのjson_normalizeで辞書のリストをDataFrameに変換 | note.nkmk.me</a></p></li>
</ul>
<section id="id89">
<h4>データの新規作成<a class="headerlink" href="#id89" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-dataframe-values-columns-index/">pandas.DataFrameの構造とその作成方法 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="c1"># 3行でA,B列を持つ行列</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># 1行3列</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col_0&#39;</span><span class="p">,</span> <span class="s1">&#39;col_1&#39;</span><span class="p">,</span> <span class="s1">&#39;col_2&#39;</span><span class="p">,</span> <span class="s1">&#39;col_3&#39;</span><span class="p">],</span>
                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;row_0&#39;</span><span class="p">,</span> <span class="s1">&#39;row_1&#39;</span><span class="p">,</span> <span class="s1">&#39;row_2&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">#        col_0  col_1  col_2  col_3</span>
<span class="c1"># row_0      0      1      2      3</span>
<span class="c1"># row_1      4      5      6      7</span>
<span class="c1"># row_2      8      9     10     11</span>

<span class="c1"># 列名だけ定義する場合</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;uuid_img&#39;</span><span class="p">,</span> <span class="s1">&#39;uuid_reco&#39;</span><span class="p">])</span>

<span class="c1"># indexを指定する場合</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;reco&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;uuid&#39;</span><span class="p">)</span>

<span class="c1"># 行追加</span>
<span class="c1"># dict_data: </span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dict_data</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">dict_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;uuid_0&quot;</span><span class="p">)</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="csv">
<h4>CSV読み込み・書き込み<a class="headerlink" href="#csv" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-read-csv-tsv/">pandasでcsv/tsvファイル読み込み（read_csv, read_table） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-to-csv/">pandasでcsvファイルの書き出し・追記（to_csv） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/okadate/items/7b9620a5e64b4e906c42">pandasでよく使う文法まとめ - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;hoge.csv&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File exist: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf_8_sig&quot;</span><span class="p">)</span> <span class="c1"># BOM付で保存するとexcelでもUTF-8が開ける</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 日付をdatetime型で読める</span>
<span class="c1"># 2013-08-30 01:00:00 とか</span>
<span class="c1"># 201807031800 とか</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/dst/to_csv_out.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/dst/to_csv_out_columns.csv&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="c1"># 特定の列のみ書き出し</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/dst/to_csv_out_float_format_3f.csv&#39;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 小数点以下3桁で出力</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/dst/to_csv_out_columns.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># index,headerを出力しない</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf_8_sig&quot;</span><span class="p">)</span> <span class="c1"># BOM付で保存するとexcelでもUTF-8が開ける</span>
</pre></div>
</div>
</section>
<section id="id90">
<h4>エクセルからデータ読み込み<a class="headerlink" href="#id90" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-read-excel/">pandasでExcelファイル（xlsx, xls）の読み込み（read_excel） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>openpyxl
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>xlrd
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;hoge.xlsx&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File exist: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id91">
<h4>特定の列・行をインデックス指定で取得<a class="headerlink" href="#id91" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-index-row-column/">pandasのインデックス参照で行・列を選択し取得 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://deepage.net/features/pandas-location.html">Pandasで要素を抽出する方法(loc,iloc,iat,atの使い方) - DeepAge</a></p></li>
</ul>
<p>インデックスが文字列のときと整数値で扱いが変わる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># indexの型を確認</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># 列</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="c1"># 列名で取得(Series)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">]])</span> <span class="c1"># 複数の列(dataframe)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">]])</span> <span class="c1"># 1列でもdataframeになる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span><span class="s1">&#39;point&#39;</span><span class="p">])</span> <span class="c1"># スライスで範囲指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span> <span class="c1"># 列の位置でスライス指定</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 行のインデックスで指定 (IDが1のものが取得できる)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">])</span> <span class="c1"># 項目の取得</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span> <span class="c1"># 複数インデックスも指定可能</span>

<span class="c1"># インデックスが整数値の場合</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>

<span class="c1"># 行</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># 行の位置をスライス指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 単独指定でもスライスで指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">:</span><span class="s1">&#39;Ellen&#39;</span><span class="p">])</span> <span class="c1"># 行ラベルでスライス指定(stopも含まれる)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">])</span> <span class="c1"># 単独でラベル指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Ellen&#39;</span><span class="p">]])</span> <span class="c1"># 任意のラベルを指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span> <span class="c1"># 任意の位置を指定</span>

<span class="c1"># リストで特定の行を指定(排反の要素も取得)</span>
<span class="n">test_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">113</span><span class="p">,])</span>
<span class="n">test_index</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># pandas&#39;s index start from 0</span>
<span class="n">train_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">117</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_index</span><span class="p">))</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>

<span class="c1"># インデックスが整数値の場合</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 行名で指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 行番号で指定</span>

<span class="c1"># 列→行</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">][</span><span class="s1">&#39;Alice&#39;</span><span class="p">])</span> <span class="c1"># 列→行のラベル指定で特定のセルの値を取得</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="c1"># 上のと同じ結果になる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">:</span><span class="s1">&#39;Dave&#39;</span><span class="p">][[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">]])</span> <span class="c1"># 列→行の範囲指定版</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">:</span><span class="s1">&#39;Dave&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">]])</span>
<span class="c1"># 行インデックスが整数値の場合</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># height列のインデックスが2の値</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="c1"># height列のインデックスが2,4の値</span>

<span class="c1"># 行→列</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;商品番号&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;商品番号&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;商品番号&quot;</span><span class="p">)]</span> <span class="c1"># 名前から位置を取得</span>
<span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;商品番号&quot;</span><span class="p">]</span>
<span class="c1"># df.at[1][&quot;商品番号&quot;] # 不可</span>
<span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="c1"># df.iat[1][5] # 不可</span>

<span class="c1"># 項目名をインデックスに変換</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">item_url</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;image_url&quot;</span><span class="p">)]</span>

<span class="c1"># Seriesの場合</span>
<span class="n">s</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># ラベル名</span>
<span class="n">s</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 行番号</span>
<span class="n">s</span><span class="p">[</span><span class="s1">&#39;index_name&#39;</span><span class="p">]</span>
<span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># インデックス名が数値でない場合は位置を指定して取得できる</span>
<span class="n">s</span><span class="p">[[</span><span class="s2">&quot;hoge&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">]]</span> <span class="c1"># リストでも指定可</span>
<span class="n">s</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># スライスの場合は行番号と見なされる</span>
<span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># データ部分だけをリストに変換</span>
</pre></div>
</div>
</section>
<section id="id92">
<h4>行番号・列番号の取得<a class="headerlink" href="#id92" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-get-loc-row-column-num/">pandas.DataFrameの行番号、列番号を取得 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 同じ名称が複数あると番号ではなくdfになってしまうので注意</span>
<span class="c1"># 行番号をindex名から取得</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">))</span>

<span class="c1"># 列番号</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="eda">
<h4>EDAで最初にやること<a class="headerlink" href="#eda" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/0NE_shoT_/items/bf700662b2c36aee0f8e">Pandasでデータ概観 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/ryo111/items/f62a43da6764f58823a5">【Python】データ分析の序盤でよく使う手法メモ - Qiita</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-describe/">pandasのdescribeで各列の要約統計量（平均、標準偏差など）を取得 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/zumitan/items/dd4bfc7e7d5624c74bee">KaggleでEDAをやろうと思った時に見る記事 - Qiita</a></p>
<ul>
<li><p><a class="reference external" href="https://www.kaggle.com/dejavu23/house-prices-eda-to-ml-beginner">House Prices: EDA to ML (Beginner) | Kaggle</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://qiita.com/yuto16/items/9673c9b817ad5ef8ff32">【Python】EDAメモ - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;hoge.csv&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File exist: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># 先頭のデータ表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># 末尾表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># ランダムに選択</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span> <span class="c1"># 要約統計量(最小、最大、平均、偏差) (デフォルトはint,float型の列のみ対象)</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span><span class="p">)</span> <span class="c1"># オブジェクト型の要素数、ユニーク数、最頻値、最頻 値の出現回数</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># データの概要(列名、行名、データ数、データ型)</span>

<span class="n">df</span><span class="o">.</span><span class="n">shape</span> <span class="c1">#(行数, 列数)を表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">size</span> <span class="c1">#データ数を表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="c1">#データ型を表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="c1">#列一覧を表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span> <span class="c1">#全列の相関係数表示</span>

<span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="c1"># 含まれるデータ型の表示</span>
<span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># 欠損値の総数</span>

<span class="n">df</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="c1"># カラム内のデータのカウント数</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Embarked&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="c1"># 任意の列の項目別の数量表示</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Id&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 不要な列の削除. e.g. Idの列を削除</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Embarked&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="c1"># 指定した列のユニーク値</span>
<span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span> <span class="c1"># 各列のユニーク値の種類数</span>
<span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># 各列の欠損値合計</span>

<span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s2">&quot;Survived&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span> <span class="c1"># 指定の列の他の列との相関係数表示(シンプルに表示できる)</span>

<span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span> <span class="c1"># 数値データの列のみのインデックス</span>
<span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span> <span class="c1"># オブジェクトデータのみのインデックス</span>

<span class="c1"># グループバイによる集計</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Sex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># 性別の列でグループにまとめて、それぞれのグループの平均表示</span>

<span class="c1"># ピボット集計</span>
<span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Embarked&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="c1"># 性別(&#39;Sex&#39;)をインデックス、乗船場所(&#39;Embarked&#39;)をカラムとした、生存者(&#39;Survived&#39;)の合計(sum)の表を出力</span>

</pre></div>
</div>
</section>
<section id="id93">
<h4>列同士で演算<a class="headerlink" href="#id93" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>

<span class="c1"># BMIの計算</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="df">
<h4>列名とインデックスを他のdfからコピー<a class="headerlink" href="#df" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df_cache</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">df_cache</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</section>
<section id="id94">
<h4>コピー<a class="headerlink" href="#id94" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># deepcopyになる</span>
</pre></div>
</div>
</section>
<section id="for">
<h4>for文で巡回<a class="headerlink" href="#for" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-dataframe-for-iteration/">pandas.DataFrameのforループ処理（イテレーション） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1"># series型で返される。毎回seriesを作るので処理は遅め</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;point&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">point</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span> <span class="c1"># named tupleで返される</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="c1"># Pandas(Index=&#39;Alice&#39;, age=24, state=&#39;NY&#39;, point=64)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">point</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id95">
<h4>データ列/行を追加・挿入<a class="headerlink" href="#id95" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-assign-append/">pandas.DataFrameに列や行を追加（assign, appendなど） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;hoge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># 辞書型のように新しい列名を指定して追加(すべて同じ値になる)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># リストでも可能(行数と揃えないとエラー)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="c1"># Seriesを追加</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># 新規追加 or 既存のものなら上書き</span>

<span class="c1"># 行方向に挿入する(行はinsertがないので、挿入位置で分割してサンドイッチ)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># n番目のデータをコピーして一つ下に複製する場合 (インデックス名だけ変更するケース)</span>
<span class="n">df_bef</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_ins</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_aft</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">df_ins</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;item_id&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;@cleric&quot;</span> <span class="c1"># インデックスの名称を変更</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_bef</span><span class="p">,</span> <span class="n">df_ins</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;item_id&quot;</span><span class="p">),</span> <span class="n">df_aft</span><span class="p">])</span> <span class="c1"># 結合</span>

<span class="c1"># 行に新規追加</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;FIVE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A5&#39;</span><span class="p">,</span> <span class="s1">&#39;B5&#39;</span><span class="p">,</span> <span class="s1">&#39;C5&#39;</span><span class="p">]</span> <span class="c1"># リストで列に一括でデータを入れられるが、要素数が合わないとエラー</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 辞書型で列名をキーとして指定。indexは指定できない</span>

<span class="c1"># オススメ: 辞書型で指定したいときはSeries型に直した方がよい。indexも指定できる</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dict_data</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">dict_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index_name&quot;</span><span class="p">)</span>
<span class="c1"># df_new = df.append(s) # appendは非推奨になったので、concatを使った方がよい</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>

<span class="c1"># Series型で追加</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df_cache</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;result_name&quot;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="c1"># 要素追加する場合</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id96">
<h4>データ列を結合<a class="headerlink" href="#id96" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-concat/">pandas.DataFrame, Seriesを連結するconcat | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_h</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># axis=1で列方向に追加されていく</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_h</span><span class="p">)</span>
<span class="c1">#          A    B    C    C    D</span>
<span class="c1"># FOUR   NaN  NaN  NaN   C4   D4</span>
<span class="c1"># ONE     A1   B1   C1  NaN  NaN</span>
<span class="c1"># THREE   A3   B3   C3   C3   D3</span>
<span class="c1"># TWO     A2   B2   C2   C2   D2</span>
</pre></div>
</div>
</section>
<section id="id97">
<h4>行を結合<a class="headerlink" href="#id97" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">])</span> <span class="c1"># リストやタプルでまとめて指定可能</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="p">])</span> <span class="c1"># 行方向に結合</span>
</pre></div>
</div>
</section>
<section id="id98">
<h4>インデックスを指定<a class="headerlink" href="#id98" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://ai-inter1.com/pandas-dataframe_index/">Pandas DataFrameへのインデックスの指定と削除、変更(振り直し) - AI-interのPython3入門</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Product ID&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># indexを元に戻す</span>
</pre></div>
</div>
</section>
<section id="id99">
<h4>インデックスの重複を除外<a class="headerlink" href="#id99" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/35084071/concat-dataframe-reindexing-only-valid-with-uniquely-valued-index-objects?lq=1">python - Concat DataFrame Reindexing only valid with uniquely valued Index objects - Stack Overflow</a></p></li>
</ul>
<p>インデックスが重複しているとconcat時にエラーが出る</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="id100">
<h4>辞書型に変換<a class="headerlink" href="#id100" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-to-dict/">pandas.DataFrame, Seriesを辞書に変換（to_dict） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="c1"># {&#39;col1&#39;: {&#39;row1&#39;: 1, &#39;row2&#39;: 2, &#39;row3&#39;: 3},</span>
<span class="c1">#  &#39;col2&#39;: {&#39;row1&#39;: &#39;a&#39;, &#39;row2&#39;: &#39;x&#39;, &#39;row3&#39;: &#39;あ&#39;}}</span>

<span class="n">d_list</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span> <span class="c1"># 行の情報がなくなる</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">d_list</span><span class="p">)</span>
<span class="c1"># {&#39;col1&#39;: [1, 2, 3], &#39;col2&#39;: [&#39;a&#39;, &#39;x&#39;, &#39;あ&#39;]}</span>
</pre></div>
</div>
</section>
<section id="id101">
<h4>リストと相互変換<a class="headerlink" href="#id101" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-list/">pandas.DataFrame, SeriesとPython標準のリストを相互に変換 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l_1d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">l_1d</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">l_1d</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;row1&#39;</span><span class="p">,</span> <span class="s1">&#39;row2&#39;</span><span class="p">,</span> <span class="s1">&#39;row3&#39;</span><span class="p">])</span>

<span class="n">l_2d</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">l_2d</span><span class="p">)</span> <span class="c1"># 2行3列になる</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">l_2d</span><span class="p">,</span>
                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;row1&#39;</span><span class="p">,</span> <span class="s1">&#39;row2&#39;</span><span class="p">],</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">,</span> <span class="s1">&#39;col2&#39;</span><span class="p">,</span> <span class="s1">&#39;col3&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="numpy">
<h4>numpyと相互変換<a class="headerlink" href="#numpy" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-numpy-conversion/">pandas.DataFrame, SeriesとNumPy配列ndarrayを相互に変換 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>

<span class="c1"># 単一の列を変換</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># 単一の行を変換</span>
<span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="c1"># 先頭行のみスライスで取り出し</span>

<span class="c1"># 複数列を組み合わせてまとめて変換する</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># numpyからpandas</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># [[ 0  1  2]</span>
<span class="c1">#  [ 3  4  5]</span>
<span class="c1">#  [ 6  7  8]</span>
<span class="c1">#  [ 9 10 11]]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">#    0   1   2</span>
<span class="c1"># 0  0   1   2</span>
<span class="c1"># 1  3   4   5</span>
<span class="c1"># 2  6   7   8</span>
<span class="c1"># 3  9  10  11</span>
</pre></div>
</div>
</section>
<section id="id102">
<h4>列名でsort<a class="headerlink" href="#id102" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-sort-values-sort-index/">pandas.DataFrame, Seriesをソートするsort_values, sort_index | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span> <span class="c1"># index列の要素を基準にソート</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 降順にしたいとき、inplace</span>

<span class="n">df_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span> <span class="c1"># state列の要素を基準にソート</span>
<span class="n">df_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># 降順にする場合</span>
<span class="n">df_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="c1"># 複数の要素でソート。リストの後ろの要素からソートされていく</span>
<span class="n">df_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span> <span class="c1"># 各要素ごとに昇順・降順設定できる</span>
</pre></div>
</div>
</section>
<section id="query">
<h4>query<a class="headerlink" href="#query" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-query/">pandas.DataFrameの行を条件で抽出するquery | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-index-columns-select/">pandas.DataFrameから条件を満たす行名・列名の行・列を抽出（選択） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 列名に.やスペースが含まれていたり、数値だったりするとNG。</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 &amp; point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 and point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 | point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 or point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;not age &lt; 25 and not point &gt; 65&#39;</span><span class="p">))</span> <span class="c1"># not</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(age == 24 | point &gt; 80) &amp; state == &quot;CA&quot;&#39;</span><span class="p">))</span> <span class="c1"># 優先順位付ける場合は()で囲む</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age_year &gt; 25&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;name.str.endswith(&quot;e&quot;)&#39;</span><span class="p">))</span> <span class="c1"># name列のデータでeで終わるもの</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;name.str.contains(&quot;li&quot;)&#39;</span><span class="p">))</span> <span class="c1"># name列のデータでliを含むもの</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;name.str.match(&quot;.*i.*e&quot;)&#39;</span><span class="p">))</span> <span class="c1"># 正規表現</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age.astype(&quot;str&quot;).str.endswith(&quot;8&quot;)&#39;</span><span class="p">))</span> <span class="c1"># 数値の場合はastypeで変換してから使用</span>

<span class="c1"># クエリでは対象の列にnanがあるとエラーになるので、あらかじめ値を埋めておく</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 欠損値を&#39;Alice&#39;で埋める</span>
</pre></div>
</div>
</section>
<section id="id103">
<h4>データ同士の結合/集合演算<a class="headerlink" href="#id103" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.kite.com/python/answers/how-to-select-rows-from-a-pandas-dataframe-based-on-a-list-of-indexes-in-python">How to select rows from a Pandas DataFrame based on a list of indexes in Python</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># データBからデータAに含まれないインデックスを削除</span>
<span class="n">delete_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_B</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_A</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">df_B</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">delete_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># AとBの重複する要素だけをBから取り出し</span>
<span class="n">prod_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_B</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_A</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">df_B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prod_list</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">df_B</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prod_list</span><span class="p">]</span> <span class="c1"># これも可</span>
</pre></div>
</div>
</section>
<section id="id104">
<h4>任意の列を結合して新しいデータを作成<a class="headerlink" href="#id104" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-merge-join/">pandas.DataFrameを結合するmerge, join（列・インデックス基準） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-concat/">pandas.DataFrame, Seriesを連結するconcat | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-assign-append/">pandas.DataFrameに列や行を追加（assign, appendなど） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 列方向に結合</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># dfから取り出すとき</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;my_category_index&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">]]</span>

<span class="c1"># あるデータのすべての列と他のデータの任意の列でも可</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id105">
<h4>複数の列の要素を引数に取った関数を適用<a class="headerlink" href="#id105" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://teratail.com/questions/134846">Python - Pandasで複数の列の要素を引数に取った関数を適用させる｜teratail</a></p></li>
</ul>
</section>
<section id="id106">
<h4>列の項目名をリストで取得<a class="headerlink" href="#id106" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</section>
<section id="id">
<h4>列のID名をリストで取得<a class="headerlink" href="#id" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://teratail.com/questions/157187">pandas - データフレームのindexの番号を全て取得したい｜teratail</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</section>
<section id="settingwithcopywarning">
<h4>特定の項目の値を変更 (SettingWithCopyWarningの対処法)<a class="headerlink" href="#settingwithcopywarning" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-at-iat-loc-iloc/">pandasで任意の位置の値を取得・変更するat, iat, loc, iloc | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-setting-with-copy-warning/">pandasのSettingWithCopyWarningの対処法 | note.nkmk.me</a></p>
<ul>
<li><p>[]を2回以上続けるとコピーが返される可能性があり、値の変更ができないことがあるので注意</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="c1"># 行、列で指定して読み書きできる</span>
<span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">])</span>

<span class="n">df_bodyshape</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># 行にインデックスも指定可能</span>
<span class="n">df_bodyshape</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="s2">&quot;hoge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># 新規項目も追加できる</span>

<span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span> <span class="c1"># インデックス指定も可</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>

<span class="c1"># queryを使った場合も発生するかも？copyで回避できるっぽい？</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;aaa != aaa&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ビューではなくコピーに対して代入処理をしているため、元のデータは変更されない</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]][</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># []を一つにまとめて、連鎖させなければ元のデータが変更される</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># 行名・列名（行ラベル・列ラベル）と行番号・列番号を組み合わせて範囲を指定したいときはどちらかに合わせる</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="c1"># ラベル名に統一</span>

<span class="c1"># 番号で統一する場合, ilocとlocで終点の判定が違うので注意</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="c1"># 0,1まで (通常のスライス)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="c1"># 末尾が含まれる</span>

</pre></div>
</div>
<section id="bool">
<h5>bool配列でフィルタして変更<a class="headerlink" href="#bool" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/23400743/pandas-modify-column-values-in-place-based-on-boolean-array">python - Pandas modify column values in place based on boolean array - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;e$&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;Blue&#39;</span> <span class="c1"># name列の項目で末尾にeが含まれる文字列を検索→Trueならflag列をBlueにする</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;e$&#39;</span><span class="p">),</span> <span class="s1">&#39;flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Blue&#39;</span> <span class="c1"># CopyWarning出ない方法</span>

<span class="c1"># 他の例</span>
<span class="n">main_group_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;aaa&quot;</span><span class="p">:</span> <span class="s2">&quot;bbb&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">main_group_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">df_bool</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hoge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_bool</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</pre></div>
</div>
</section>
</section>
<section id="id107">
<h4>行名、列名一覧<a class="headerlink" href="#id107" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="c1"># 列名</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="c1"># 行名</span>
</pre></div>
</div>
</section>
<section id="id108">
<h4>行名、列名の存在確認<a class="headerlink" href="#id108" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;A&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="s2">&quot;B&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</section>
<section id="id109">
<h4>行名、列名の変更<a class="headerlink" href="#id109" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-dataframe-rename/">pandas.DataFrameの行名・列名の変更 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 列名、行名それぞれ変更できる</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;Col_1&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;Col_2&#39;</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ONE&#39;</span><span class="p">:</span> <span class="s1">&#39;Row_1&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 関数を渡すこともできる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>

<span class="c1"># ラムダ関数も渡せる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;!!&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>プレフィックス・サフィックスも追加できる</p>
</section>
<section id="id110">
<h4>データをランダムに表示<a class="headerlink" href="#id110" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id111">
<h4>含まれるデータ型の表示<a class="headerlink" href="#id111" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id112">
<h4>データの洗浄<a class="headerlink" href="#id112" title="Permalink to this heading"></a></h4>
<section id="id113">
<h5>欠損値除外<a class="headerlink" href="#id113" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-nan-dropna-fillna/">pandasで欠損値NaNを除外（削除）・置換（穴埋め）・抽出 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 欠損値がある部分を削除 (オプションは上のリンク参照)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">]))</span> <span class="c1"># 指定した列について欠損値がある行を削除</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The data contains </span><span class="si">{}</span><span class="s2"> rows and </span><span class="si">{}</span><span class="s2"> columns&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># The data contains 117 rows and 34 columns</span>
<span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># 列がすべてNoneのものは除外</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id114">
<h5>欠損値置換<a class="headerlink" href="#id114" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-nan-fillna/">pandasで欠損値NaNを置換（穴埋め）するfillna | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;XXX&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}))</span> <span class="c1"># name列のNaNをXXXに、age列のNaNを20にする</span>
</pre></div>
</div>
</section>
<section id="nan">
<h5>NaNを含む行・列を抽出<a class="headerlink" href="#nan" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-nan-extract/">pandasで欠損値NaNを含む行・列を抽出 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 特定の列に欠損値が含まれている行を抽出したい場合</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])</span>

<span class="c1"># 特定の行に欠損値が含まれている列を抽出したい場合</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])</span>
</pre></div>
</div>
</section>
<section id="id115">
<h5>特定の列名を削除<a class="headerlink" href="#id115" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;日付&quot;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id116">
<h5>特定の行を削除<a class="headerlink" href="#id116" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-drop/">pandas.DataFrameの行・列を指定して削除するdrop | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Charlie&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Dave&#39;</span><span class="p">,</span> <span class="s1">&#39;Frank&#39;</span><span class="p">]))</span> <span class="c1"># 複数行まとめて削除</span>

<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Dave&#39;</span><span class="p">,</span> <span class="s1">&#39;Frank&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># df自体を変更</span>

<span class="n">df2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># ID=1,2,4が削除される</span>
</pre></div>
</div>
</section>
<section id="id117">
<h5>条件を満たす行を削除・抽出<a class="headerlink" href="#id117" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-query/">pandas.DataFrameの行を条件で抽出するquery | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/github-nakasho/items/47a8430bad54fc0c9ad0">Pandasでデータを操る。ある列に特定の文字(文字列)を含んだ行を削除編 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-str-contains-match/">pandasで特定の文字列を含む行を抽出（完全一致、部分一致） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-multiple-conditions/">pandasで複数条件のAND, OR, NOTから行を抽出（選択） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-count-condition/">pandasで特定の条件を満たす要素数をカウント（全体、行・列ごと） | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/19155718/select-pandas-rows-based-on-list-index">python - Select Pandas rows based on list index - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/dox/items/bf6ce1c71d8d18723e74">pandas.DataFrame.queryによるデータ抽出10選 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25&#39;</span><span class="p">))</span> <span class="c1"># 上と同様の結果</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;not age &lt; 25&#39;</span><span class="p">))</span> <span class="c1"># 否定</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;24 &lt;= age &lt; 50&#39;</span><span class="p">))</span>

<span class="c1"># 変数を使う例</span>
<span class="n">val</span> <span class="o">=</span> <span class="mi">80</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;point &gt; @val&#39;</span><span class="p">))</span>

<span class="c1"># 複数条件</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;point&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">65</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 &amp; point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 and point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 | point &gt; 65&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;age &lt; 25 or point &gt; 65&#39;</span><span class="p">))</span>

<span class="c1"># 任意の列に特定の文字列を含む行を削除</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)]</span> <span class="c1"># ALT列にaaaが含まれる行を削除する</span>
<span class="n">df_extract</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span> <span class="c1"># ALT列にaaaが含まれる行をbool値で抽出できる</span>
<span class="n">df_extract</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># ヒットした数の総数が分かる</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span> <span class="c1"># デフォルトでは正規表現が有効になっている。無効化したいときはオプション追加</span>

<span class="c1"># 複数条件で抽出する場合</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ALT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">df1</span> <span class="o">|</span> <span class="n">df2</span><span class="p">]</span> <span class="c1"># or</span>
<span class="n">df</span><span class="p">[</span><span class="n">df1</span> <span class="o">&amp;</span> <span class="n">df2</span><span class="p">]</span> <span class="c1"># and</span>

<span class="c1"># bool配列を自分で定義してやることも可能</span>
<span class="n">df_bool</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df_bool</span><span class="p">]</span> <span class="c1"># dfのインデックスは0~順番に並んでいないとエラーになる(csvを読むときにはcolumnオプションを付けないこと or reset_index()する)</span>

<span class="c1"># 抽出したいindexをリスト型で指定</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span> <span class="c1"># indexが1,3,6のものが抽出される</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span> <span class="c1"># 配列番号で1,3,6番目のものが抽出される</span>

<span class="c1"># d列の値が欠損である行を抽出</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39; d != d&#39;</span><span class="p">)</span>

<span class="c1"># d列の値が欠損でない行を抽出</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39; d == d&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id118">
<h5>列名の置換/変更<a class="headerlink" href="#id118" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">att_rename_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;名前&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;年齢&quot;</span><span class="p">:</span> <span class="s2">&quot;age&quot;</span><span class="p">}</span>
<span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">att_rename_dict</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id119">
<h5>インデックス名の変更<a class="headerlink" href="#id119" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/19851005/rename-pandas-dataframe-index">python - Rename Pandas DataFrame Index - Stack Overflow</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_stored</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;item_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id120">
<h5>値を0.5単位に揃える<a class="headerlink" href="#id120" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="c1"># column name</span>
<span class="n">transformed_targets</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_names</span><span class="p">]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">target_names</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_targets</span>
</pre></div>
</div>
</section>
<section id="id121">
<h5>外れ値の除外<a class="headerlink" href="#id121" title="Permalink to this heading"></a></h5>
<p>queryを使用した方法</p>
<p>四分位数、σを使う方法 (1次元データ)</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/mizutaku17/items/6bd8e778b6e9ec7b162d">pandasのデータフレームから外れ値を含む行を取り除く - Qiita</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-nan-dropna-fillna/">pandasで欠損値NaNを除外（削除）・置換（穴埋め）・抽出 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outlier_iqr</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="c1"># 列を抽出する</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># 四分位数</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">describe</span><span class="p">()[</span><span class="s1">&#39;25%&#39;</span><span class="p">]</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">describe</span><span class="p">()[</span><span class="s1">&#39;75%&#39;</span><span class="p">]</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span> <span class="c1">#四分位範囲</span>

        <span class="c1"># 外れ値の基準点</span>
        <span class="n">outlier_min</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="n">iqr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="n">outlier_max</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="n">iqr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>

        <span class="c1"># 範囲から外れている値を除く</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&lt;</span> <span class="n">outlier_min</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&gt;</span> <span class="n">outlier_max</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># 外れ値を削除</span>
		<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outlier_2s</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="c1"># 列を抽出する</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># 平均と標準偏差</span>
        <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="c1"># 外れ値の基準点</span>
        <span class="n">outlier_min</span> <span class="o">=</span> <span class="n">average</span> <span class="o">-</span> <span class="p">(</span><span class="n">sd</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">outlier_max</span> <span class="o">=</span> <span class="n">average</span> <span class="o">+</span> <span class="p">(</span><span class="n">sd</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="c1"># 範囲から外れている値を除く</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&lt;</span> <span class="n">outlier_min</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">col</span><span class="p">[</span><span class="n">col</span> <span class="o">&gt;</span> <span class="n">outlier_max</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># 外れ値を削除</span>
		<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<p>IsolationForestを使用する (2次元データ)</p>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/papi_tokei/items/6f77a2a250752cfa850b">データに含まれる異常値を検出してみよう - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>

<span class="c1"># 回帰ダミーデータを作成する</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">coef</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">n_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_informative</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">bias</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">coef</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X =&quot;</span><span class="p">,</span> <span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Y =&quot;</span><span class="p">,</span> <span class="n">Y</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coef =&quot;</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>

<span class="c1"># 外れ値を追加する</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">]])])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">])</span>

<span class="c1"># X座標の値とY座標の値がばらばらなので、一つの変数にまとめる</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 生データすべてをプロットする</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;raw data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>

<span class="c1"># IsolationForestインスタンスを作成する</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span>
    <span class="n">contamination</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span> <span class="c1"># contaminationの割合を小さくするほど検出がシビアになる</span>

<span class="c1"># 学習用データを学習させる</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># 検証用データを分類する</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># IsolationForest は 正常=1 異常=-1 として結果を返す</span>
<span class="c1"># 外れ値と判定したデータを赤色でプロットする</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;outlier data(auto)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">X_train</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># 外れ値スコアを算出する 数値が小さいほど外れている判定</span>
<span class="n">outlier_score</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="c1"># 外れ値スコアの閾値を設定する</span>
<span class="n">THRETHOLD</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.08</span>
<span class="c1"># 外れ値スコア以下のインデックスを取得する</span>
<span class="n">predicted_outlier_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">outlier_score</span> <span class="o">&lt;</span> <span class="n">THRETHOLD</span><span class="p">)</span>

<span class="c1"># 外れ値と判定したデータを緑色でプロットする</span>
<span class="n">predicted_outlier</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">predicted_outlier_index</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;outlier data(manual)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">predicted_outlier</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">predicted_outlier</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id122">
<h4>行をシャッフル、データを分割<a class="headerlink" href="#id122" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-sample/">pandasの行・列をランダムサンプリング（抽出）するsample | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.04</span><span class="p">))</span> <span class="c1"># データ内の4%の行をランダムに抽出 (1ならすべてシャッフル)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span> <span class="c1"># データ数を直接指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># シードを固定</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># パーセンテージで取り出す割合を指定。1ですべてのデータがシャッフルされたものになる</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id123">
<h4>各行、各列でまとめて計算<a class="headerlink" href="#id123" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-map-applymap-apply/">pandasで要素、行、列に関数を適用するmap, applymap, apply | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="http://pixelbeat.jp/python-pandas-col-modifying-with-apply/">[Python/pandas]列の値を使って演算をして列に格納する方法 | pixelbeat sandbox</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 列名を直接指定して計算できる</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_int&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># applyを使っても同じことができる</span>
<span class="k">def</span> <span class="nf">hoge</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_int&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">hoge</span><span class="p">)</span>

<span class="c1"># applyでdf自体を入れるとき</span>
<span class="k">def</span> <span class="nf">double_then_add_string</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_int&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_str&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># axis = 1のオプションが必須</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_combined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">double_then_add_string</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id124">
<h4>boolのカウント<a class="headerlink" href="#id124" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_bool</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;hoge&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">df_bool</span><span class="p">)</span> <span class="c1"># Trueの数</span>
</pre></div>
</div>
</section>
<section id="nan-bool">
<h4>NaN/boolの判定<a class="headerlink" href="#nan-bool" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://kagglenote.com/misc/pandas_nan_judge/">PandasのNaNをif文で判定する – Kaggle Note</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>
<span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">])</span>

<span class="c1"># 以下は動作しない</span>
<span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">r</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">math</span><span class="o">.</span><span class="n">nan</span>

<span class="c1"># pandasのboolはnumpy型なので、isで比較するとおかしな結果になるため == を使うこと</span>
</pre></div>
</div>
</section>
<section id="id125">
<h4>重複する要素の総和を計算<a class="headerlink" href="#id125" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-duplicated-drop-duplicates/">pandas.DataFrame, Seriesの重複した行を抽出・削除 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-groupby-statistics/">pandas.DataFrameをGroupByでグルーピングし統計量を算出 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/src/sample_pandas_normal.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">#       name  age state  point</span>
<span class="c1"># 0    Alice   24    NY     64</span>
<span class="c1"># 1      Bob   42    CA     92</span>
<span class="c1"># 2  Charlie   18    CA     70</span>
<span class="c1"># 3     Dave   68    TX     70</span>
<span class="c1"># 4    Ellen   24    CA     88</span>
<span class="c1"># 5    Frank   30    NY     57</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="c1"># sum, min, maxなど使える</span>
<span class="c1">#         age      point</span>
<span class="c1"># state                 </span>
<span class="c1"># CA     28.0  83.333333</span>
<span class="c1"># NY     27.0  60.500000</span>
<span class="c1"># TX     68.0  70.000000</span>

<span class="c1"># 対象はインデックスでも可能</span>
<span class="n">df_stored_merge</span> <span class="o">=</span> <span class="n">df_stored</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;item_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id126">
<h4>平均・最大最小・標準偏差を一括で計算<a class="headerlink" href="#id126" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-describe/">pandasのdescribeで各列の要約統計量（平均、標準偏差など）を取得 | note.nkmk.me</a></p></li>
</ul>
<p>とりあえずデータの雰囲気をつかむのにとても便利</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id127">
<h4>パーセンタイル<a class="headerlink" href="#id127" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-quantile/">pandasで分位数・パーセンタイルを取得するquantile | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># 80%パーセンタイル</span>
</pre></div>
</div>
</section>
<section id="id128">
<h4>最頻値<a class="headerlink" href="#id128" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://messefor.hatenablog.com/entry/2020/08/23/082248">Pythonでmode(最頻値)を算出する最良の方法 - 無粋な日々に</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>  <span class="c1"># has 3 modes: [2, 3, 4]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id129">
<h4>相関係数<a class="headerlink" href="#id129" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">boston_df</span><span class="p">[[</span><span class="s1">&#39;RM&#39;</span><span class="p">,</span><span class="s1">&#39;MEDV&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span> <span class="c1"># 複数の要素が指定可能</span>
</pre></div>
</div>
</section>
<section id="id130">
<h4>尖度・歪度<a class="headerlink" href="#id130" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numerical_feats</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:15}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> 
          <span class="s1">&#39;Mean: </span><span class="si">{:05.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> 
          <span class="s1">&#39;Std: </span><span class="si">{:05.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()),</span> 
          <span class="s1">&#39;Skewness: </span><span class="si">{:05.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span> <span class="c1"># 歪度</span>
          <span class="s1">&#39;Kurtosis: </span><span class="si">{:06.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">kurt</span><span class="p">())</span>  <span class="c1"># 尖度</span>
         <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id131">
<h4>文字列で行を抽出<a class="headerlink" href="#id131" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/github-nakasho/items/47a8430bad54fc0c9ad0">Pandasでデータを操る。ある列に特定の文字(文字列)を含んだ行を削除編 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-str-contains-match/">pandasで特定の文字列を含む行を抽出（完全一致、部分一致） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CA&#39;</span><span class="p">]</span> <span class="c1"># state列がCAのものを抽出(完全一致)</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)]</span> <span class="c1"># name列にliが含まれるものを抽出(正規表現)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># NaNのケースはスキップ</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LI&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># 大文字小文字を区別しない</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;LI&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># 正規表現を使わない</span>
</pre></div>
</div>
</section>
<section id="datetime">
<h4>日付の文字列をdatetime型に<a class="headerlink" href="#datetime" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/mSpring/items/6ec1ab28dcb261db2c73">pandasのDataFrameから期間を範囲指定して抽出する - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;日付&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;日付&#39;</span><span class="p">])</span> <span class="c1"># 標準的なフォーマットはこれで変換できる</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;日時&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;日時&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m月</span><span class="si">%d</span><span class="s1">日-%H:%M&#39;</span><span class="p">)</span> <span class="c1"># 表記方法が通常では対応できない場合</span>
</pre></div>
</div>
</section>
<section id="id132">
<h4>時刻で行を抽出<a class="headerlink" href="#id132" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;日付&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">df1</span><span class="p">[(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;日付&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;日付&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))]</span>
</pre></div>
</div>
</section>
<section id="id133">
<h4>項目(セルの中身)の置換<a class="headerlink" href="#id133" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-replace/">pandas.DataFrame, Seriesの要素の値を置換するreplace | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">,</span> <span class="s1">&#39;LI&#39;</span><span class="p">))</span> <span class="c1"># 検索文字列、置換文字列, デフォルトではすべてのセルが対象, 完全一致で置換</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(.*)li(.*)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1LI\2&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="c1"># 正規表現使う場合 \1 → $1に相当</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;CA&#39;</span><span class="p">:</span> <span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span> <span class="mi">100</span><span class="p">}))</span> <span class="c1"># 辞書で指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">]))</span> <span class="c1"># リストで指定</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">24</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">24</span><span class="p">:</span> <span class="mi">50</span><span class="p">}}))</span> <span class="c1"># 置換対象の列を指定</span>
</pre></div>
</div>
</section>
<section id="id134">
<h4>データの概要を表示<a class="headerlink" href="#id134" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pandas-profiling">
<h4><a class="reference external" href="https://github.com/pandas-profiling/pandas-profiling">pandas-profiling</a><a class="headerlink" href="#pandas-profiling" title="Permalink to this heading"></a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas-profiling
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_profiling</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">pandas_profiling</span><span class="o">.</span><span class="n">ProfileReport</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;../material/pandas_profiling.html&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Visualize directly in the notebook (or open the HTML file externally)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># use any of the following</span>
<span class="n">profile</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_widgets</span><span class="p">()</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_notebook_iframe</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id135">
<h4>その他のprofiling<a class="headerlink" href="#id135" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://ichi.pro/4-tsu-no-python-ko-do-de-eda-o-jikko-dekiru-raiburari-12178707580590">4つのPythonコードでEDAを実行できるライブラリ</a></p></li>
<li><p><a class="reference external" href="https://www.codexa.net/basic-exploratory-data-analysis-with-python/">【データサイエンティスト入門編】探索的データ解析（EDA）の基礎操作をPythonを使ってやってみよう</a></p></li>
</ul>
<section id="id136">
<h5>pandas-profiling<a class="headerlink" href="#id136" title="Permalink to this heading"></a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas-profiling
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_profiling</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">pandas_profiling</span><span class="o">.</span><span class="n">ProfileReport</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
<span class="c1"># ProfileReport(pd.read_csv(&#39;titanic.csv&#39;), explorative=True)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;../material/pandas_profiling.html&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># Visualize directly in the notebook (or open the HTML file externally)</span>
<span class="c1"># use any of the following</span>
<span class="n">profile</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_widgets</span><span class="p">()</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_notebook_iframe</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="sweetviz">
<h5>sweetviz<a class="headerlink" href="#sweetviz" title="Permalink to this heading"></a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>sweetviz
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sweetviz</span> <span class="k">as</span> <span class="nn">sv</span>

<span class="c1">#EDA using Autoviz</span>
<span class="n">sweet_report</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;titanic.csv&quot;</span><span class="p">))</span>

<span class="c1">#Saving results to HTML file</span>
<span class="n">sweet_report</span><span class="o">.</span><span class="n">show_html</span><span class="p">(</span><span class="s1">&#39;sweet_report.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="autoviz">
<h5>autoviz<a class="headerlink" href="#autoviz" title="Permalink to this heading"></a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>autoviz
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">autoviz.AutoViz_Class</span> <span class="kn">import</span> <span class="n">AutoViz_Class</span>

<span class="c1">#EDA using Autoviz</span>
<span class="n">autoviz</span> <span class="o">=</span> <span class="n">AutoViz_Class</span><span class="p">()</span><span class="o">.</span><span class="n">AutoViz</span><span class="p">(</span><span class="s1">&#39;train.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dtale">
<h5>dtale<a class="headerlink" href="#dtale" title="Permalink to this heading"></a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>dtale
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dtale</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">dtale</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;titanic.csv&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="pandas-plot">
<h3>Pandas: plot<a class="headerlink" href="#pandas-plot" title="Permalink to this heading"></a></h3>
<p>matplotのラッパーがPandasに実装されている</p>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-plot/">pandasのplotメソッドでグラフを作成しデータを可視化 | note.nkmk.me</a></p></li>
</ul>
<section id="id137">
<h4>ラベル表示<a class="headerlink" href="#id137" title="Permalink to this heading"></a></h4>
<p>matplotのやり方がそのまま使える</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id138">
<h4>折れ線<a class="headerlink" href="#id138" title="Permalink to this heading"></a></h4>
<p>デフォルトでは各数値列の折れ線データ</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/pandas_iris_line.png"><img alt="_images/pandas_iris_line.png" src="_images/pandas_iris_line.png" style="width: 30%;" /></a>
</section>
<section id="id139">
<h4>ヒストグラム(ビン図)<a class="headerlink" href="#id139" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://deepage.net/features/pandas-hist.html">Pandasでヒストグラムの作成や頻度を出力する方法 - DeepAge</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id140">
<h4>散布図<a class="headerlink" href="#id140" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_bodyshape</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;hoge&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="id141">
<h5>プロット図の各点にラベル付け<a class="headerlink" href="#id141" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/kujirahand/items/bdc574102148c7f1f041">Pandasで散布図を書くとき各要素のラベルを表示 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># DataFrameにデータをセット</span>
<span class="n">dd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="s1">&#39;hoge&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="s1">&#39;fpp&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="s1">&#39;baa&#39;</span><span class="p">]</span>
    <span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

<span class="c1"># 散布図を描画</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;ay&#39;</span><span class="p">)</span>
<span class="c1"># 各要素にラベルを表示</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">a</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">df_bodyshape</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;hoge&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df_bodyshape</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;hoge&quot;</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1"># kは df_bodyshape.index.valuesの値が入る</span>
    <span class="c1"># vは Series型なので、列名でアクセス可能</span>
</pre></div>
</div>
</section>
<section id="id142">
<h5>プロット図の点ごとに色分け<a class="headerlink" href="#id142" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
<span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#00FF00&#39;</span><span class="p">,</span> <span class="s1">&#39;#00FFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;#FFFF00&#39;</span><span class="p">,</span> <span class="s1">&#39;#AAFF00&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id143">
<h4>棒グラフ<a class="headerlink" href="#id143" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;AVG&quot;</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="s2">&quot;STD&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span> <span class="c1"># STDは標準偏差を計算した結果を入れた列名</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE (cm)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id144">
<h4>箱ひげ図<a class="headerlink" href="#id144" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/pandas_iris_box.png"><img alt="_images/pandas_iris_box.png" src="_images/pandas_iris_box.png" style="width: 30%;" /></a>
</section>
<section id="id145">
<h4>画像を保存<a class="headerlink" href="#id145" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;data/dst/pandas_iris_line.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="seaborn">
<h3>seaborn<a class="headerlink" href="#seaborn" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://seaborn.pydata.org/index.html">seaborn: statistical data visualization — seaborn 0.11.1 documentation</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/ryo111/items/bf24c8cf508ad90cfe2e">【Python】seabornのグラフを活用したデータ分析の手法メモ - Qiita</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>seaborn
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span> 
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;House Price/train.csv&#39;</span><span class="p">)</span>
<span class="c1"># SalePrice が目的変数データ</span>
</pre></div>
</div>
<section id="id146">
<h4>棒グラフ<a class="headerlink" href="#id146" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;YrSold&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">);</span> <span class="c1"># 列名、df</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_18d033a5-ed03-5c60-c3b7-4299190e99c4.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_18d033a5-ed03-5c60-c3b7-4299190e99c4.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_18d033a5-ed03-5c60-c3b7-4299190e99c4.png" style="width: 30%;" /></a>
</section>
<section id="id147">
<h4>ヒストグラム<a class="headerlink" href="#id147" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">YearBuilt</span><span class="p">);</span> <span class="c1"># df.列名</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_b307093c-622f-8e56-db63-7701e8a48b77.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_b307093c-622f-8e56-db63-7701e8a48b77.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_b307093c-622f-8e56-db63-7701e8a48b77.png" style="width: 30%;" /></a>
</section>
<section id="id148">
<h4>散布図<a class="headerlink" href="#id148" title="Permalink to this heading"></a></h4>
<p>pandasの関数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_4badf4e1-405b-71e5-f2e1-a3d9b564d843.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_4badf4e1-405b-71e5-f2e1-a3d9b564d843.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_4badf4e1-405b-71e5-f2e1-a3d9b564d843.png" style="width: 30%;" /></a>
<p>線形回帰直線を含むタイプ</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">LotFrontage</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_91c41290-d150-c258-eb5c-d178915be4bb.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_91c41290-d150-c258-eb5c-d178915be4bb.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_91c41290-d150-c258-eb5c-d178915be4bb.png" style="width: 30%;" /></a>
</section>
<section id="id149">
<h4>複数散布図をまとめて表示<a class="headerlink" href="#id149" title="Permalink to this heading"></a></h4>
<p>pltをループ処理でやってるだけ</p>
<p>目的変数（SalePrice）と他の数値データの相関関係をまとめて表示します。
最大表示可能数は30なので、変数が30を超える場合は全て表示できません。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#数値データの列のみに絞る</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>

<span class="c1">#グラフを作る</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>  <span class="c1">#30が最大</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_n</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df_n</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">)</span>

<span class="c1">#グラフを整えて表示</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_ed90ee59-7439-08fb-4a8d-67bb9d932d8f.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_ed90ee59-7439-08fb-4a8d-67bb9d932d8f.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_ed90ee59-7439-08fb-4a8d-67bb9d932d8f.png" style="width: 30%;" /></a>
</section>
<section id="id150">
<h4>ボックスプロット(箱ひげ図)<a class="headerlink" href="#id150" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;SaleCondition&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_83412e8c-6185-3794-b8d6-348b2e965036.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_83412e8c-6185-3794-b8d6-348b2e965036.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_83412e8c-6185-3794-b8d6-348b2e965036.png" style="width: 30%;" /></a>
</section>
<section id="id151">
<h4>ボックスプロットの一覧表示<a class="headerlink" href="#id151" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">])</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">categorical_features</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">([</span><span class="s1">&#39;MISSING&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;MISSING&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
    <span class="n">x</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>  <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">boxplot</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;SalePrice&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_cd2ace26-8cd1-1f59-a933-de8a9463b12a.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_cd2ace26-8cd1-1f59-a933-de8a9463b12a.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_cd2ace26-8cd1-1f59-a933-de8a9463b12a.png" style="width: 30%;" /></a>
</section>
<section id="id152">
<h4>ヒートマップ<a class="headerlink" href="#id152" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-pandas-corr/">pandas.DataFrameの各列間の相関係数を算出、ヒートマップで可視化 | note.nkmk.me</a></p></li>
</ul>
<p>色が明るいほど相関性が高い</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_29cc4363-4783-0996-4e7b-cd97a4a5b980.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_29cc4363-4783-0996-4e7b-cd97a4a5b980.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_29cc4363-4783-0996-4e7b-cd97a4a5b980.png" style="width: 50%;" /></a>
<section id="id153">
<h5>ヒートマップで相関度高い順に表示<a class="headerlink" href="#id153" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="c1"># 大きい方から10個だけ取り出し</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">cols</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">});</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_f1ce035d-f5ef-afdd-d40e-f91ad5ec6c69.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_f1ce035d-f5ef-afdd-d40e-f91ad5ec6c69.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_f1ce035d-f5ef-afdd-d40e-f91ad5ec6c69.png" style="width: 50%;" /></a>
</section>
</section>
<section id="id154">
<h4>ペアプロット<a class="headerlink" href="#id154" title="Permalink to this heading"></a></h4>
<p>任意の列同士の相関性を見る</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span> <span class="s1">&#39;1stFlrSF&#39;</span><span class="p">,</span> <span class="s1">&#39;PoolArea&#39;</span><span class="p">,</span> <span class="s1">&#39;OverallQual&#39;</span><span class="p">]</span> <span class="c1">#任意の列を指定、さらに増やしてもよい</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_2392c641-a366-45d4-0bb7-3c23b996a9f9.png"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_2392c641-a366-45d4-0bb7-3c23b996a9f9.png" src="_images/https___qiita-image-store.s3.amazonaws.com_0_278569_2392c641-a366-45d4-0bb7-3c23b996a9f9.png" style="width: 50%;" /></a>
</section>
</section>
<section id="matplotlib">
<h3>matplotlib<a class="headerlink" href="#matplotlib" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/0NE_shoT_/items/31a77b6228159d6feb2e">Matplotlibでデータ可視化 - Qiita</a></p></li>
<li><p>https://matplotlib.org/stable/users/getting_started/</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>matplotlib
</pre></div>
</div>
<section id="id155">
<h4>ヒストグラム(ビン図)<a class="headerlink" href="#id155" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;LSTAT&#39;</span><span class="p">])</span> <span class="c1"># ヒストグラムをプロット</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of LSTAT&#39;</span><span class="p">)</span> <span class="c1"># 図のタイトル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% lo</span><span class="s1">wer status of the population [LSTAT]&#39;</span><span class="p">)</span> <span class="c1"># x軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span> <span class="c1"># y軸のラベル</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># 図の表示</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_14b78de7-0c59-d2d5-da71-15ea3bb79191.jpeg"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_14b78de7-0c59-d2d5-da71-15ea3bb79191.jpeg" src="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_14b78de7-0c59-d2d5-da71-15ea3bb79191.jpeg" style="width: 30%;" /></a>
<p>ヒストグラムのオプション</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;LSTAT&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># ビンの数を指定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;LSTAT&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span> <span class="c1"># 値の範囲を設定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;LSTAT&#39;</span><span class="p">],</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 累積ヒストグラム</span>
</pre></div>
</div>
</section>
<section id="id156">
<h4>散布図<a class="headerlink" href="#id156" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;LSTAT&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">boston_df</span><span class="p">[</span><span class="s1">&#39;MEDV&#39;</span><span class="p">])</span> <span class="c1"># 散布図をプロット</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scatter Plot of LSTAT vs MEDV&#39;</span><span class="p">)</span> <span class="c1"># 図のタイトル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% lo</span><span class="s1">wer status of the population [LSTAT]&#39;</span><span class="p">)</span> <span class="c1"># x軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prices in $1000</span><span class="se">\&#39;</span><span class="s1">s [MEDV]&#39;</span><span class="p">)</span> <span class="c1"># y軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># グリッド線を表示</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># 図の表示</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8f840b48-bb9d-8a42-695f-896003b9f354.jpeg"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8f840b48-bb9d-8a42-695f-896003b9f354.jpeg" src="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8f840b48-bb9d-8a42-695f-896003b9f354.jpeg" style="width: 30%;" /></a>
</section>
<section id="id157">
<h4>折れ線グラフ<a class="headerlink" href="#id157" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor1&#39;</span><span class="p">])</span> <span class="c1"># [x, y] 折れ線グラフをプロット</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor1 value&#39;</span><span class="p">)</span> <span class="c1"># 図のタイトル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span> <span class="c1"># x軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span> <span class="c1"># y軸のラベル</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># 図の表示</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_0ab8b6ef-79de-fce0-b12f-7be083de5e9e.jpeg"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_0ab8b6ef-79de-fce0-b12f-7be083de5e9e.jpeg" src="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_0ab8b6ef-79de-fce0-b12f-7be083de5e9e.jpeg" style="width: 30%;" /></a>
</section>
<section id="id158">
<h4>棒グラフ<a class="headerlink" href="#id158" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html">matplotlib.pyplot.bar — Matplotlib 3.4.1 documentation</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.barh.html">matplotlib.pyplot.barh — Matplotlib 3.4.1 documentation</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hoge&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_body</span><span class="p">[</span><span class="s2">&quot;moo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">df_body</span><span class="p">[</span><span class="s2">&quot;koo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;test_max_error&quot;</span><span class="p">])</span> <span class="c1"># 列毎に棒グラフを作る</span>
</pre></div>
</div>
</section>
<section id="id159">
<h4>複数の画像をまとめて表示<a class="headerlink" href="#id159" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/65909655/how-do-i-display-multiple-images-from-one-cell-in-a-jupyter-notebook">python - How do I display multiple images from one cell in a Jupyter notebook - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/hiroshi_ichihara/items/810a4839a1be0afe08c6">【Python】複数グラフを描くときはravel()が便利 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># axes.ravel()は1次元のリストになる</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id160">
<h4>複数グラフをまとめて表示<a class="headerlink" href="#id160" title="Permalink to this heading"></a></h4>
<p>showを呼び出す前に複数回plot関数を呼び出す</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># 複数の折れ線グラフをプロット：線の色（color）・点のマーカー（marker）・線の種類（linetype）・凡例表示のためのラベル（label）でグラフを区別</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor1&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor2&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor3&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor4&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor4&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor value&#39;</span><span class="p">)</span> <span class="c1"># 図のタイトル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>                  <span class="c1"># x軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>                     <span class="c1"># y軸のラベル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>         <span class="c1"># 凡例を右上（upper right）に表示</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">])</span>                      <span class="c1"># x軸方向の表示範囲を指定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">250</span><span class="p">,</span> <span class="mi">800</span><span class="p">])</span>                    <span class="c1"># y軸方向の表示範囲を指定</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>                              <span class="c1"># 図の表示</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_c05b0687-c521-dcd3-17c2-26074b2ad381.jpeg"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_c05b0687-c521-dcd3-17c2-26074b2ad381.jpeg" src="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_c05b0687-c521-dcd3-17c2-26074b2ad381.jpeg" style="width: 30%;" /></a>
</section>
<section id="id161">
<h4>複数の図にグラフ表示<a class="headerlink" href="#id161" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="http://ailaby.com/subplots_adjust/">matplotlib subplot。グラフ間の間隔を調整－python | コード７区</a></p></li>
<li><p><a class="reference external" href="http://urusulambda.com/2018/05/19/matplotlib%E3%81%AEplot%E8%A1%A8%E7%A4%BA%E3%82%B5%E3%82%A4%E3%82%BA%E3%82%84%E5%87%BA%E5%8A%9B%E7%94%BB%E5%83%8F%E3%81%AE%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95%E3%82%92/">MatplotlibのPlot表示サイズや出力画像のサイズの大きさを変更する(Python) | Urusu Lambda Web</a></p></li>
</ul>
<p>方法1: axeのアドレスで指定</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># 図を2行2列に分割</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span> <span class="c1"># 余白を調整したいとき</span>

<span class="c1"># 各領域で折れ線グラフをプロット</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor1&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor1&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor2&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor2&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor3&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor3&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor4&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor4&#39;</span><span class="p">)</span>
<span class="c1"># axe[i,j].bar(x=df.columns, height=df.loc[item]) # 棒グラフ</span>

<span class="c1"># 各グラフのタイトル・x軸のラベル・y軸のラベルを設定</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor1 value&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor2 value&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor3 value&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor4 value&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">axe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> <span class="c1"># ラベル・タイトルが被らないように配置</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>         <span class="c1"># 図の表示</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8c4d4bed-e69d-e821-18d0-9b69847c9191.jpeg"><img alt="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8c4d4bed-e69d-e821-18d0-9b69847c9191.jpeg" src="_images/https___qiita-image-store.s3.amazonaws.com_0_258694_8c4d4bed-e69d-e821-18d0-9b69847c9191.jpeg" style="width: 30%;" /></a>
<p>方法2: subplotで場所を指定</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 2行2列の1番目のグラフ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor1&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor1 value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># 2行2列の2番目のグラフ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor2&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor2 value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># 2行2列の3番目のグラフ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor3&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor3 value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># 2行2列の4番目のグラフ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor4&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor4 value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>方法3: <code class="docutils literal notranslate"><span class="pre">add_subplot</span></code>使用</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor1&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor1&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor1 value&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor2&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor2&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor2 value&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor3&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor3&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor3 value&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">sensor_df</span><span class="p">[</span><span class="s1">&#39;Sensor4&#39;</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Sensor4&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Transition of Sensor4 value&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id162">
<h4>複数の図に複数のビン図<a class="headerlink" href="#id162" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヒストグラムを作成</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-setosa&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-versicolor&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-virginica&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Petal Length Cm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cm Measurement&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Iris-setosa&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-versicolor&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-virginica&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-setosa&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-versicolor&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">PetalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-virginica&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Petal Width Cm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cm Measurement&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Iris-setosa&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-versicolor&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-virginica&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="n">p3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-setosa&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-versicolor&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalLengthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-virginica&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sepal Length Cm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cm Measurement&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Iris-setosa&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-versicolor&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-virginica&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sepal Length Cm&#39;</span><span class="p">)</span>

<span class="n">p4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-setosa&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-versicolor&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Iris</span><span class="o">.</span><span class="n">SepalWidthCm</span><span class="p">[</span><span class="n">Iris</span><span class="o">.</span><span class="n">Species</span> <span class="o">==</span> <span class="s1">&#39;Iris-virginica&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sepal Width Cm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cm Measurement&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Iris-setosa&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-versicolor&quot;</span><span class="p">,</span> <span class="s2">&quot;Iris-virginica&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<a class="reference internal image-reference" href="_images/stacked-hist-1024x548.png"><img alt="_images/stacked-hist-1024x548.png" src="_images/stacked-hist-1024x548.png" style="width: 70%;" /></a>
<p>散布図マトリックス</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヒストグラムと散布図の行列を作成</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">scatter_matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">scatter_matrix</span><span class="p">(</span><span class="n">Iris</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">diagonal</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/scatter-hist-mat-1024x522.png"><img alt="_images/scatter-hist-mat-1024x522.png" src="_images/scatter-hist-mat-1024x522.png" style="width: 70%;" /></a>
</section>
<section id="id163">
<h4>プロット図の各点にラベル付け<a class="headerlink" href="#id163" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/14432557/matplotlib-scatter-plot-with-different-text-at-each-data-point">python - Matplotlib scatter plot with different text at each data point - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/stable/tutorials/text/annotations.html">Annotations — Matplotlib 3.4.0 documentation</a></p></li>
<li><p>https://matplotlib.org/stable/api/text_api.html#matplotlib.text.Text</p></li>
</ul>
<p>テキストデータをプロットの座標に重ねて表示することで疑似的にラベル付けをしている</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.56422</span><span class="p">,</span> <span class="mf">3.77284</span><span class="p">,</span> <span class="mf">3.52623</span><span class="p">,</span> <span class="mf">3.51468</span><span class="p">,</span> <span class="mf">3.02199</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">58</span><span class="p">,</span> <span class="mi">651</span><span class="p">,</span> <span class="mi">393</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">123</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># ラベルサイズを調整する場合</span>
</pre></div>
</div>
</section>
<section id="id164">
<h4>プロットの点の大きさを調整<a class="headerlink" href="#id164" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/maskot1977/items/d359a3fd8a71ee97a1c7">matplotlibの点の大きさについて - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># 色は黒、点のサイズはsで指定</span>
</pre></div>
</div>
</section>
<section id="x-y">
<h4>プロットのx,y軸にラベルを設定<a class="headerlink" href="#x-y" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span><span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x-label&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y-label&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id165">
<h4>画像を保存<a class="headerlink" href="#id165" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://stackoverflow.com/questions/39712767/how-to-set-size-for-scatter-plot</p></li>
</ul>
<p>画像の拡大・縮小はdpiを大きくすると画像が大きくできる</p>
<p>figsizeの比率は変えても意味がない？</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;pic.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<section id="plt-figure">
<h5>plt.figureで保存<a class="headerlink" href="#plt-figure" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://python.atelierkobato.com/save/">[Matplotlib] 画像の読み込み (plt.imread) と保存 (plt.savefig)</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cubic Function&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">9</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">)</span>

<span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;cubic.png&quot;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="numpy-array">
<h5>numpy arrayを保存<a class="headerlink" href="#numpy-array" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://www.delftstack.com/ja/howto/matplotlib/how-to-save-plots-as-an-image-file-without-displaying-in-matplotlib/">Matplotlib に表示せずにプロットを画像ファイルとして保存する方法 | Delft スタック</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="s1">&#39;new_1.png&#39;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span> <span class="c1"># imshowの代わりに保存</span>
</pre></div>
</div>
</section>
</section>
<section id="id166">
<h4>グリッド表示<a class="headerlink" href="#id166" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id167">
<h4>画像サイズ変更<a class="headerlink" href="#id167" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.solima.net/python/archives/179">matplotlibで出力される画像のサイズを変更する</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># figsizeが表示サイズ</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;bar_basic.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="id168">
<h3>統計学基礎<a class="headerlink" href="#id168" title="Permalink to this heading"></a></h3>
<section id="id169">
<h4>箱ひげ図の見方<a class="headerlink" href="#id169" title="Permalink to this heading"></a></h4>
<a class="reference internal image-reference" href="_images/c8856789ec11ab8b1013037cef6929f9-1.png"><img alt="_images/c8856789ec11ab8b1013037cef6929f9-1.png" src="_images/c8856789ec11ab8b1013037cef6929f9-1.png" style="width: 50%;" /></a>
<a class="reference internal image-reference" href="_images/2b530e80c7d0de90885e285c5d798063-2.png"><img alt="_images/2b530e80c7d0de90885e285c5d798063-2.png" src="_images/2b530e80c7d0de90885e285c5d798063-2.png" style="width: 50%;" /></a>
<a class="reference internal image-reference" href="_images/3a4f695a458cb0ac0aceaa2eb13ac2dd-2.png"><img alt="_images/3a4f695a458cb0ac0aceaa2eb13ac2dd-2.png" src="_images/3a4f695a458cb0ac0aceaa2eb13ac2dd-2.png" style="width: 50%;" /></a>
<a class="reference internal image-reference" href="_images/f96d9b4281f6d16b3c7589aed5a17be5.png"><img alt="_images/f96d9b4281f6d16b3c7589aed5a17be5.png" src="_images/f96d9b4281f6d16b3c7589aed5a17be5.png" style="width: 50%;" /></a>
<ul class="simple">
<li><p>データのばらつき具合が一目でわかる。範囲が狭いほどデータが集中している</p></li>
<li><p>箱の範囲にデータの半分が含まれる</p></li>
<li><p>ひげが長いほどデータはばらつきが大きい</p></li>
</ul>
</section>
</section>
<section id="id170">
<h3>Numpy<a class="headerlink" href="#id170" title="Permalink to this heading"></a></h3>
<section id="id171">
<h4>最大・最小・平均・標準偏差・中央値<a class="headerlink" href="#id171" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-maximum-minimum-fmax-fmin/">複数のNumPy配列ndarrayの要素ごとの最大値・最小値を取得 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-argmax-argmin/">NumPy配列ndarrayの最大値・最小値のインデックス（位置）を取得 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># [[0 1 2]</span>
<span class="c1">#  [3 4 5]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="c1"># 5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># [3 4 5]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># [2 5]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># [ 1 10 10]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="c1"># 1</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://deepage.net/features/numpy-std.html">要素の標準偏差を計算するNumPyのstd関数の使い方 - DeepAge</a></p></li>
<li><p><a class="reference external" href="https://www.headboost.jp/numpy-std/">NumPyで標準偏差を求めるstd()の使い方と注意点 | HEADBOOST</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://deepage.net/features/numpy-median.html">要素の中央値を計算するNumPyのmedian関数の使い方 - DeepAge</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id172">
<h4>バイナリデータで保存・読込<a class="headerlink" href="#id172" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-load-save-savez-npy-npz/">NumPy配列ndarrayをバイナリファイル（npy, npz）で保存 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># [0 1 2 3 4]</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;data/temp/np_save&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data/temp/np_save.npy&#39;</span><span class="p">))</span>

<span class="c1"># 複数まとめて保存</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s1">&#39;data/temp/np_savez&#39;</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="c1"># カンマ区切りでいくつでも追加可能</span>
<span class="n">npz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;data/temp/np_savez.npz&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">npz</span><span class="o">.</span><span class="n">files</span><span class="p">)</span> <span class="c1"># [&#39;arr_0&#39;, &#39;arr_1&#39;] # デフォルトではarr_&lt;index&gt;で読み込まれる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">npz</span><span class="p">[</span><span class="s1">&#39;arr_0&#39;</span><span class="p">])</span> <span class="c1"># [0 1 2 3 4]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">npz</span><span class="p">[</span><span class="s1">&#39;arr_1&#39;</span><span class="p">])</span> <span class="c1"># [5 6 7 8 9]</span>

<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s1">&#39;data/temp/np_savez_kw&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">a2</span><span class="p">)</span> <span class="c1"># キーワードは指定できる</span>
</pre></div>
</div>
</section>
<section id="id173">
<h4>printの表示方法設定<a class="headerlink" href="#id173" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-set-printoptions-float-formatter/">NumPy配列ndarrayの表示形式（桁数や指数表記、0埋めなど）を指定 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># 小数点以下の表示桁数</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 指数表記しない</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="np-nan-bool">
<h4>np.nan / boolの比較<a class="headerlink" href="#np-nan-bool" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/karintou/items/1c2434697e1658d1d4e0">【python】0,None,numpy.nanの比較 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://cyanatlas.hatenablog.com/entry/2020/07/03/033039">[Python][Numpy] 組み込みのboolとNumpy.bool_は別物 - 青色の地図帳</a></p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p>0</p></th>
<th class="head text-center"><p>None</p></th>
<th class="head text-center"><p>numpy.nan</p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>type()</p></td>
<td class="text-center"><p>class &lt;’int’&gt;</p></td>
<td class="text-center"><p>class &lt;’NoneType’&gt;</p></td>
<td><p>class &lt;’float’&gt;</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>bool()</p></td>
<td class="text-center"><p>False</p></td>
<td class="text-center"><p>False</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>他の数値との演算</p></td>
<td class="text-center"><p>0で割るとZeroDivisionError</p></td>
<td class="text-center"><p>TypeError</p></td>
<td><p>numpy.nan</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>is None</p></td>
<td class="text-center"><p>False</p></td>
<td class="text-center"><p>True</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>numpy.isnan()</p></td>
<td class="text-center"><p>False</p></td>
<td class="text-center"><p>False</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>自分との比較</p></td>
<td class="text-center"><p>True</p></td>
<td class="text-center"><p>True</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># -&gt; False</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># -&gt; TypeError(Noneが数値でないため)</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># -&gt; True</span>

<span class="c1"># 自分自身との比較</span>
<span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span>
<span class="c1"># -&gt; True</span>
<span class="kc">None</span> <span class="o">==</span> <span class="kc">None</span>
<span class="c1"># -&gt; True</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">nan</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
<span class="c1"># -&gt; False</span>

<span class="c1"># boolは isで比較すると期待通りに判定されない</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>  <span class="c1"># -&gt; True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># numpy.bool_</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id174">
<h4>スライス<a class="headerlink" href="#id174" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># array([[ 0,  1,  2,  3],</span>
<span class="c1">#        [ 4,  5,  6,  7],</span>
<span class="c1">#        [ 8,  9, 10, 11]])</span>

<span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="c1"># array([[ 0,  1,  2],</span>
<span class="c1">#        [ 4,  5,  6],</span>
<span class="c1">#        [ 8,  9, 10]])</span>

<span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># array([[1],</span>
<span class="c1">#        [5],</span>
<span class="c1">#        [9]])</span>
</pre></div>
</div>
</section>
<section id="id175">
<h4>型の確認・変更<a class="headerlink" href="#id175" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-dtype-astype/">NumPyのデータ型dtype一覧とastypeによる変換（キャスト） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="c1"># int64</span>

<span class="n">a_float</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id176">
<h4>各行毎にソートする<a class="headerlink" href="#id176" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-sort-argsort/">NumPyのsortとargsort関数で任意の行・列を基準にソート | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="n">a_2d_sort_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a_2d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 列に対して昇順ソート(縦にソート)</span>
<span class="n">a_2d_sort_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a_2d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 行に対して昇順ソート</span>

<span class="n">a_2d</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 自身を並べ替え</span>
</pre></div>
</div>
</section>
<section id="or-any">
<h4>行方向 or 列方向にany<a class="headerlink" href="#or-any" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-condition/">NumPy配列ndarrayから条件を満たす要素・行・列を抽出、削除 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># 列方向</span>
<span class="c1"># [ True  True False  True]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 行方向</span>
<span class="c1"># [ True  True False]</span>
</pre></div>
</div>
</section>
<section id="id177">
<h4>条件を満たすセルだけ処理<a class="headerlink" href="#id177" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-where/">NumPyで条件に応じた処理を行うwhereの使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a_org</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a_org</span><span class="p">)</span>
<span class="c1"># [[0 1 2]</span>
<span class="c1">#  [3 4 5]</span>
<span class="c1">#  [6 7 8]]</span>

<span class="n">a_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a_org</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">a_org</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a_new</span><span class="p">)</span>
<span class="c1"># [[-1 -1 -1]</span>
<span class="c1">#  [-1  4  5]</span>
<span class="c1">#  [ 6  7  8]]</span>

<span class="c1"># 複数条件</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">7</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="where">
<h4>条件を満たす要素のインデックスを取得 where<a class="headerlink" href="#where" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-where/">NumPyで条件に応じた処理を行うwhereの使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>

<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># (array([0, 1, 1]), array([0, 1, 3]))</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># (array([0, 1, 3]),)</span>

<span class="c1"># 複数条件 各条件式を()で囲む</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="mi">7</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>画像でアルファチャンネルを元にフィルタしたい場合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
<span class="p">])</span>

<span class="n">extrude_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 4番目の値でフィルタ</span>

<span class="nb">print</span><span class="p">(</span><span class="n">extrude_idx</span><span class="p">)</span>
<span class="c1">#(array([2, 3]),)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">extrude_idx</span><span class="p">])</span>
<span class="c1">#[[4 2 3 1]</span>
<span class="c1"># [6 2 3 1]]</span>
</pre></div>
</div>
</section>
<section id="id178">
<h4>列方向・行方向に総和<a class="headerlink" href="#id178" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-ndarray-sum-mean-axis/">NumPy配列の行・列ごとの合計、平均、最大、最小などを算出 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># [[ 0  1  2  3]</span>
<span class="c1">#  [ 4  5  6  7]</span>
<span class="c1">#  [ 8  9 10 11]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># 列方向</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 行方向</span>
<span class="c1"># [12 15 18 21]</span>
<span class="c1"># [ 6 22 38]</span>
</pre></div>
</div>
</section>
<section id="diff">
<h4>隣接する項目との差分(diff)<a class="headerlink" href="#diff" title="Permalink to this heading"></a></h4>
<p>a[i+1]-a[i]</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># 列方向</span>
<span class="c1">#[[4 2 0]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 行方向</span>
<span class="c1">#[[ 1  1]</span>
<span class="c1"># [-1 -1]]</span>
</pre></div>
</div>
</section>
<section id="id179">
<h4>移動平均<a class="headerlink" href="#id179" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://algorithm.joho.info/programming/python/numpy-convolve-moving-average/">【NumPy】移動平均の計算 | 西住工房</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/wrblue_mica34/items/51adf0059b61887075d9">numpyで移動平均 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/yamadasuzaku/items/fb744a207e7694d1598d">python の numpy で移動平均(running average)と移動標準偏差を簡単に計算したい - Qiita</a></p></li>
<li><p><a class="reference external" href="https://deepage.net/features/numpy-convolve.html">畳み込み積分や移動平均を求めるnumpy.convolve関数の使い方 - DeepAge</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_diff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># 移動平均の個数 大きいほどなめらかになる</span>
<span class="n">ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">data_diff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_diff</span><span class="p">))],</span> <span class="n">data_diff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ave</span><span class="p">))],</span> <span class="n">ave</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id180">
<h4>任意の値で初期化<a class="headerlink" href="#id180" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-zeros-ones-full/">NumPyで全要素を同じ値で初期化した配列ndarrayを生成 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">100</span><span class="p">))</span>
<span class="c1"># [[100 100 100]</span>
<span class="c1">#  [100 100 100]]</span>
</pre></div>
</div>
</section>
<section id="id181">
<h4>ベクトルの角度<a class="headerlink" href="#id181" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.mathpython.com/ja/numpy-vector-angle/">NumPyで二つのベクトルのなす角を求める（内積と絶対値の利用） - MathPython</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">/</span> <span class="n">norm</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="id182">
<h4>ベクトルの回転<a class="headerlink" href="#id182" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://python.atelierkobato.com/rotation-matrix/">回転行列 (rotation matrix)</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">r_axis</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="c1"># 度数単位の角度をラジアンに変換</span>
    <span class="k">if</span> <span class="n">deg</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
    <span class="n">r_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r_axis</span><span class="p">)</span>

    <span class="c1"># 回転行列</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)],</span>
                  <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)]])</span>

    <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">xy</span> <span class="o">-</span> <span class="n">r_axis</span><span class="p">)</span> <span class="o">+</span> <span class="n">r_axis</span>
</pre></div>
</div>
</section>
<section id="id183">
<h4>内積・外積<a class="headerlink" href="#id183" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-matrix/">Python, NumPyで行列の演算（逆行列、行列式、固有値など） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="n">p_dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">p_dot</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">@</span> <span class="n">p1</span>  <span class="c1"># dotと同じ</span>
</pre></div>
</div>
</section>
<section id="id184">
<h4>ベクトルの交点<a class="headerlink" href="#id184" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/kit2cuz/items/ef93aeb558f353ab479c">交点を求める - Qiita</a></p>
<ul>
<li><p>3次元空間上の線が交差しないケースも考慮されているため、交点が2つ出てくる</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">p_org</span><span class="p">):</span>
    <span class="n">p_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p_org</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_org</span> <span class="o">/</span> <span class="n">p_len</span>

<span class="c1"># 交点を取得するサブルーチン</span>
<span class="k">def</span> <span class="nf">is_cross_vector</span><span class="p">(</span><span class="n">pos_a</span><span class="p">,</span> <span class="n">pos_b</span><span class="p">,</span> <span class="n">pos_c</span><span class="p">,</span> <span class="n">pos_d</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pos_a</span><span class="o">==</span><span class="n">pos_b</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pos_c</span><span class="o">==</span><span class="n">pos_d</span><span class="p">):</span>  <span class="c1"># ベクトルが同一点</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">pos_b</span> <span class="o">-</span> <span class="n">pos_a</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">pos_d</span> <span class="o">-</span> <span class="n">pos_c</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">:</span> <span class="c1"># 2直線が平行な場合</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">AC</span> <span class="o">=</span> <span class="n">pos_c</span> <span class="o">-</span> <span class="n">pos_a</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">AC</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">AC</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">AC</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">AC</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">len_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_b</span> <span class="o">-</span> <span class="n">pos_a</span><span class="p">)</span>
    <span class="n">len_cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_d</span> <span class="o">-</span> <span class="n">pos_c</span><span class="p">)</span>

    <span class="c1"># print(f&quot;d1,d2: {d1/len_ab}, {d2/len_cd}&quot;)</span>

    <span class="n">within_ab</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">d1</span> <span class="o">&lt;=</span> <span class="n">len_ab</span><span class="p">)</span>
    <span class="n">within_cd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">d2</span> <span class="o">&lt;=</span> <span class="n">len_cd</span><span class="p">)</span>

    <span class="n">p_1</span> <span class="o">=</span> <span class="n">pos_a</span> <span class="o">+</span> <span class="n">d1</span><span class="o">*</span><span class="n">n1</span>
    <span class="c1"># p_2 = pos_c + d2*n2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">within_ab</span> <span class="ow">and</span> <span class="n">within_cd</span><span class="p">),</span> <span class="n">p_1</span>

<span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">])</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">is_cross_vector</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id185">
<h4>複数の点と一つの点で距離を計算する<a class="headerlink" href="#id185" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://blog.shikoan.com/distance-without-for-loop/">Pythonでxy座標上の2点間の距離をforループを使わずに計算する方法 | Shikoan’s ML Blog</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img_bool</span><span class="p">)</span> <span class="c1"># Trueのところのピクセル値取り出し</span>
<span class="n">candidate_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># [x,y]の形にする</span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">candidate_points</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">candidate_points_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diff</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># 二乗して和をとってルート計算</span>

<span class="n">min_idx</span> <span class="o">=</span> <span class="n">candidate_points_len</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="c1"># 最小値のインデックスを取得</span>
<span class="k">return</span> <span class="n">candidate_points</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id186">
<h4>テキスト形式で保存・読み込み<a class="headerlink" href="#id186" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-loadtxt-genfromtxt-savetxt/">NumPyでCSVファイルを読み込み・書き込み（入力・出力） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># デフォルトではスペース区切りなのでcsvの読み書きはデリミタ指定</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s2">&quot;hoge.txt&quot;</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;data/temp/np_savetxt.csv&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data/src/sample.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="and-or">
<h4>AND/OR<a class="headerlink" href="#and-or" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-logical-bitwise-and-or/">NumPy配列ndarrayの論理・ビット演算（AND, OR, XOR, NOT, シフト） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="n">b_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>

<span class="c1"># bool型の演算は記号の演算子を使う</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a_bool</span> <span class="o">&amp;</span> <span class="n">b_bool</span><span class="p">)</span> <span class="c1"># AND</span>
<span class="c1"># [ True False False False]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a_bool</span> <span class="o">|</span> <span class="n">b_bool</span><span class="p">)</span> <span class="c1"># OR</span>
<span class="c1"># [ True  True  True False]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a_bool</span> <span class="o">^</span> <span class="n">b_bool</span><span class="p">)</span> <span class="c1"># NOR</span>
<span class="c1"># [False  True  True False]</span>

<span class="nb">print</span><span class="p">(</span><span class="o">~</span><span class="n">a_bool</span><span class="p">)</span> <span class="c1"># NOT</span>
<span class="c1"># [False False  True  True]</span>
</pre></div>
</div>
</section>
<section id="id187">
<h4>等差数列: 任意の始点と終点を分割<a class="headerlink" href="#id187" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-arange-linspace/">NumPyのarange, linspaceの使い方（連番や等差数列を生成） | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1"># [ 0.  5. 10.]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1"># [ 0.   2.5  5.   7.5 10. ]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span> <span class="c1"># [ 0  2  5  7 10] # 型を指定できる</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1"># [10.   7.5  5.   2.5  0. ] # 減るパターン</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="c1"># [0. 2. 4. 6. 8.] # 終点含まない</span>
<span class="n">arr</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">retstep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 間隔を取得したい場合</span>
</pre></div>
</div>
</section>
<section id="id188">
<h4>insert<a class="headerlink" href="#id188" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-insert/">NumPy配列ndarrayに要素・行・列を挿入、追加するinsertの使い方 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c1"># [0 1 2 3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="c1"># [  0   1 100   2   3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]))</span> <span class="c1"># [  0 100 101 102   1   2   3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">]))</span> <span class="c1"># [100   0   1 101   2   3 102]</span>
</pre></div>
</div>
</section>
<section id="id189">
<h4>配列を分割<a class="headerlink" href="#id189" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.haya-programming.com/entry/2018/08/22/224341">【python】numpy配列を分割する方法まとめ - 静かなる名辞</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># [array([0, 1, 2, 3, 4]), array([5, 6, 7, 8, 9])]</span>

<span class="c1"># 等分割できないとき</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># [array([0, 1, 2, 3]), array([4, 5, 6]), array([7, 8, 9])]</span>
</pre></div>
</div>
</section>
<section id="id190">
<h4>パーセンタイル(四分位数)<a class="headerlink" href="#id190" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://numpy.org/doc/stable/reference/generated/numpy.percentile.html</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span> <span class="c1"># 25%と75%の値を返す</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;40 percentile = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">40</span><span class="p">)))</span>
<span class="c1"># source = [ 0  1  2  3  4  5  6  7  8  9 10]</span>
<span class="c1"># 40 percentile = 4.0</span>
</pre></div>
</div>
</section>
<section id="id191">
<h4>正規分布<a class="headerlink" href="#id191" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-numpy-random/">NumPy, randomで様々な種類の乱数の配列を生成 | note.nkmk.me</a></p></li>
<li><p><a class="reference external" href="https://www.monotalk.xyz/blog/Calculate-normal-distribution-with-python/">pythonで正規分布の計算をする | Monotalk</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># 平均0, シグマ1の分布の値をarrの形状で返す</span>
</pre></div>
</div>
</section>
</section>
<section id="id192">
<h3>JSON<a class="headerlink" href="#id192" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;&#39;で囲まないといけない</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="s1">&#39;{&quot;name&quot;:&quot;polygon&quot;,&quot;all_points_x&quot;:[818,762,828,948,887,910],&quot;all_points_y&quot;:[581,902,1130,1047,896,586]}&#39;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;all_points_x&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;all_points_y&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="notebooks">
<h3>Notebooks<a class="headerlink" href="#notebooks" title="Permalink to this heading"></a></h3>
<p>Jupyter notebookで作成する際のTips</p>
<section id="id193">
<h4>モジュールの自動リロード<a class="headerlink" href="#id193" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="id194">
<h4>画像の読み込み・表示・編集<a class="headerlink" href="#id194" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../data/images/hoge.JPG&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
<section id="id195">
<h5>点をプロット<a class="headerlink" href="#id195" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">hoge</span><span class="o">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;.r&quot;</span><span class="p">)</span> <span class="c1"># 左上原点としてx,y指定</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span> <span class="s2">&quot;.g&quot;</span><span class="p">)</span> <span class="c1"># 配列も可能、点はいくつでも追加できる</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id196">
<h5>矩形<a class="headerlink" href="#id196" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-matplotlib-patches-circle-rectangle/">Matplotlibで円や長方形などの図形を描画 | note.nkmk.me</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">hoge</span><span class="o">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="scikit-learn">
<h3>scikit-learn<a class="headerlink" href="#scikit-learn" title="Permalink to this heading"></a></h3>
<section id="id197">
<h4>パラメータを表示<a class="headerlink" href="#id197" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/54572468/python-sklearn-get-list-of-available-hyper-parameters-for-model">python sklearn get list of available hyper parameters for model - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://datascience.stackexchange.com/questions/77464/how-to-get-model-attributes-in-scikit-learn-not-hyper-parameters">machine learning - How to get model attributes in scikit learn (not hyper parameters) - Data Science Stack Exchange</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ハイパーパラメータ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
<span class="c1"># {&#39;memory&#39;: None,</span>
<span class="c1">#  &#39;steps&#39;: [(&#39;normalize&#39;, None), (&#39;poly&#39;, None), (&#39;ridge&#39;, Ridge(alpha=0.001))],</span>
<span class="c1">#  &#39;verbose&#39;: False,</span>
<span class="c1">#  &#39;normalize&#39;: None,</span>
<span class="c1">#  &#39;poly&#39;: None,</span>
<span class="c1">#  &#39;ridge&#39;: Ridge(alpha=0.004),</span>
<span class="c1">#  &#39;ridge__alpha&#39;: 0.001,</span>
<span class="c1">#  &#39;ridge__copy_X&#39;: True,</span>
<span class="c1">#  &#39;ridge__fit_intercept&#39;: True,</span>
<span class="c1">#  &#39;ridge__max_iter&#39;: None,</span>
<span class="c1">#  &#39;ridge__normalize&#39;: False,</span>
<span class="c1">#  &#39;ridge__random_state&#39;: None,</span>
<span class="c1">#  &#39;ridge__solver&#39;: &#39;auto&#39;,</span>
<span class="c1">#  &#39;ridge__tol&#39;: 0.004}</span>

<span class="c1"># モデルのパラメータ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;ridge&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
<span class="c1"># {&#39;alpha&#39;: 0.004,</span>
<span class="c1">#  &#39;fit_intercept&#39;: True,</span>
<span class="c1">#  &#39;normalize&#39;: False,</span>
<span class="c1">#  &#39;copy_X&#39;: True,</span>
<span class="c1">#  &#39;max_iter&#39;: None,</span>
<span class="c1">#  &#39;tol&#39;: 0.001,</span>
<span class="c1">#  &#39;solver&#39;: &#39;auto&#39;,</span>
<span class="c1">#  &#39;random_state&#39;: None,</span>
<span class="c1">#  &#39;n_features_in_&#39;: 3,</span>
<span class="c1">#  &#39;coef_&#39;: array([-22.18890951,  50.75441662,  0.54120677]),</span>
<span class="c1">#  &#39;n_iter_&#39;: None,</span>
<span class="c1">#  &#39;intercept_&#39;: 7.17479357434621}</span>

<span class="c1"># 推論時</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]))</span> <span class="c1"># a*1 + b*1 + c*1 + d</span>
</pre></div>
</div>
</section>
</section>
<section id="jupyterlab">
<h3>Jupyterlab<a class="headerlink" href="#jupyterlab" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://jupyter.org/">Project Jupyter | Home</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/kirikei/items/a1639954ce5ccaf7ac3c">JupyterLabのすゝめ - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/canonrock16/items/d166c93087a4aafd2db4">JupyterLabのおすすめ拡張機能9選 - Qiita</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>jupyterlab
</pre></div>
</div>
<p>実行</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>jupyter-lab<span class="w"> </span><span class="c1"># ローカル http://localhost:8888/lab</span>
$<span class="w"> </span>jupyter-lab<span class="w"> </span>--ip<span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span>--no-browser<span class="w"> </span><span class="c1"># サーバ http://&lt;サーバのIPアドレス&gt;:8888/lab</span>

<span class="c1"># サーバーは繋がらないときはトンネルしてつなぐ</span>
$<span class="w"> </span>ssh<span class="w"> </span>user_hoge@192.168.2.210<span class="w"> </span>-L<span class="w"> </span><span class="m">8899</span>:localhost:8888
$<span class="w"> </span>jupyter-lab<span class="w"> </span>--ip<span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span>--no-browser<span class="w"> </span><span class="c1"># http://localhost:8899/lab</span>
</pre></div>
</div>
<p>基本的な使い方はnotebookと同じ。vscodeの要素を足した感じ</p>
<section id="id198">
<h4>目次表示する拡張機能<a class="headerlink" href="#id198" title="Permalink to this heading"></a></h4>
<p>https://github.com/jupyterlab/jupyterlab-toc</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>jupyter<span class="w"> </span>labextension<span class="w"> </span>install<span class="w"> </span>@jupyterlab/toc
</pre></div>
</div>
</section>
<section id="id199">
<h4>変数を常にprintする拡張機能<a class="headerlink" href="#id199" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://github.com/lckr/jupyterlab-variableInspector</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>lckr-jupyterlab-variableinspector
<span class="c1"># or</span>
jupyter<span class="w"> </span>labextension<span class="w"> </span>install<span class="w"> </span>@lckr/jupyterlab_variableinspector
</pre></div>
</div>
</section>
<section id="id200">
<h4>ショートカット<a class="headerlink" href="#id200" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/zawawahoge/items/baa2a5318df079c5f7e5">【完全版】Jupyter Notebook ショートカット - Qiita</a></p></li>
</ul>
<p>一覧は左側メニューの虫メガネアイコン内にある</p>
<p>すべての機能がこの中から実行できるっぽい</p>
<section id="id201">
<h5>タブ移動<a class="headerlink" href="#id201" title="Permalink to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+[</span> <span class="pre">or</span> <span class="pre">]</span></code></p>
</section>
<section id="id202">
<h5>タブを閉じる<a class="headerlink" href="#id202" title="Permalink to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Alt+W</span></code></p>
</section>
<section id="id203">
<h5>タブを閉じて、カーネルも終了<a class="headerlink" href="#id203" title="Permalink to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+Q</span></code></p>
</section>
<section id="id204">
<h5>セルのモードを変える<a class="headerlink" href="#id204" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p>M : Markdown</p></li>
<li><p>Y : Code</p></li>
<li><p>R : Raw text (Markdownじゃないただのテキストモード)</p></li>
</ul>
</section>
<section id="id205">
<h5>別のブラウザページから戻ってきたときにセルをアクティベート<a class="headerlink" href="#id205" title="Permalink to this heading"></a></h5>
<p>セルを編集中に他のブラウザに移動して戻るとセルの編集が終わっているので、キーを入れても入力が再開できない</p>
<p>ずばり該当するコマンドがなさそう？</p>
<p>タブ切り替え系は使えるので、<code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+,</span> <span class="pre">or</span> <span class="pre">.</span></code>で対応</p>
</section>
<section id="id206">
<h5>セルを分割<a class="headerlink" href="#id206" title="Permalink to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Ctrl+Shift+-</span></code></p>
</section>
<section id="id207">
<h5>セルを結合<a class="headerlink" href="#id207" title="Permalink to this heading"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Shift+M</span></code></p>
</section>
</section>
<section id="id208">
<h4>オススメ設定<a class="headerlink" href="#id208" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Ctrl+,</span></code>で拡張設定のウィンドウを表示する</p>
<section id="notebook">
<h5>Notebook<a class="headerlink" href="#notebook" title="Permalink to this heading"></a></h5>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;codeCellConfig&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;lineNumbers&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;autoClosingBrackets&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rulers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">],</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;observedBottomMargin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0px&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// デフォルトだと1000だけど、セル内に余分な余白がついて邪魔</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id209">
<h5>コマンドパレットを左側に常に表示させる<a class="headerlink" href="#id209" title="Permalink to this heading"></a></h5>
<p>コマンドパレットの項目に以下を追加</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;modal&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id210">
<h5>ショートカット設定の変更<a class="headerlink" href="#id210" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p>Chromeとかブラウザで設定されているショートカット(Ctrl+Shift+Iとか)だと実行できないっぽい</p></li>
<li><p>既存の設定でショートカットが割り当てられていても、ユーザー設定の方で上書きされる</p></li>
<li><p>設定ファイルを保存した時点でショートカット機能は有効になっている</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;shortcuts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application:activate-next-tab&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;Ctrl Shift 9&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;body&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="c1">// セルにフォーカス合わせるためのショートカットとして使用</span>
<span class="w">            </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application:activate-next-tab-bar&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;I&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;selector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;body&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="gcp">
<h3>GCP<a class="headerlink" href="#gcp" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://pypi.org/project/google-cloud/</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>google-cloud
</pre></div>
</div>
</section>
<section id="id211">
<h3>GCS<a class="headerlink" href="#id211" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/Hyperion13fleet/items/594c15ac24f149ab73c9">[GoogleCloudStorage] GCSのPythonAPIの使い方 [備忘] - Qiita</a></p></li>
<li><p><a class="reference external" href="https://dev.classmethod.jp/articles/gcs-python-client-libraries-how2/">Python クライアントライブラリで Google Cloud Storage の参照・作成・更新・削除操作をするにはどのメソッドを使えばよいのか確認してみた | DevelopersIO</a></p></li>
</ul>
<section id="id212">
<h4>アカウント認証<a class="headerlink" href="#id212" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://cloud.google.com/docs/authentication/production?hl=ja</p>
<ul>
<li><p>環境変数<code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code>にjsonファイルを設定すると自動的に認証される</p></li>
</ul>
</li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GOOGLE_APPLICATION_CREDENTIALS</span><span class="o">=</span>secrets/dev/gcp-credentials.json
</pre></div>
</div>
</section>
<section id="id213">
<h4>データ読み込み/書き込み<a class="headerlink" href="#id213" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">storage</span> <span class="k">as</span> <span class="n">gcs</span>

<span class="c1"># 認証情報を環境変数で設定</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;GOOGLE_APPLICATION_CREDENTIALS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gcp-credentials.json&#39;</span>

<span class="n">project_id</span> <span class="o">=</span> <span class="s2">&quot;gcp-proj-name&quot;</span>
<span class="n">bucket_name</span> <span class="o">=</span> <span class="s2">&quot;gcp-bucket-name&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
<span class="n">gcs_path</span> <span class="o">=</span> <span class="s1">&#39;hoge.png&#39;</span>

<span class="c1"># ダウンロード</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">download_as_bytes</span><span class="p">())</span> <span class="c1"># バイトデータで読み込む場合</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># 画像やDataframeにbufを渡すと読み込める</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">download_as_string</span><span class="p">()))</span> <span class="c1"># バイトデータ文字列からバイト型のファイルオブジェクト作って読み込み</span>
<span class="n">blob</span><span class="o">.</span><span class="n">download_to_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span> <span class="c1"># ファイルとして保存</span>

<span class="c1"># アップロード</span>
<span class="n">blob</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span>
<span class="n">blob</span><span class="o">.</span><span class="n">upload_from_filename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span> <span class="c1"># ファイルをアップロード</span>
<span class="n">blob</span><span class="o">.</span><span class="n">upload_from_string</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span> <span class="c1"># DataFrameを直接アップロードする場合</span>
</pre></div>
</div>
</section>
<section id="id214">
<h4>ファイルの存在確認<a class="headerlink" href="#id214" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gcs_path</span> <span class="o">=</span> <span class="s1">&#39;hoge.png&#39;</span>
<span class="n">bucket</span><span class="o">.</span><span class="n">blob</span><span class="p">(</span><span class="n">gcs_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id215">
<h4>バケットの任意のディレクトリのファイル一覧取得<a class="headerlink" href="#id215" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/22398898/google-cloud-storage-python-any-way-to-list-obj-in-certain-folder-in-gcs">Google Cloud Storage + Python : Any way to list obj in certain folder in GCS? - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://googleapis.dev/python/storage/latest/buckets.html#google.cloud.storage.bucket.Bucket.list_blobs">Buckets — google-cloud-storage documentation</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/56176328/listing-objects-in-gcs-also-lists-the-directory">python 3.x - Listing objects in GCS also lists the directory - Stack Overflow</a></p></li>
</ul>
<p>ディレクトリで絞る専用のオプションはない。prefixオプションでディレクトリ名を指定する。</p>
<p>これだけだとディレクトリ自体も含まれるので、if文で末尾に/があるか判定する</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">storage</span> <span class="k">as</span> <span class="n">gcs</span>

<span class="n">project_id</span> <span class="o">=</span> <span class="s2">&quot;gcp-proj-name&quot;</span>
<span class="n">bucket_name</span> <span class="o">=</span> <span class="s2">&quot;gcp-bucket-name&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">gcs</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>

<span class="n">blob_list</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">list_blobs</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;data/&quot;</span><span class="p">)</span> <span class="c1"># dataディレクトリ自身を含むパス一覧を返す</span>

<span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="n">blob_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">blob</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span> <span class="c1"># ディレクトリは除外</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pathlib">
<h4>pathlibとの互換ライブラリ<a class="headerlink" href="#pathlib" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://towardsdatascience.com/transparentpath-a-python-package-to-manage-paths-on-google-cloud-storage-ae25a15a44d5">TransparentPath: A Python package to manage paths on Google Cloud Storage | by Philippe Cotte | Towards Data Science</a></p></li>
<li><p>https://github.com/Advestis/transparentpath</p></li>
</ul>
</section>
<section id="gcsfs">
<h4>GCSFS<a class="headerlink" href="#gcsfs" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>https://gcsfs.readthedocs.io/en/latest/</p></li>
</ul>
<p>GCSに簡単にアクセスできるモジュール</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>gcsfs
</pre></div>
</div>
<p>このモジュールの認証方法の優先順位は以下を参照</p>
<ul class="simple">
<li><p>https://github.com/googleapis/google-auth-library-python/blob/46fa9c4fa4783ef584b132e0628dc6031a7e48b5/google/auth/_default.py#L222</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. If the environment variable ``GOOGLE_APPLICATION_CREDENTIALS`` is set
    to the path of a valid service account JSON private key file, then it is
    loaded and returned. The project ID returned is the project ID defined
    in the service account file if available (some older files do not
    contain project ID information).
2. If the `Google Cloud SDK`_ is installed and has application default
    credentials set they are loaded and returned.
    To enable application default credentials with the Cloud SDK run::
        gcloud auth application-default login
    If the Cloud SDK has an active project, the project ID is returned. The
    active project can be set using::
        gcloud config set project
3. If the application is running in the `App Engine standard environment`_
    then the credentials and project ID from the `App Identity Service`_
    are used.
4. If the application is running in `Compute Engine`_ or the
    `App Engine flexible environment`_ then the credentials and project ID
    are obtained from the `Metadata Service`_.
</pre></div>
</div>
<section id="usage">
<h5>usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h5>
<p>最初にデフォルトのプロジェクトを設定しておく</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># WSLで</span>
gcloud<span class="w"> </span>auth<span class="w"> </span>application-default<span class="w"> </span>login

<span class="c1"># 管理者権限で開いたコマンドプロンプト</span>
gcloud<span class="w"> </span>components<span class="w"> </span>update
gcloud<span class="w"> </span>auth<span class="w"> </span>login
<span class="c1"># WSLで出てきた文字列をコピペ</span>
<span class="c1"># ブラウザで認証</span>
<span class="c1"># コマンドプロンプトで表示されたhttps~~の文字列を貼り付けて実行</span>

<span class="c1"># 認証できてるか確認</span>
gcloud<span class="w"> </span>projects<span class="w"> </span>list
gcloud<span class="w"> </span>auth<span class="w"> </span>list

gcloud<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>project<span class="w"> </span>gcp-proj-name

<span class="c1"># 認証後にjupyter-labのカーネルを起動する</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gcsfs</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">get_item_name</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">stem_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*?_.*?_(.*)&quot;</span><span class="p">,</span> <span class="n">stem_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_item_name error: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: エラーログに出力 or 処理を中断</span>
        <span class="k">assert</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;gcp-proj-name&#39;</span><span class="p">)</span>

<span class="c1"># 指定ディレクトリでlsコマンド (ディレクトリは末尾が/になるので区別できる)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s1">&#39;gcp-proj-name/hoge&#39;</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s1">&#39;gs://gcp-proj-name/hoge&#39;</span><span class="p">)</span>  <span class="c1"># gs://は付けても問題ないらしい</span>
<span class="c1"># detail=Trueを付けると辞書型のリストで返す(ファイルプロパティの情報も込みで返す)</span>

<span class="c1"># gsutilの場合</span>
<span class="c1"># gsutil ls -l gs://gcp-proj-name/hoge</span>

<span class="c1"># 任意のファイルを検索できる</span>
<span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;gs://gcp-proj-name/*.txt&#39;</span><span class="p">)</span>

<span class="c1"># pandasで読み書き</span>
<span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;gcp-proj-name/hoge.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;gcp-proj-name/test.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf_8_sig&quot;</span><span class="p">)</span>

<span class="c1"># ファイル一覧を取得する (lsコマンド的な)</span>
<span class="n">preprocessed_cache_glob_path</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;gs://bucket_name/hoge/*.png&quot;</span>
<span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">gcp_project_id</span><span class="p">)</span>
<span class="n">cache_item_path_list</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">preprocessed_cache_glob_path</span><span class="p">)</span>
<span class="n">cache_item_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item_name</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cache_item_path_list</span><span class="p">]</span>
<span class="n">stored_item_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cache_item_list</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="http">
<h3>httpリクエスト<a class="headerlink" href="#http" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://docs.python-requests.org/en/v1.2.3/user/quickstart/</p></li>
<li><p><a class="reference external" href="https://www.soudegesu.com/post/python/http-request-with-requests/">Python3でHTTP通信をする（Requestsを使う） - そうなんでげす</a></p>
<ul>
<li><p>Pythonを使った外部通信するためのライブラリ</p></li>
<li><p>Python標準のurllibモジュールよりも高機能であり、コード量も減り、APIも可読性が良いため、外部通信を伴うアプリケーションでは一般に広く使われています</p></li>
</ul>
</li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>requests
</pre></div>
</div>
</section>
<section id="web">
<h3>webフレームワーク<a class="headerlink" href="#web" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>FastAPI</p></li>
<li><p>Bottle</p></li>
<li><p>Flask</p></li>
<li><p>Django</p></li>
<li><p>Pyramid</p></li>
</ul>
</section>
<section id="uvicorn">
<h3>uvicorn<a class="headerlink" href="#uvicorn" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://www.uvicorn.org/</p></li>
</ul>
<p>Pythonで使えるASGI web server (Asynchronous Server Gateway Interface)</p>
<section id="install">
<h4>install<a class="headerlink" href="#install" title="Permalink to this heading"></a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>uvicorn
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>uvicorn<span class="o">[</span>standard<span class="o">]</span><span class="w"> </span><span class="c1"># 最小構成でinstallする場合</span>
</pre></div>
</div>
</section>
<section id="id216">
<h4>usage<a class="headerlink" href="#id216" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">receive</span><span class="p">,</span> <span class="n">send</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">scope</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;http&#39;</span>

    <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;http.response.start&#39;</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;content-type&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;text/plain&#39;</span><span class="p">],</span>
        <span class="p">],</span>
    <span class="p">})</span>
    <span class="k">await</span> <span class="n">send</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;http.response.body&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">,</span>
    <span class="p">})</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>uvicorn<span class="w"> </span>example:app
</pre></div>
</div>
</section>
</section>
<section id="fastapi">
<h3>fastAPI<a class="headerlink" href="#fastapi" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://fastapi.tiangolo.com/ja/</p></li>
<li><p><a class="reference external" href="https://zenn.dev/sawao/articles/15a9cf0e3360a7">【完全版】React + FastAPIで開発するモダンなwebアプリ</a></p>
<ul>
<li><p>未読</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://developers-book.com/2020/07/20/140/">HTTPメソッド4種類(GET,POST,PUT,DELETE)について概要と違いを理解する | エンジニアの参考書</a></p>
<ul>
<li><p>GETは取得、POSTは送信。PUT/DELETEはあまり使われてない</p></li>
</ul>
</li>
</ul>
<section id="id217">
<h4>install<a class="headerlink" href="#id217" title="Permalink to this heading"></a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>fastapi<span class="w"> </span>uvicorn
</pre></div>
</div>
</section>
<section id="id218">
<h4>basic usage<a class="headerlink" href="#id218" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">price</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">is_offer</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="c1"># /のパスでGETリクエストを受付</span>
<span class="k">def</span> <span class="nf">read_root</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Hello&quot;</span><span class="p">:</span> <span class="s2">&quot;World&quot;</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/</span><span class="si">{item_id}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># このパスでGETリクエストを受付</span>
<span class="k">def</span> <span class="nf">read_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="c1"># パスはint型を強制，オプションでstr型のクエリパラメータを持つ</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="n">q</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/items/</span><span class="si">{item_id}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># POSTリクエスト</span>
<span class="k">def</span> <span class="nf">update_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Item</span><span class="p">):</span> <span class="c1"># pydanticを使うと深いネストのJSONデータの受け入れも簡単にできる</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;item_name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;/items/</span><span class="si">{item_id}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># PUTリクエスト</span>
<span class="k">def</span> <span class="nf">update_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Item</span><span class="p">):</span> <span class="c1"># pydanticを使うと深いネストのJSONデータの受け入れも簡単にできる</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;item_name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">}</span>

<span class="c1"># __main__から起動させたい場合</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:app&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># 起動</span>
$<span class="w"> </span>uvicorn<span class="w"> </span>main:app<span class="w"> </span>--reload<span class="w"> </span><span class="c1"># モジュール名:FastAPIオブジェクト名</span>
<span class="c1"># 下のディレクトリにアクセスするときは hoge.foo.sub:app のように指定</span>
</pre></div>
</div>
<p>http://127.0.0.1:8000/items/5?q=somequery にアクセスすると，<code class="docutils literal notranslate"><span class="pre">{&quot;item_id&quot;:</span> <span class="pre">5,</span> <span class="pre">&quot;q&quot;:</span> <span class="pre">&quot;somequery&quot;}</span></code>が帰ってくる．</p>
<p>http://127.0.0.1:8000/docs にアクセスすると自動対話型のAPIドキュメントが開く．</p>
</section>
<section id="id219">
<h4>Tips<a class="headerlink" href="#id219" title="Permalink to this heading"></a></h4>
<section id="id220">
<h5>引数<a class="headerlink" href="#id220" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p>https://fastapi.tiangolo.com/ja/tutorial/query-params/</p></li>
</ul>
<p>パスパラメータではない関数パラメータを宣言すると、それらは自動的に “クエリ” パラメータとして解釈されます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">fake_items_db</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;item_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Foo&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;item_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bar&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;item_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Baz&quot;</span><span class="p">}]</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">read_item</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">fake_items_db</span><span class="p">[</span><span class="n">skip</span> <span class="p">:</span> <span class="n">skip</span> <span class="o">+</span> <span class="n">limit</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>http://127.0.0.1:8000/items/
<span class="c1"># これは以下と同等になる</span>
http://127.0.0.1:8000/items/?skip<span class="o">=</span><span class="m">0</span><span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span><span class="m">10</span>
</pre></div>
</div>
</section>
<section id="id221">
<h5>ファイルを指定<a class="headerlink" href="#id221" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://senablog.com/python-fastapi-file-upload/">【Python3】FastAPIでファイルのアップロードを行う方法 | せなブログ</a></p>
<ul>
<li><p>後で読む</p></li>
</ul>
</li>
</ul>
<p>FastAPIを起動した後に/docsで管理画面を開いてTry it outをするのが楽。
curlコマンドで送る方法は不明。</p>
</section>
<section id="id222">
<h5>pydanticの指定オプション<a class="headerlink" href="#id222" title="Permalink to this heading"></a></h5>
<p><a class="reference internal" href="#field">Field</a>を参照</p>
</section>
<section id="id223">
<h5>起動・終了時のイベント定義<a class="headerlink" href="#id223" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/advanced/events/">Events: startup - shutdown - FastAPI</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">items</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;startup&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">startup_event</span><span class="p">():</span> <span class="c1"># asyncは無くてもOK</span>
    <span class="n">items</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Fighters&quot;</span><span class="p">}</span>
    <span class="n">items</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Tenders&quot;</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;shutdown&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">shutdown_event</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;log.txt&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Application shutdown&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/</span><span class="si">{item_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="cors">
<h5>CORSエラー対応<a class="headerlink" href="#cors" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/satto_sann/items/0e1f5dbbe62efc612a78">FastAPIでCORSを回避 - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">starlette.middleware.cors</span> <span class="kn">import</span> <span class="n">CORSMiddleware</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># CORSを回避するために追加</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_users</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;taro&quot;</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="async">
<h5>async<a class="headerlink" href="#async" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://qiita.com/ffggss/items/e4c06f86fb28a62948e0">FastAPIの”def”と”async def”って結局「どっちを使えば良いんじゃろう？」 - Qiita</a></p>
<ul>
<li><p>基本的にasyncは使わなくてよい</p></li>
</ul>
</li>
</ul>
</section>
<section id="id224">
<h5>グローバル変数の共有(ワーカー数設定)<a class="headerlink" href="#id224" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/63949240/python-global-variable-in-fastapi-not-working-as-normal">python global variable in fastApi not working as normal - Stack Overflow</a></p></li>
</ul>
<p>デフォルトではCPUの数に応じて複数のworkerが生成される。グローバル変数を使用している場合、これらは個別にコピーされ、それぞれが独立して値を所持している。
そのため、複数のリクエストでグローバル変数を共有することができない。</p>
<p>どうしても共有したい場合はworkerをひとつに設定するか、別にDBなどを用意する。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:app&quot;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uvicorn<span class="w"> </span>main:app<span class="w"> </span>--reload<span class="w"> </span>--workers<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</section>
<section id="id225">
<h5>応答を返した後も処理をする<a class="headerlink" href="#id225" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://fastapi.tiangolo.com/tutorial/background-tasks/">Background Tasks - FastAPI</a></p></li>
</ul>
<p>時間のかかる処理があるけど、レスポンスはすぐに返したいときに使える。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">BackgroundTasks</span><span class="p">,</span> <span class="n">FastAPI</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">write_notification</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;log.txt&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">email_file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;notification for </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">email_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/send-notification/</span><span class="si">{email}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_notification</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span><span class="p">):</span>
    <span class="c1"># background_tasksにはFastAPIが自動的にオブジェクトを用意してくれる</span>
    <span class="n">background_tasks</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">write_notification</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;some notification&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Notification sent in the background&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="typer">
<h3>Typer<a class="headerlink" href="#typer" title="Permalink to this heading"></a></h3>
<p>FastAPI用のCLIツールを意図して作成されたもの。
タイプヒントを使って必要なオプションを自動的に解析してくれる。</p>
<p><code class="docutils literal notranslate"><span class="pre">command</span></code>デコレータによって、特定の関数を起点として指定できる。</p>
<ul class="simple">
<li><p>https://typer.tiangolo.com/</p></li>
<li><p><a class="reference external" href="https://qiita.com/iisaka51/items/18bde4dada0827fbe81e">オプション解析モジュール typer を使いこなそう - Qiita</a></p></li>
<li><p><a class="reference external" href="https://zenn.dev/tos_kamiya/articles/5920f43ddb2e92">PythonのコマンドラインパーサーTyper浅煎り</a></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;typer[all]&quot;</span>
</pre></div>
</div>
<section id="id226">
<h4>basic usage<a class="headerlink" href="#id226" title="Permalink to this heading"></a></h4>
<p>実行したい関数をtyper.runで呼び出すだけ</p>
<p>関数の型指定から自動でオプション解析してくれる</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typer</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>Camila
<span class="c1"># Hello Camila</span>
</pre></div>
</div>
</section>
<section id="id227">
<h4>Tips<a class="headerlink" href="#id227" title="Permalink to this heading"></a></h4>
<section id="command">
<h5>command<a class="headerlink" href="#command" title="Permalink to this heading"></a></h5>
<p>サブコマンドを持たせたいときはアプリケーションインスタンスを作成する</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typer</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Typer</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">good_bye</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">formal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">formal</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Goodbye Ms. </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Have a good day.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bye </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">コマンド</span> <span class="pre">オプション</span></code>の形で指定できる。
フラグの場合は<code class="docutils literal notranslate"><span class="pre">--formal</span></code>のように単独で指定し、値がある場合は<code class="docutils literal notranslate"><span class="pre">--hoge</span> <span class="pre">100</span></code>のように指定。</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>main.py<span class="w"> </span>hello<span class="w"> </span>Camila
<span class="c1"># Hello Camila</span>

python<span class="w"> </span>main.py<span class="w"> </span>good-bye<span class="w"> </span>Camila<span class="w"> </span><span class="c1"># _の関数名は-にして指定する</span>
<span class="c1"># Bye Camila!</span>

python<span class="w"> </span>main.py<span class="w"> </span>good-bye<span class="w"> </span>--formal<span class="w"> </span>Camila
<span class="c1"># Goodbye Ms. Camila. Have a good day.</span>
</pre></div>
</div>
</section>
<section id="option">
<h5>Option<a class="headerlink" href="#option" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typer</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="s1">&#39;--count&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Number of greetings.&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;Your Name: &#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The person to greet.&#39;</span><span class="p">),</span>
    <span class="c1"># 1個目はデフォルト値, Elipsisで入力必須</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="flag">
<h5>Flag入力<a class="headerlink" href="#flag" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">typer</span>

<span class="k">def</span> <span class="nf">cmd</span><span class="p">(</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;DEBUG mode&#39;</span><span class="p">),</span>
    <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;--force&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Force option&#39;</span><span class="p">)</span>
    <span class="c1"># bool型を指定するとフラグ扱い</span>
    <span class="c1"># 明示的にオプションを与えない場合, --no-debugのように--no-の指定もできる</span>
<span class="p">):</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;debug: </span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;force: </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="template">
<h5>template<a class="headerlink" href="#template" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">typer</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Typer</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;いろいろな方法で数を表示します。&quot;</span><span class="p">)</span>  <span class="c1"># ← ヘルプメッセージの1行目、アプリケーションの説明</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">count_up</span><span class="p">(</span>  <span class="c1"># ← アンダースコアはコマンドラインではハイフンになる。このコマンド名はcount-upとなる</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="c1"># ヘルプメッセージ内で説明なし、必須の引数</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;終了値&quot;</span><span class="p">),</span>  <span class="c1"># 説明あり、必須の引数</span>
    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ステップ&quot;</span><span class="p">)</span>  <span class="c1"># 説明あり、略可能な引数を（typer.Argumentの最初の引数にデフォルト値を渡す）</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;開始値から終了値までカウントアップします。&quot;&quot;&quot;</span>  <span class="c1"># ← コマンドの説明はDocstringで書く</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">)))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">format</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">format_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;--format-string&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;フォーマット文字列&quot;</span><span class="p">),</span>  <span class="c1"># ← 1文字のオプションを定義する例</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;与えられた数値をフォーマット文字列によりフォーマットします。&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">format_string</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">count_args</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Argument</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>  <span class="c1"># ← 複数個の値を並べられる引数の例</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">([],</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;これと等しい引数は数えません（除外します）。&quot;</span><span class="p">),</span>  <span class="c1"># ← 複数回指定できるオプションの例</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;引数の個数を数えます。&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">]))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="api">
<h3>APIを叩く<a class="headerlink" href="#api" title="Permalink to this heading"></a></h3>
<section id="requests">
<h4>Requestsモジュール<a class="headerlink" href="#requests" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://note.nkmk.me/python-requests-usage/">Python, Requestsの使い方 | note.nkmk.me</a></p></li>
</ul>
<section id="id228">
<h5>概要<a class="headerlink" href="#id228" title="Permalink to this heading"></a></h5>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>requests
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://example.com/&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="c1"># &lt;Response [200]&gt;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="c1"># https://example.com/</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="c1"># 200</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
<span class="c1"># {&#39;Content-Encoding&#39;: &#39;gzip&#39;, &#39;Accept-Ranges&#39;: &#39;bytes&#39;, &#39;Cache-Control&#39;: &#39;max-age=604800&#39;, &#39;Content-Type&#39;: &#39;text/html&#39;, &#39;Date&#39;: &#39;Thu, 12 Jul 2018 11:58:54 GMT&#39;, &#39;Etag&#39;: &#39;&quot;1541025663&quot;&#39;, &#39;Expires&#39;: &#39;Thu, 19 Jul 2018 11:58:54 GMT&#39;, &#39;Last-Modified&#39;: &#39;Fri, 09 Aug 2013 23:54:35 GMT&#39;, &#39;Server&#39;: &#39;ECS (oxr/8313)&#39;, &#39;Vary&#39;: &#39;Accept-Encoding&#39;, &#39;X-Cache&#39;: &#39;HIT&#39;, &#39;Content-Length&#39;: &#39;606&#39;}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="c1"># ISO-8859-1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="c1"># レスポンスが文字列の場合の中身 Webページの中身とか</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="c1"># デコードされてないバイナリデータ。画像とかzipデータのときに使用</span>
</pre></div>
</div>
</section>
<section id="id229">
<h5>クエリ(URL)パラメータ<a class="headerlink" href="#id229" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.google.co.jp/search&#39;</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="s1">&#39;日本代表&#39;</span><span class="p">,</span> <span class="s1">&#39;tbm&#39;</span><span class="p">:</span> <span class="s1">&#39;nws&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="c1"># https://www.google.co.jp/search?q=%E6%97%A5%E6%9C%AC%E4%BB%A3%E8%A1%A8&amp;tbm=nws</span>
</pre></div>
</div>
</section>
<section id="id230">
<h5>リクエストヘッダ<a class="headerlink" href="#id230" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.yahoo.co.jp/&#39;</span>
<span class="n">ua</span> <span class="o">=</span> <span class="s1">&#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#39;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">ua</span><span class="p">}</span>
<span class="n">r_ua</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id231">
<h5>JSONデータへ変換<a class="headerlink" href="#id231" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://weather.livedoor.com/forecast/webservice/json/v1&#39;</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="mi">130010</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">])</span> <span class="c1"># application/json; charset=utf-8</span>

<span class="n">json_data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/temp/download.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id232">
<h5>画像・zipなどをダウンロード<a class="headerlink" href="#id232" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 画像</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">url_image</span> <span class="o">=</span> <span class="s1">&#39;https://www.python.org/static/community_logos/python-logo.png&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_image</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">])</span> <span class="c1"># image/png</span>

<span class="n">filename_image</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url_image</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename_image</span><span class="p">)</span> <span class="c1"># python-logo.png</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/temp/&#39;</span> <span class="o">+</span> <span class="n">filename_image</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># zip</span>
<span class="n">url_zip</span> <span class="o">=</span> <span class="s1">&#39;http://www.post.japanpost.jp/zipcode/dl/oogaki/zip/13tokyo.zip&#39;</span>

<span class="n">r_zip</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_zip</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r_zip</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">])</span> <span class="c1"># application/zip</span>

<span class="n">filename_zip</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url_zip</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename_zip</span><span class="p">)</span> <span class="c1"># 13tokyo.zip</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/temp/&#39;</span> <span class="o">+</span> <span class="n">filename_zip</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_zip</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id233">
<h5>fileのアップロード<a class="headerlink" href="#id233" title="Permalink to this heading"></a></h5>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/22567306/how-to-upload-file-with-python-requests">How to upload file with python requests? - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/5zm/items/92cde9e043813e02eb68">Pythonのrequestsを利用してmultipart/form-dataのFormにファイルアップロードする方法 - Qiita</a></p></li>
<li><p><a class="reference external" href="https://qiita.com/NatsuToku/items/e37c44f804950bf178d6">Pythonのrequestsを利用してmultipart/form-data形式のデータを送信するときにContent-Typeを「multipart/form-data」としたheadersを渡してはいけない - Qiita</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upload_file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)}</span>
<span class="c1"># files = {&#39;upload_file&#39;: (&#39;foobar.txt&#39;, open(&#39;file.txt&#39;,&#39;rb&#39;), &#39;text/x-spam&#39;)} # タプルでファイル名なども指定できる</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DB&#39;</span><span class="p">:</span> <span class="s1">&#39;photcat&#39;</span><span class="p">,</span> <span class="s1">&#39;OUT&#39;</span><span class="p">:</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;SHORT&#39;</span><span class="p">:</span> <span class="s1">&#39;short&#39;</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id234">
<h4>API入力例<a class="headerlink" href="#id234" title="Permalink to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">リクエスト</span>
<span class="sd">    画像をbase64バイナリデータで送る</span>
<span class="sd">    Content-Type: application/json</span>
<span class="sd">    HEADER</span>
<span class="sd">        X-API-KEY: &lt;API-KEY&gt;</span>
<span class="sd">    METHOD: POST</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">image_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;hoge.jpg&quot;</span><span class="p">)</span>

<span class="c1"># 入力画像</span>
<span class="n">file_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">b64_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="c1"># 入力データ</span>
<span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">b64_data</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://hoge.app&quot;</span>

<span class="c1"># シークレット情報なので直書きせずにファイルを別途ダウンロードして読み込み</span>
<span class="n">api_key_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./secrets/api-key.txt&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">api_key_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-API-KEY&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">post_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>

<span class="c1"># 戻り値はidを持つ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="c1"># 正常受付チェック</span>
<span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
</pre></div>
</div>
</section>
</section>
<section id="dask">
<h3>Dask: ビックデータを扱う<a class="headerlink" href="#dask" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.salesanalytics.co.jp/datascience/datascience008/">ビッグなデータなら取り急ぎDask（Python） – セールスアナリティクス</a></p></li>
<li><p>データサイズが大きすぎてメモリにロードできない場合に使える。巨大なデータを自動的に分割して、処理してくれる</p></li>
</ul>
</section>
<section id="mqtt-paho">
<h3>MQTT (paho)<a class="headerlink" href="#mqtt-paho" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>https://github.com/eclipse/paho.mqtt.python</p></li>
<li><p><a class="reference external" href="https://isurunuwanthilaka.medium.com/get-into-mqtt-in-2-minutes-python-docker-5d4e8b55cf1c">Get into MQTT in 3 minutes (Python+Docker) | by Isuru Nuwanthilaka | Medium</a></p></li>
<li><p><a class="reference external" href="https://www.sunbit.co.jp/blog/2019/11/21802/">MQTTライブラリ Paho Python を理解しようとしてみる | BLOG | 福岡 佐賀【サンビット株式会社】クラウドと産業ロボットシステム</a></p></li>
</ul>
<p>特徴</p>
<ul class="simple">
<li><p>IoT向けのプロトコル</p></li>
<li><p>中継サーバである「Broker(ブローカ)」とクライアントである「Publisher(パブリッシャ)」、「Subscriber(サブスクライバ)」という3種類の役割が登場</p></li>
<li><p>Brokerが中継サーバー</p></li>
</ul>
<p>pahoはMQTTを使うためのライブラリ</p>
<section id="id235">
<h4>Usage<a class="headerlink" href="#id235" title="Permalink to this heading"></a></h4>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>paho-mqtt
</pre></div>
</div>
<p>Brokerは公式のDockerイメージを使用する</p>
<p><code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mqtt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">toke/mosquitto</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mqtt</span>
<span class="w">    </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1883</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1883:1883</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># ローカルで動作確認する場合</span>
<span class="c1"># docker-compose.ymlがあるディレクトリで</span>
$<span class="w"> </span>docker-compose<span class="w"> </span>up
Attaching<span class="w"> </span>to<span class="w"> </span>mqtt
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671426807</span>:<span class="w"> </span>mosquitto<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.4.15<span class="w"> </span><span class="o">(</span>build<span class="w"> </span>date<span class="w"> </span>Sat,<span class="w"> </span><span class="m">07</span><span class="w"> </span>Apr<span class="w"> </span><span class="m">2018</span><span class="w"> </span><span class="m">11</span>:13:41<span class="w"> </span>+0100<span class="o">)</span><span class="w"> </span>starting
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671426807</span>:<span class="w"> </span>Config<span class="w"> </span>loaded<span class="w"> </span>from<span class="w"> </span>/mqtt/config/mosquitto.conf.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671426807</span>:<span class="w"> </span>Opening<span class="w"> </span>websockets<span class="w"> </span>listen<span class="w"> </span>socket<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">9001</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671426807</span>:<span class="w"> </span>Opening<span class="w"> </span>ipv4<span class="w"> </span>listen<span class="w"> </span>socket<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">1883</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671426807</span>:<span class="w"> </span>Opening<span class="w"> </span>ipv6<span class="w"> </span>listen<span class="w"> </span>socket<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">1883</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671428608</span>:<span class="w"> </span>Saving<span class="w"> </span><span class="k">in</span>-memory<span class="w"> </span>database<span class="w"> </span>to<span class="w"> </span>/mqtt/data/mosquitto.db.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430180</span>:<span class="w"> </span>New<span class="w"> </span>connection<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.17.0.1<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">1883</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430180</span>:<span class="w"> </span>New<span class="w"> </span>client<span class="w"> </span>connected<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.17.0.1<span class="w"> </span>as<span class="w"> </span>python-mqtt-97<span class="w"> </span><span class="o">(</span>c1,<span class="w"> </span>k60<span class="o">)</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430260</span>:<span class="w"> </span>New<span class="w"> </span>connection<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.17.0.1<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">1883</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430260</span>:<span class="w"> </span>New<span class="w"> </span>client<span class="w"> </span>connected<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.17.0.1<span class="w"> </span>as<span class="w"> </span>python-mqtt-250<span class="w"> </span><span class="o">(</span>c1,<span class="w"> </span>k60<span class="o">)</span>.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430275</span>:<span class="w"> </span>Socket<span class="w"> </span>error<span class="w"> </span>on<span class="w"> </span>client<span class="w"> </span>python-mqtt-250,<span class="w"> </span>disconnecting.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430277</span>:<span class="w"> </span>Socket<span class="w"> </span>error<span class="w"> </span>on<span class="w"> </span>client<span class="w"> </span>python-mqtt-97,<span class="w"> </span>disconnecting.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671430409</span>:<span class="w"> </span>Saving<span class="w"> </span><span class="k">in</span>-memory<span class="w"> </span>database<span class="w"> </span>to<span class="w"> </span>/mqtt/data/mosquitto.db.
mqtt<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1671432210</span>:<span class="w"> </span>Saving<span class="w"> </span><span class="k">in</span>-memory<span class="w"> </span>database<span class="w"> </span>to<span class="w"> </span>/mqtt/data/mosquitto.db.
</pre></div>
</div>
<p>このホストのアドレスは<code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">-br</span> <span class="pre">address</span></code>で分かる(PCを起動する度に変わるっぽい？)</p>
<p>subscribe.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">mqtt</span>

<span class="n">MQTT_HOST</span> <span class="o">=</span> <span class="s2">&quot;172.19.145.203&quot;</span>
<span class="n">MQTT_PORT</span> <span class="o">=</span> <span class="mi">1883</span>
<span class="n">MQTT_KEEP_ALIVE</span> <span class="o">=</span> <span class="mi">60</span>

<span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">mqttc</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rc: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">mqttc</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">qos</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">()))</span>

<span class="n">mqttc</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_connect</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="n">on_message</span>  <span class="c1"># メッセージ受信時に実行するコールバック関数設定</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">MQTT_HOST</span><span class="p">,</span> <span class="n">MQTT_PORT</span><span class="p">,</span> <span class="n">MQTT_KEEP_ALIVE</span><span class="p">)</span>

<span class="n">mqttc</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;topic1&quot;</span><span class="p">)</span>  <span class="c1"># Topic名：&quot;topic1&quot;を購読</span>

<span class="n">mqttc</span><span class="o">.</span><span class="n">loop_forever</span><span class="p">()</span>  <span class="c1"># 永久ループ</span>
</pre></div>
</div>
<p>publish.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="nn">mqtt</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">MQTT_HOST</span> <span class="o">=</span> <span class="s2">&quot;172.19.145.203&quot;</span>
<span class="n">MQTT_PORT</span> <span class="o">=</span> <span class="mi">1883</span>
<span class="n">MQTT_KEEP_ALIVE</span> <span class="o">=</span> <span class="mi">60</span>

<span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">mqttc</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rc: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">))</span>

<span class="n">mqttc</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_connect</span>  <span class="c1"># 接続時に実行するコールバック関数設定</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">MQTT_HOST</span><span class="p">,</span> <span class="n">MQTT_PORT</span><span class="p">,</span> <span class="n">MQTT_KEEP_ALIVE</span><span class="p">)</span>  <span class="c1"># brokerに接続</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">loop_start</span><span class="p">()</span>
<span class="n">mqttc</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;topic1&quot;</span><span class="p">,</span> <span class="s2">&quot;test1&quot;</span><span class="p">)</span>  <span class="c1"># topic名=&quot;Topic1&quot;に &quot;test1&quot;というメッセージを送信</span>
<span class="c1"># messageのデータはpayloadメンバに入る</span>
<span class="c1"># payload must be a string, bytearray, int, float or None.</span>

<span class="n">mqttc</span><span class="o">.</span><span class="n">loop_stop</span><span class="p">()</span> <span class="c1"># stopしてからMQTT_KEEP_ALIVEの設定時間が経つと自動的にdisconnectされる</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exit&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id236">
<h4>Tips<a class="headerlink" href="#id236" title="Permalink to this heading"></a></h4>
<section id="publish">
<h5>クライアントなしでpublish<a class="headerlink" href="#publish" title="Permalink to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paho.mqtt.publish</span> <span class="k">as</span> <span class="nn">publish</span>
<span class="n">publish</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="s2">&quot;topic/path&quot;</span><span class="p">,</span> <span class="s2">&quot;topic value&quot;</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s2">&quot;mqtt.eclipseprojects.io&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="omegaconf">
<h3>OmegaConf<a class="headerlink" href="#omegaconf" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://blog.amedama.jp/entry/omega-conf">Python: OmegaConf を使ってみる - CUBE SUGAR CONTAINER</a></p>
<ul>
<li><p>yamlの設定ファイルを読み込める</p></li>
<li><p>コマンドラインの引数の値で上書きもできる</p></li>
<li><p>dataclassで構造の制限、型付けもできる</p></li>
<li><p>読み取り専用にもできる</p></li>
<li><p>必須かオプションか指定できる</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">OmegaConf</span>

<span class="n">dict_conf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
    <span class="s1">&#39;friends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Carol&#39;</span><span class="p">],</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;Japan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;prefecture&#39;</span><span class="p">:</span> <span class="s1">&#39;Tokyo&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 辞書型から作れる</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">dict_conf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">conf</span><span class="p">))</span>

<span class="c1"># 値は上書きできる</span>
<span class="n">conf</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>

<span class="c1"># 読み込んだコンフィグの使い方</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">country</span><span class="p">)</span>  <span class="c1"># object style</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;country&#39;</span><span class="p">])</span>  <span class="c1"># dictionary style</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prefecture1&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokyooo&#39;</span><span class="p">))</span> <span class="c1"># 取得するタイミングでデフォルト値を設定する場合</span>

<span class="c1"># yamlファイルから読み込む</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">conf_filepath</span><span class="p">)</span>

<span class="c1"># 引数からも作成できる</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">from_cli</span><span class="p">()</span>
<span class="c1"># python example.py server.port=8080 server.host=127.0.0.1 だと以下のようになる</span>
<span class="c1"># server:</span>
<span class="c1">#   port: 8080</span>
<span class="c1">#   host: 127.0.0.1</span>

<span class="c1"># 引数の指定をコード上でやる場合</span>
<span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="vm">__file__</span><span class="p">,</span> <span class="s1">&#39;server.port=8080&#39;</span><span class="p">,</span> <span class="s1">&#39;server.host=127.0.0.1&#39;</span><span class="p">]</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">from_cli</span><span class="p">()</span>

<span class="c1"># コマンドラインの設定で上書きする場合</span>
<span class="n">base_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">dict_conf</span><span class="p">)</span>
<span class="n">cli_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">from_cli</span><span class="p">()</span>
<span class="n">merged_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">base_conf</span><span class="p">,</span> <span class="n">cli_conf</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Cheat sheet documents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Nitta-K-git.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>